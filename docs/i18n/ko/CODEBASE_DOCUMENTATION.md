# omniroute â€” ì½”ë“œë² ì´ìŠ¤ ë¬¸ì„œ

ğŸŒ **Languages:** ğŸ‡ºğŸ‡¸ [English](../../CODEBASE_DOCUMENTATION.md) | ğŸ‡§ğŸ‡· [PortuguÃªs (Brasil)](../pt-BR/CODEBASE_DOCUMENTATION.md) | ğŸ‡ªğŸ‡¸ [EspaÃ±ol](../es/CODEBASE_DOCUMENTATION.md) | ğŸ‡«ğŸ‡· [FranÃ§ais](../fr/CODEBASE_DOCUMENTATION.md) | ğŸ‡®ğŸ‡¹ [Italiano](../it/CODEBASE_DOCUMENTATION.md) | ğŸ‡·ğŸ‡º [Ğ ÑƒÑÑĞºĞ¸Ğ¹](../ru/CODEBASE_DOCUMENTATION.md) | ğŸ‡¨ğŸ‡³ [ä¸­æ–‡ (ç®€ä½“)](../zh-CN/CODEBASE_DOCUMENTATION.md) | ğŸ‡©ğŸ‡ª [Deutsch](../de/CODEBASE_DOCUMENTATION.md) | ğŸ‡®ğŸ‡³ [à¤¹à¤¿à¤¨à¥à¤¦à¥€](../in/CODEBASE_DOCUMENTATION.md) | ğŸ‡¹ğŸ‡­ [à¹„à¸—à¸¢](../th/CODEBASE_DOCUMENTATION.md) | ğŸ‡ºğŸ‡¦ [Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°](../uk-UA/CODEBASE_DOCUMENTATION.md) | ğŸ‡¸ğŸ‡¦ [Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©](../ar/CODEBASE_DOCUMENTATION.md) | ğŸ‡¯ğŸ‡µ [æ—¥æœ¬èª](../ja/CODEBASE_DOCUMENTATION.md) | ğŸ‡»ğŸ‡³ [Tiáº¿ng Viá»‡t](../vi/CODEBASE_DOCUMENTATION.md) | ğŸ‡§ğŸ‡¬ [Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸](../bg/CODEBASE_DOCUMENTATION.md) | ğŸ‡©ğŸ‡° [Dansk](../da/CODEBASE_DOCUMENTATION.md) | ğŸ‡«ğŸ‡® [Suomi](../fi/CODEBASE_DOCUMENTATION.md) | ğŸ‡®ğŸ‡± [×¢×‘×¨×™×ª](../he/CODEBASE_DOCUMENTATION.md) | ğŸ‡­ğŸ‡º [Magyar](../hu/CODEBASE_DOCUMENTATION.md) | ğŸ‡®ğŸ‡© [Bahasa Indonesia](../id/CODEBASE_DOCUMENTATION.md) | ğŸ‡°ğŸ‡· [í•œêµ­ì–´](../ko/CODEBASE_DOCUMENTATION.md) | ğŸ‡²ğŸ‡¾ [Bahasa Melayu](../ms/CODEBASE_DOCUMENTATION.md) | ğŸ‡³ğŸ‡± [Nederlands](../nl/CODEBASE_DOCUMENTATION.md) | ğŸ‡³ğŸ‡´ [Norsk](../no/CODEBASE_DOCUMENTATION.md) | ğŸ‡µğŸ‡¹ [PortuguÃªs (Portugal)](../pt/CODEBASE_DOCUMENTATION.md) | ğŸ‡·ğŸ‡´ [RomÃ¢nÄƒ](../ro/CODEBASE_DOCUMENTATION.md) | ğŸ‡µğŸ‡± [Polski](../pl/CODEBASE_DOCUMENTATION.md) | ğŸ‡¸ğŸ‡° [SlovenÄina](../sk/CODEBASE_DOCUMENTATION.md) | ğŸ‡¸ğŸ‡ª [Svenska](../sv/CODEBASE_DOCUMENTATION.md) | ğŸ‡µğŸ‡­ [Filipino](../phi/CODEBASE_DOCUMENTATION.md)

> **ì˜´ë‹ˆë£¨íŠ¸** ë‹¤ì¤‘ ì œê³µì AI í”„ë¡ì‹œ ë¼ìš°í„°ì— ëŒ€í•œ í¬ê´„ì ì´ê³  ì´ˆë³´ì ì¹œí™”ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## 1. ì˜´ë‹ˆë£¨íŠ¸ë€?

omnirouteëŠ” AI í´ë¼ì´ì–¸íŠ¸(Claude CLI, Codex, Cursor IDE ë“±)ì™€ AI ê³µê¸‰ì(Anthropic, Google, OpenAI, AWS, GitHub ë“±) ì‚¬ì´ì— ìœ„ì¹˜í•˜ëŠ” **í”„ë¡ì‹œ ë¼ìš°í„°**ì…ë‹ˆë‹¤. ì´ëŠ” í•˜ë‚˜ì˜ í° ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

> **ë‹¤ì–‘í•œ AI í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë¡œ ë‹¤ë¥¸ "ì–¸ì–´"(API í˜•ì‹)ë¥¼ ì‚¬ìš©í•˜ë©°, ë‹¤ì–‘í•œ AI ì œê³µì—…ì²´ë„ ì„œë¡œ ë‹¤ë¥¸ "ì–¸ì–´"ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤.** omnirouteëŠ” ì´ë“¤ ì‚¬ì´ë¥¼ ìë™ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

UNì˜ ë²”ìš© í†µì—­ì‚¬ì²˜ëŸ¼ ìƒê°í•´ë³´ì„¸ìš”. ëª¨ë“  ëŒ€í‘œëŠ” ëª¨ë“  ì–¸ì–´ë¥¼ ë§í•  ìˆ˜ ìˆìœ¼ë©° ë²ˆì—­ìëŠ” ë‹¤ë¥¸ ëŒ€í‘œë¥¼ ìœ„í•´ ì´ë¥¼ ë³€í™˜í•©ë‹ˆë‹¤.

---

## 2. ì•„í‚¤í…ì²˜ ê°œìš”

```mermaid
graph LR
    subgraph Clients
        A[Claude CLI]
        B[Codex]
        C[Cursor IDE]
        D[OpenAI-compatible]
    end

    subgraph omniroute
        E[Handler Layer]
        F[Translator Layer]
        G[Executor Layer]
        H[Services Layer]
    end

    subgraph Providers
        I[Anthropic Claude]
        J[Google Gemini]
        K[OpenAI / Codex]
        L[GitHub Copilot]
        M[AWS Kiro]
        N[Antigravity]
        O[Cursor API]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    G --> I
    G --> J
    G --> K
    G --> L
    G --> M
    G --> N
    G --> O
    H -.-> E
    H -.-> G
```

### í•µì‹¬ ì›ì¹™: í—ˆë¸Œ ì•¤ ìŠ¤í¬í¬ ë²ˆì—­

ëª¨ë“  í˜•ì‹ ë²ˆì—­ì€ **OpenAI í˜•ì‹ì„ í—ˆë¸Œ**ë¡œ í†µê³¼í•©ë‹ˆë‹¤.

```
Client Format â†’ [OpenAI Hub] â†’ Provider Format    (request)
Provider Format â†’ [OpenAI Hub] â†’ Client Format    (response)
```

ì¦‰, **NÂ²**(ëª¨ë“  ìŒ) ëŒ€ì‹  **N ë²ˆì—­ì**(í˜•ì‹ë‹¹ í•˜ë‚˜)ë§Œ í•„ìš”í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

---

## 3. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
omniroute/
â”œâ”€â”€ open-sse/                  â† Core proxy library (portable, framework-agnostic)
â”‚   â”œâ”€â”€ index.js               â† Main entry point, exports everything
â”‚   â”œâ”€â”€ config/                â† Configuration & constants
â”‚   â”œâ”€â”€ executors/             â† Provider-specific request execution
â”‚   â”œâ”€â”€ handlers/              â† Request handling orchestration
â”‚   â”œâ”€â”€ services/              â† Business logic (auth, models, fallback, usage)
â”‚   â”œâ”€â”€ translator/            â† Format translation engine
â”‚   â”‚   â”œâ”€â”€ request/           â† Request translators (8 files)
â”‚   â”‚   â”œâ”€â”€ response/          â† Response translators (7 files)
â”‚   â”‚   â””â”€â”€ helpers/           â† Shared translation utilities (6 files)
â”‚   â””â”€â”€ utils/                 â† Utility functions
â”œâ”€â”€ src/                       â† Application layer (Express/Worker runtime)
â”‚   â”œâ”€â”€ app/                   â† Web UI, API routes, middleware
â”‚   â”œâ”€â”€ lib/                   â† Database, auth, and shared library code
â”‚   â”œâ”€â”€ mitm/                  â† Man-in-the-middle proxy utilities
â”‚   â”œâ”€â”€ models/                â† Database models
â”‚   â”œâ”€â”€ shared/                â† Shared utilities (wrappers around open-sse)
â”‚   â”œâ”€â”€ sse/                   â† SSE endpoint handlers
â”‚   â””â”€â”€ store/                 â† State management
â”œâ”€â”€ data/                      â† Runtime data (credentials, logs)
â”‚   â””â”€â”€ provider-credentials.json   (external credentials override, gitignored)
â””â”€â”€ tester/                    â† Test utilities
```

---

## 4. ëª¨ë“ˆë³„ ë¶„ì„

### 4.1 êµ¬ì„±(`open-sse/config/`)

ëª¨ë“  ê³µê¸‰ì êµ¬ì„±ì— ëŒ€í•œ **ë‹¨ì¼ ì •ë³´ ì†ŒìŠ¤**.

| íŒŒì¼                          | ëª©ì                                                                                                                                                                                                                     |
| ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constants.ts`                | ëª¨ë“  ê³µê¸‰ìì— ëŒ€í•œ ê¸°ë³¸ URL, OAuth ìê²© ì¦ëª…(ê¸°ë³¸ê°’), í—¤ë” ë° ê¸°ë³¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ê°€ í¬í•¨ëœ `PROVIDERS` ê°œì²´ì…ë‹ˆë‹¤. ë˜í•œ `HTTP_STATUS`, `ERROR_TYPES`, `COOLDOWN_MS`, `BACKOFF_CONFIG` ë° `SKIP_PATTERNS`ì„ ì •ì˜í•©ë‹ˆë‹¤. |
| `credentialLoader.ts`         | `data/provider-credentials.json`ì—ì„œ ì™¸ë¶€ ìê²© ì¦ëª…ì„ ë¡œë“œí•˜ê³  `PROVIDERS`ì˜ í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ê°’ì— ë³‘í•©í•©ë‹ˆë‹¤. ì´ì „ ë²„ì „ê³¼ì˜ í˜¸í™˜ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ì†ŒìŠ¤ ì œì–´ì—ì„œ ë¹„ë°€ì„ ìœ ì§€í•©ë‹ˆë‹¤.                                         |
| `providerModels.ts`           | ì¤‘ì•™ ëª¨ë¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬: ê³µê¸‰ì ë³„ì¹­ â†’ ëª¨ë¸ IDë¥¼ ë§¤í•‘í•©ë‹ˆë‹¤. `getModels()`, `getProviderByAlias()`ê³¼ ê°™ì€ í•¨ìˆ˜ì…ë‹ˆë‹¤.                                                                                                      |
| `codexInstructions.ts`        | Codex ìš”ì²­ì— ì£¼ì…ëœ ì‹œìŠ¤í…œ ì§€ì¹¨(ì œì•½ ì¡°ê±´, ìƒŒë“œë°•ìŠ¤ ê·œì¹™, ìŠ¹ì¸ ì •ì±… í¸ì§‘)                                                                                                                                               |
| `defaultThinkingSignature.ts` | Claude ë° Gemini ëª¨ë¸ì˜ ê¸°ë³¸ "ì‚¬ê³ " ì„œëª…ì…ë‹ˆë‹¤.                                                                                                                                                                         |
| `ollamaModels.ts`             | ë¡œì»¬ Ollama ëª¨ë¸ì— ëŒ€í•œ ìŠ¤í‚¤ë§ˆ ì •ì˜(ì´ë¦„, í¬ê¸°, ê³„ì—´, ì–‘ìí™”)                                                                                                                                                           |

#### ìê²© ì¦ëª… ë¡œë“œ íë¦„

```mermaid
flowchart TD
    A["App starts"] --> B["constants.ts defines PROVIDERS\nwith hardcoded defaults"]
    B --> C{"data/provider-credentials.json\nexists?"}
    C -->|Yes| D["credentialLoader reads JSON"]
    C -->|No| E["Use hardcoded defaults"]
    D --> F{"For each provider in JSON"}
    F --> G{"Provider exists\nin PROVIDERS?"}
    G -->|No| H["Log warning, skip"]
    G -->|Yes| I{"Value is object?"}
    I -->|No| J["Log warning, skip"]
    I -->|Yes| K["Merge clientId, clientSecret,\ntokenUrl, authUrl, refreshUrl"]
    K --> F
    H --> F
    J --> F
    F -->|Done| L["PROVIDERS ready with\nmerged credentials"]
    E --> L
```

---

### 4.2 ì‹¤í–‰ì(`open-sse/executors/`)

ì‹¤í–‰ìëŠ” **ì „ëµ íŒ¨í„´**ì„ ì‚¬ìš©í•˜ì—¬ **ì œê³µìë³„ ë¡œì§**ì„ ìº¡ìŠí™”í•©ë‹ˆë‹¤. ê° ì‹¤í–‰ìëŠ” í•„ìš”ì— ë”°ë¼ ê¸°ë³¸ ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•©ë‹ˆë‹¤.

```mermaid
classDiagram
    class BaseExecutor {
        +buildUrl(model, stream, options)
        +buildHeaders(credentials, stream, body)
        +transformRequest(body, model, stream, credentials)
        +execute(url, options)
        +shouldRetry(status, error)
        +refreshCredentials(credentials, log)
    }

    class DefaultExecutor {
        +refreshCredentials()
    }

    class AntigravityExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +shouldRetry()
        +refreshCredentials()
    }

    class CursorExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseResponse()
        +generateChecksum()
    }

    class KiroExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseEventStream()
        +refreshCredentials()
    }

    BaseExecutor <|-- DefaultExecutor
    BaseExecutor <|-- AntigravityExecutor
    BaseExecutor <|-- CursorExecutor
    BaseExecutor <|-- KiroExecutor
    BaseExecutor <|-- CodexExecutor
    BaseExecutor <|-- GeminiCLIExecutor
    BaseExecutor <|-- GithubExecutor
```

| ì§‘í–‰ì           | ê³µê¸‰ì                                      | ì£¼ìš” ì „ë¬¸ ë¶„ì•¼                                                                                                 |
| ---------------- | ------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `base.ts`        | â€”                                           | ì¶”ìƒ ê¸°ë°˜: URL êµ¬ì¶•, í—¤ë”, ì¬ì‹œë„ ë…¼ë¦¬, ìê²© ì¦ëª… ìƒˆë¡œ ê³ ì¹¨                                                    |
| `default.ts`     | í´ë¡œë“œ, ì œë¯¸ë‹ˆ, OpenAI, GLM, í‚¤ë¯¸, ë¯¸ë‹ˆë§¥ìŠ¤ | í‘œì¤€ ê³µê¸‰ìë¥¼ ìœ„í•œ ì¼ë°˜ OAuth í† í° ìƒˆë¡œ ê³ ì¹¨                                                                   |
| `antigravity.ts` | Google í´ë¼ìš°ë“œ ì½”ë“œ                        | í”„ë¡œì íŠ¸/ì„¸ì…˜ ID ìƒì„±, ë‹¤ì¤‘ URL ëŒ€ì²´, ì˜¤ë¥˜ ë©”ì‹œì§€ì—ì„œ ì‚¬ìš©ì ì •ì˜ ì¬ì‹œë„ êµ¬ë¬¸ ë¶„ì„("2ì‹œê°„ 7ë¶„ 23ì´ˆ í›„ ì¬ì„¤ì •") |
| `cursor.ts`      | ì»¤ì„œ IDE                                    | **ê°€ì¥ ë³µì¡í•¨**: SHA-256 ì²´í¬ì„¬ ì¸ì¦, Protobuf ìš”ì²­ ì¸ì½”ë”©, ë°”ì´ë„ˆë¦¬ EventStream â†’ SSE ì‘ë‹µ êµ¬ë¬¸ ë¶„ì„          |
| `codex.ts`       | OpenAI ì½”ë±ìŠ¤                               | ì‹œìŠ¤í…œ ì§€ì¹¨ ì£¼ì…, â€‹â€‹ì‚¬ê³  ìˆ˜ì¤€ ê´€ë¦¬, ì§€ì›ë˜ì§€ ì•ŠëŠ” ë§¤ê°œë³€ìˆ˜ ì œê±°                                                |
| `gemini-cli.ts`  | êµ¬ê¸€ ì œë¯¸ë‹ˆ CLI                             | ë§ì¶¤ URL êµ¬ì¶•(`streamGenerateContent`), Google OAuth í† í° ìƒˆë¡œê³ ì¹¨                                             |
| `github.ts`      | GitHub ë¶€ì¡°ì¢…ì‚¬                             | ë“€ì–¼ í† í° ì‹œìŠ¤í…œ(GitHub OAuth + Copilot í† í°), VSCode í—¤ë” ëª¨ë°©                                                |
| `kiro.ts`        | AWS ì½”ë“œìœ„ìŠ¤í¼ëŸ¬                            | AWS EventStream ë°”ì´ë„ˆë¦¬ êµ¬ë¬¸ ë¶„ì„, AMZN ì´ë²¤íŠ¸ í”„ë ˆì„, í† í° ì¶”ì •                                              |
| `index.ts`       | â€”                                           | íŒ©í† ë¦¬: ê¸°ë³¸ í´ë°±ì„ ì‚¬ìš©í•˜ì—¬ ê³µê¸‰ì ì´ë¦„ â†’ ì‹¤í–‰ì í´ë˜ìŠ¤ ë§¤í•‘                                                  |

---

### 4.3 í•¸ë“¤ëŸ¬(`open-sse/handlers/`)

**ì¡°ì • ë ˆì´ì–´** â€” ë²ˆì—­, ì‹¤í–‰, ìŠ¤íŠ¸ë¦¬ë° ë° ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤.

| íŒŒì¼                  | ëª©ì                                                                                                                                                                          |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chatCore.ts`         | **ì¤‘ì•™ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°**(~600ì¤„). í˜•ì‹ ê°ì§€ â†’ ë³€í™˜ â†’ ì‹¤í–‰ê¸° ë””ìŠ¤íŒ¨ì¹˜ â†’ ìŠ¤íŠ¸ë¦¬ë°/ë¹„ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ â†’ í† í° ìƒˆë¡œ ê³ ì¹¨ â†’ ì˜¤ë¥˜ ì²˜ë¦¬ â†’ ì‚¬ìš© ë¡œê¹… ë“± ì „ì²´ ìš”ì²­ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. |
| `responsesHandler.ts` | OpenAIì˜ ì‘ë‹µ APIìš© ì–´ëŒ‘í„°: ì‘ë‹µ í˜•ì‹ ë³€í™˜ â†’ ì±„íŒ… ì™„ë£Œ â†’ `chatCore`ë¡œ ì „ì†¡ â†’ SSEë¥¼ ë‹¤ì‹œ ì‘ë‹µ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.                                                            |
| `embeddings.ts`       | ì„ë² ë”© ìƒì„± í•¸ë“¤ëŸ¬: ì„ë² ë”© ëª¨ë¸ â†’ ê³µê¸‰ìë¥¼ í™•ì¸í•˜ê³  ê³µê¸‰ì APIë¡œ ë””ìŠ¤íŒ¨ì¹˜í•˜ê³  OpenAI í˜¸í™˜ ì„ë² ë”© ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤. 6ê°œ ì´ìƒì˜ ê³µê¸‰ìë¥¼ ì§€ì›í•©ë‹ˆë‹¤.                          |
| `imageGeneration.ts`  | ì´ë¯¸ì§€ ìƒì„± í•¸ë“¤ëŸ¬: ì´ë¯¸ì§€ ëª¨ë¸ â†’ ê³µê¸‰ìë¥¼ í™•ì¸í•˜ê³  OpenAI í˜¸í™˜, Gemini ì´ë¯¸ì§€(ë°˜ì¤‘ë ¥) ë° í´ë°±(Nebius) ëª¨ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤. base64 ë˜ëŠ” URL ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.               |

#### ìš”ì²­ ìˆ˜ëª… ì£¼ê¸°(chatCore.ts)

```mermaid
sequenceDiagram
    participant Client
    participant chatCore
    participant Translator
    participant Executor
    participant Provider

    Client->>chatCore: Request (any format)
    chatCore->>chatCore: Detect source format
    chatCore->>chatCore: Check bypass patterns
    chatCore->>chatCore: Resolve model & provider
    chatCore->>Translator: Translate request (source â†’ OpenAI â†’ target)
    chatCore->>Executor: Get executor for provider
    Executor->>Executor: Build URL, headers, transform request
    Executor->>Executor: Refresh credentials if needed
    Executor->>Provider: HTTP fetch (streaming or non-streaming)

    alt Streaming
        Provider-->>chatCore: SSE stream
        chatCore->>chatCore: Pipe through SSE transform stream
        Note over chatCore: Transform stream translates<br/>each chunk: target â†’ OpenAI â†’ source
        chatCore-->>Client: Translated SSE stream
    else Non-streaming
        Provider-->>chatCore: JSON response
        chatCore->>Translator: Translate response
        chatCore-->>Client: Translated JSON
    end

    alt Error (401, 429, 500...)
        chatCore->>Executor: Retry with credential refresh
        chatCore->>chatCore: Account fallback logic
    end
```

---

### 4.4 ì„œë¹„ìŠ¤ (`open-sse/services/`)

ì²˜ë¦¬ê¸°ì™€ ì‹¤í–‰ê¸°ë¥¼ ì§€ì›í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë…¼ë¦¬ì…ë‹ˆë‹¤.

| íŒŒì¼                 | ëª©ì                                                                                                                                                                                                                                                                             |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `provider.ts`        | **í˜•ì‹ ê°ì§€**(`detectFormat`): ìš”ì²­ ë³¸ë¬¸ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ Claude/OpenAI/Gemini/ë°˜ì¤‘ë ¥/ì‘ë‹µ í˜•ì‹ì„ ì‹ë³„í•©ë‹ˆë‹¤(Claudeì— ëŒ€í•œ `max_tokens` íœ´ë¦¬ìŠ¤í‹± í¬í•¨). ë˜í•œ: URL êµ¬ì¶•, í—¤ë” êµ¬ì¶•, êµ¬ì„± ì •ê·œí™” ì‚¬ê³ . `openai-compatible-*` ë° `anthropic-compatible-*` ë™ì  ê³µê¸‰ìë¥¼ ì§€ì›í•©ë‹ˆë‹¤. |
| `model.ts`           | ëª¨ë¸ ë¬¸ìì—´ êµ¬ë¬¸ ë¶„ì„(`claude/model-name` â†’ `{provider: "claude", model: "model-name"}`), ì¶©ëŒ ê°ì§€ë¥¼ í†µí•œ ë³„ì¹­ í•´ê²°, ì…ë ¥ ì‚­ì œ(ê²½ë¡œ ìˆœíšŒ/ì œì–´ ë¬¸ì ê±°ë¶€), ë¹„ë™ê¸° ë³„ì¹­ getter ì§€ì›ì„ í†µí•œ ëª¨ë¸ ì •ë³´ í™•ì¸.                                                                       |
| `accountFallback.ts` | ì†ë„ ì œí•œ ì²˜ë¦¬: ì§€ìˆ˜ ë°±ì˜¤í”„(1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ â†’ ìµœëŒ€ 2ë¶„), ê³„ì • íœ´ì§€ ê´€ë¦¬, ì˜¤ë¥˜ ë¶„ë¥˜(ì˜¤ë¥˜ê°€ ëŒ€ì²´ë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ”ì§€ ì—¬ë¶€).                                                                                                                                                            |
| `tokenRefresh.ts`    | **ëª¨ë“  ê³µê¸‰ì**ì— ëŒ€í•œ OAuth í† í° ìƒˆë¡œ ê³ ì¹¨: Google(Gemini, Antigravity), Claude, Codex, Qwen, iFlow, GitHub(OAuth + Copilot ì´ì¤‘ í† í°), Kiro(AWS SSO OIDC + Social Auth). ì§„í–‰ ì¤‘ì¸ ì•½ì† ì¤‘ë³µ ì œê±° ìºì‹œ ë° ì§€ìˆ˜ ë°±ì˜¤í”„ë¥¼ í†µí•œ ì¬ì‹œë„ê°€ í¬í•¨ë©ë‹ˆë‹¤.                             |
| `combo.ts`           | **ì½¤ë³´ ëª¨ë¸**: ëŒ€ì²´ ëª¨ë¸ ì²´ì¸ì…ë‹ˆë‹¤. ëª¨ë¸ Aê°€ ëŒ€ì²´ ê°€ëŠ¥ ì˜¤ë¥˜ë¡œ ì¸í•´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° ëª¨ë¸ Bë¥¼ ì‹œë„í•œ ë‹¤ìŒ Cë¥¼ ì‹œë„í•©ë‹ˆë‹¤. ì‹¤ì œ ì—…ìŠ¤íŠ¸ë¦¼ ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.                                                                                                                    |
| `usage.ts`           | ê³µê¸‰ì API(GitHub Copilot í• ë‹¹ëŸ‰, ë°˜ì¤‘ë ¥ ëª¨ë¸ í• ë‹¹ëŸ‰, Codex ì†ë„ ì œí•œ, Kiro ì‚¬ìš©ëŸ‰ ë¶„ì„, Claude ì„¤ì •)ì—ì„œ í• ë‹¹ëŸ‰/ì‚¬ìš© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.                                                                                                                                      |
| `accountSelector.ts` | ì±„ì  ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ ìŠ¤ë§ˆíŠ¸ ê³„ì • ì„ íƒ: ìš°ì„ ìˆœìœ„, ìƒíƒœ, ë¼ìš´ë“œ ë¡œë¹ˆ ìœ„ì¹˜ ë° ì¿¨ë‹¤ìš´ ìƒíƒœë¥¼ ê³ ë ¤í•˜ì—¬ ê° ìš”ì²­ì— ëŒ€í•œ ìµœì ì˜ ê³„ì •ì„ ì„ íƒí•©ë‹ˆë‹¤.                                                                                                                                    |
| `contextManager.ts`  | ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬: ë””ë²„ê¹… ë° ë¡œê¹…ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„°(ìš”ì²­ ID, íƒ€ì„ìŠ¤íƒ¬í”„, ê³µê¸‰ì ì •ë³´)ê°€ í¬í•¨ëœ ìš”ì²­ë³„ ì»¨í…ìŠ¤íŠ¸ ê°œì²´ë¥¼ ìƒì„±í•˜ê³  ì¶”ì í•©ë‹ˆë‹¤.                                                                                                                           |
| `ipFilter.ts`        | IP ê¸°ë°˜ ì•¡ì„¸ìŠ¤ ì œì–´: í—ˆìš© ëª©ë¡ ë° ì°¨ë‹¨ ëª©ë¡ ëª¨ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤. API ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ì „ì— êµ¬ì„±ëœ ê·œì¹™ì— ë”°ë¼ í´ë¼ì´ì–¸íŠ¸ IPë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.                                                                                                                                          |
| `sessionManager.ts`  | í´ë¼ì´ì–¸íŠ¸ í•‘ê±°í”„ë¦°íŒ…ì„ í†µí•œ ì„¸ì…˜ ì¶”ì : í•´ì‹œëœ í´ë¼ì´ì–¸íŠ¸ ì‹ë³„ìë¥¼ ì‚¬ìš©í•˜ì—¬ í™œì„± ì„¸ì…˜ì„ ì¶”ì í•˜ê³ , ìš”ì²­ ìˆ˜ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì„¸ì…˜ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤.                                                                                                                             |
| `signatureCache.ts`  | ìš”ì²­ ì„œëª… ê¸°ë°˜ ì¤‘ë³µ ì œê±° ìºì‹œ: ìµœê·¼ ìš”ì²­ ì„œëª…ì„ ìºì‹œí•˜ê³  ì¼ì • ê¸°ê°„ ë‚´ì— ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ ìºì‹œëœ ì‘ë‹µì„ ë°˜í™˜í•˜ì—¬ ì¤‘ë³µ ìš”ì²­ì„ ë°©ì§€í•©ë‹ˆë‹¤.                                                                                                                                       |
| `systemPrompt.ts`    | ê¸€ë¡œë²Œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì‚½ì…: ì œê³µìë³„ í˜¸í™˜ì„± ì²˜ë¦¬ë¥¼ í†µí•´ ëª¨ë“  ìš”ì²­ì— â€‹â€‹êµ¬ì„± ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì¶”ê°€í•©ë‹ˆë‹¤.                                                                                                                                                     |
| `thinkingBudget.ts`  | ì¶”ë¡  í† í° ì˜ˆì‚° ê´€ë¦¬: ì‚¬ê³ /ì¶”ë¡  í† í° ì œì–´ë¥¼ ìœ„í•œ íŒ¨ìŠ¤ìŠ¤ë£¨, ìë™(ìŠ¤íŠ¸ë¦½ ì‚¬ê³  êµ¬ì„±), ì‚¬ìš©ì ì •ì˜(ê³ ì • ì˜ˆì‚°) ë° ì ì‘í˜•(ë³µì¡ì„± í™•ì¥) ëª¨ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤.                                                                                                                              |
| `wildcardRouter.ts`  | ì™€ì¼ë“œì¹´ë“œ ëª¨ë¸ íŒ¨í„´ ë¼ìš°íŒ…: ê°€ìš©ì„± ë° ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´(ì˜ˆ: `*/claude-*`)ì„ êµ¬ì²´ì ì¸ ê³µê¸‰ì/ëª¨ë¸ ìŒìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.                                                                                                                                              |

#### í† í° ìƒˆë¡œ ê³ ì¹¨ ì¤‘ë³µ ì œê±°

```mermaid
sequenceDiagram
    participant R1 as Request 1
    participant R2 as Request 2
    participant Cache as refreshPromiseCache
    participant OAuth as OAuth Provider

    R1->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: No in-flight promise
    Cache->>OAuth: Start refresh
    R2->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: Found in-flight promise
    Cache-->>R2: Return existing promise
    OAuth-->>Cache: New access token
    Cache-->>R1: New access token
    Cache-->>R2: Same access token (shared)
    Cache->>Cache: Delete cache entry
```

#### ê³„ì • ëŒ€ì²´ ìƒíƒœ ë¨¸ì‹ 

```mermaid
stateDiagram-v2
    [*] --> Active
    Active --> Error: Request fails (401/429/500)
    Error --> Cooldown: Apply backoff
    Cooldown --> Active: Cooldown expires
    Active --> Active: Request succeeds (reset backoff)

    state Error {
        [*] --> ClassifyError
        ClassifyError --> ShouldFallback: Rate limit / Auth / Transient
        ClassifyError --> NoFallback: 400 Bad Request
    }

    state Cooldown {
        [*] --> ExponentialBackoff
        ExponentialBackoff: Level 0 = 1s
        ExponentialBackoff: Level 1 = 2s
        ExponentialBackoff: Level 2 = 4s
        ExponentialBackoff: Max = 2min
    }
```

#### ì½¤ë³´ ëª¨ë¸ ì²´ì¸

```mermaid
flowchart LR
    A["Request with\ncombo model"] --> B["Model A"]
    B -->|"2xx Success"| C["Return response"]
    B -->|"429/401/500"| D{"Fallback\neligible?"}
    D -->|Yes| E["Model B"]
    D -->|No| F["Return error"]
    E -->|"2xx Success"| C
    E -->|"429/401/500"| G{"Fallback\neligible?"}
    G -->|Yes| H["Model C"]
    G -->|No| F
    H -->|"2xx Success"| C
    H -->|"Fail"| I["All failed â†’\nReturn last status"]
```

---

### 4.5 ë²ˆì—­ê¸°(`open-sse/translator/`)

ìì²´ ë“±ë¡ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” **í˜•ì‹ ë²ˆì—­ ì—”ì§„**.

#### ì•„í‚¤í…ì²˜

```mermaid
graph TD
    subgraph "Request Translation"
        A["Claude â†’ OpenAI"]
        B["Gemini â†’ OpenAI"]
        C["Antigravity â†’ OpenAI"]
        D["OpenAI Responses â†’ OpenAI"]
        E["OpenAI â†’ Claude"]
        F["OpenAI â†’ Gemini"]
        G["OpenAI â†’ Kiro"]
        H["OpenAI â†’ Cursor"]
    end

    subgraph "Response Translation"
        I["Claude â†’ OpenAI"]
        J["Gemini â†’ OpenAI"]
        K["Kiro â†’ OpenAI"]
        L["Cursor â†’ OpenAI"]
        M["OpenAI â†’ Claude"]
        N["OpenAI â†’ Antigravity"]
        O["OpenAI â†’ Responses"]
    end
```

| ë””ë ‰í† ë¦¬     | íŒŒì¼         | ì„¤ëª…                                                                                                                                                                                                                 |
| ------------ | ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `request/`   | 8ëª…ì˜ ë²ˆì—­ê°€ | í˜•ì‹ ê°„ì— ìš”ì²­ ë³¸ë¬¸ì„ ë³€í™˜í•©ë‹ˆë‹¤. ê° íŒŒì¼ì€ ê°€ì ¸ì˜¬ ë•Œ `register(from, to, fn)`ì„ í†µí•´ ìì²´ ë“±ë¡ë©ë‹ˆë‹¤.                                                                                                               |
| `response/`  | 7ëª…ì˜ ë²ˆì—­ì | í˜•ì‹ ê°„ì— ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²­í¬ë¥¼ ë³€í™˜í•©ë‹ˆë‹¤. SSE ì´ë²¤íŠ¸ ìœ í˜•, ì‚¬ê³  ë¸”ë¡, ë„êµ¬ í˜¸ì¶œì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.                                                                                                                       |
| `helpers/`   | ë„ìš°ë¯¸ 6ëª…   | ê³µìœ  ìœ í‹¸ë¦¬í‹°: `claudeHelper`(ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì¶”ì¶œ, ì‚¬ê³  êµ¬ì„±), `geminiHelper`(ë¶€ë¶„/ì½˜í…ì¸  ë§¤í•‘), `openaiHelper`(í˜•ì‹ í•„í„°ë§), `toolCallHelper`(ID ìƒì„±, ëˆ„ë½ëœ ì‘ë‹µ ì£¼ì…), `maxTokensHelper`, `responsesApiHelper`. |
| `index.ts`   | â€”            | ë²ˆì—­ ì—”ì§„: `translateRequest()`, `translateResponse()`, ìƒíƒœ ê´€ë¦¬, ë ˆì§€ìŠ¤íŠ¸ë¦¬.                                                                                                                                       |
| `formats.ts` | â€”            | í˜•ì‹ ìƒìˆ˜: `OPENAI`, `CLAUDE`, `GEMINI`, `ANTIGRAVITY`, `KIRO`, `CURSOR`, `OPENAI_RESPONSES`.                                                                                                                        |

#### ì£¼ìš” ë””ìì¸: ìë™ ë“±ë¡ í”ŒëŸ¬ê·¸ì¸

```javascript
// Each translator file calls register() on import:
import { register } from "../index.js";
register("claude", "openai", translateClaudeToOpenAI);

// The index.js imports all translator files, triggering registration:
import "./request/claude-to-openai.js"; // â† self-registers
```

---

### 4.6 ìœ í‹¸ë¦¬í‹°(`open-sse/utils/`)

| íŒŒì¼               | ëª©ì                                                                                                                                                                                                                                                        |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `error.ts`         | ì˜¤ë¥˜ ì‘ë‹µ êµ¬ì¶•(OpenAI í˜¸í™˜ í˜•ì‹), ì—…ìŠ¤íŠ¸ë¦¼ ì˜¤ë¥˜ êµ¬ë¬¸ ë¶„ì„, ì˜¤ë¥˜ ë©”ì‹œì§€ì—ì„œ ë°˜ì¤‘ë ¥ ì¬ì‹œë„ ì‹œê°„ ì¶”ì¶œ, SSE ì˜¤ë¥˜ ìŠ¤íŠ¸ë¦¬ë°.                                                                                                                                     |
| `stream.ts`        | **SSE ë³€í™˜ ìŠ¤íŠ¸ë¦¼** â€” í•µì‹¬ ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤. ë‘ ê°€ì§€ ëª¨ë“œ: `TRANSLATE`(ì „ì²´ í˜•ì‹ ë²ˆì—­) ë° `PASSTHROUGH`(ì •ê·œí™” + ì‚¬ìš©ëŸ‰ ì¶”ì¶œ). ì²­í¬ ë²„í¼ë§, ì‚¬ìš©ëŸ‰ ì¶”ì •, ì½˜í…ì¸  ê¸¸ì´ ì¶”ì ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¦¼ë³„ ì¸ì½”ë”/ë””ì½”ë” ì¸ìŠ¤í„´ìŠ¤ëŠ” ê³µìœ  ìƒíƒœë¥¼ ë°©ì§€í•©ë‹ˆë‹¤. |
| `streamHelpers.ts` | í•˜ìœ„ ìˆ˜ì¤€ SSE ìœ í‹¸ë¦¬í‹°: `parseSSELine`(ê³µë°± í—ˆìš©), `hasValuableContent`(OpenAI/Claude/Geminiì˜ ë¹ˆ ì²­í¬ í•„í„°ë§), `fixInvalidId`, `formatSSE`(`perf_metrics` ì •ë¦¬ë¥¼ í†µí•œ í˜•ì‹ ì¸ì‹ SSE ì§ë ¬í™”).                                                              |
| `usageTracking.ts` | ëª¨ë“  í˜•ì‹(Claude/OpenAI/Gemini/Responses)ì—ì„œ í† í° ì‚¬ìš©ëŸ‰ ì¶”ì¶œ, ë³„ë„ ë„êµ¬/í† í°ë‹¹ ë©”ì‹œì§€ ë¬¸ì ë¹„ìœ¨ì„ ì‚¬ìš©í•œ ì¶”ì •, ë²„í¼ ì¶”ê°€(2000 í† í° ì•ˆì „ ë§ˆì§„), í˜•ì‹ë³„ í•„ë“œ í•„í„°ë§, ANSI ìƒ‰ìƒì„ ì‚¬ìš©í•œ ì½˜ì†” ë¡œê¹….                                                         |
| `requestLogger.ts` | íŒŒì¼ ê¸°ë°˜ ìš”ì²­ ë¡œê¹…(`ENABLE_REQUEST_LOGS=true`ì„ í†µí•œ ì„ íƒ). ë²ˆí˜¸ê°€ ë§¤ê²¨ì§„ íŒŒì¼(`1_req_client.json` â†’ `7_res_client.txt`)ë¡œ ì„¸ì…˜ í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ëª¨ë“  I/OëŠ” ë¹„ë™ê¸°ì‹ì…ë‹ˆë‹¤(fire-and-forget). ë¯¼ê°í•œ í—¤ë”ë¥¼ ë§ˆìŠ¤í‚¹í•©ë‹ˆë‹¤.                                |
| `bypassHandler.ts` | Claude CLI(ì œëª© ì¶”ì¶œ, ì›Œë°ì—…, ì¹´ìš´íŠ¸)ì˜ íŠ¹ì • íŒ¨í„´ì„ ê°€ë¡œì±„ê³  ê³µê¸‰ìë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³  ê°€ì§œ ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¦¬ë°ê³¼ ë¹„ìŠ¤íŠ¸ë¦¬ë°ì„ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤. ì˜ë„ì ìœ¼ë¡œ Claude CLI ë²”ìœ„ë¡œ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤.                                                          |
| `networkProxy.ts`  | ê³µê¸‰ìë³„ êµ¬ì„± â†’ ì „ì—­ êµ¬ì„± â†’ í™˜ê²½ ë³€ìˆ˜(`HTTPS_PROXY`/`HTTP_PROXY`/`ALL_PROXY`) ìš°ì„  ìˆœìœ„ì— ë”°ë¼ ì§€ì •ëœ ê³µê¸‰ìì— ëŒ€í•œ ì•„ì›ƒë°”ìš´ë“œ í”„ë¡ì‹œ URLì„ í™•ì¸í•©ë‹ˆë‹¤. `NO_PROXY` ì œì™¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. 30ì´ˆ ë™ì•ˆ ìºì‹œ êµ¬ì„±.                                                 |

#### SSE ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸

```mermaid
flowchart TD
    A["Provider SSE stream"] --> B["TextDecoder\n(per-stream instance)"]
    B --> C["Buffer lines\n(split on newline)"]
    C --> D["parseSSELine()\n(trim whitespace, parse JSON)"]
    D --> E{"Mode?"}
    E -->|TRANSLATE| F["translateResponse()\ntarget â†’ OpenAI â†’ source"]
    E -->|PASSTHROUGH| G["fixInvalidId()\nnormalize chunk"]
    F --> H["hasValuableContent()\nfilter empty chunks"]
    G --> H
    H -->|"Has content"| I["extractUsage()\ntrack token counts"]
    H -->|"Empty"| J["Skip chunk"]
    I --> K["formatSSE()\nserialize + clean perf_metrics"]
    K --> L["TextEncoder\n(per-stream instance)"]
    L --> M["Enqueue to\nclient stream"]

    style A fill:#f9f,stroke:#333
    style M fill:#9f9,stroke:#333
```

#### ìš”ì²­ ë¡œê±° ì„¸ì…˜ êµ¬ì¡°

```
logs/
â””â”€â”€ claude_gemini_claude-sonnet_20260208_143045/
    â”œâ”€â”€ 1_req_client.json      â† Raw client request
    â”œâ”€â”€ 2_req_source.json      â† After initial conversion
    â”œâ”€â”€ 3_req_openai.json      â† OpenAI intermediate format
    â”œâ”€â”€ 4_req_target.json      â† Final target format
    â”œâ”€â”€ 5_res_provider.txt     â† Provider SSE chunks (streaming)
    â”œâ”€â”€ 5_res_provider.json    â† Provider response (non-streaming)
    â”œâ”€â”€ 6_res_openai.txt       â† OpenAI intermediate chunks
    â”œâ”€â”€ 7_res_client.txt       â† Client-facing SSE chunks
    â””â”€â”€ 6_error.json           â† Error details (if any)
```

---

### 4.7 ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ(`src/`)

| ë””ë ‰í† ë¦¬      | ëª©ì                                                                 |
| ------------- | ------------------------------------------------------------------- |
| `src/app/`    | ì›¹ UI, API ê²½ë¡œ, Express ë¯¸ë“¤ì›¨ì–´, OAuth ì½œë°± í•¸ë“¤ëŸ¬                |
| `src/lib/`    | ë°ì´í„°ë² ì´ìŠ¤ ì•¡ì„¸ìŠ¤(`localDb.ts`, `usageDb.ts`), ì¸ì¦, ê³µìœ          |
| `src/mitm/`   | ê³µê¸‰ì íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ê¸° ìœ„í•œ ì¤‘ê°„ì í”„ë¡ì‹œ ìœ í‹¸ë¦¬í‹°                |
| `src/models/` | ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ì •ì˜                                              |
| `src/shared/` | open-sse í•¨ìˆ˜ì— ëŒ€í•œ ë˜í¼(ê³µê¸‰ì, ìŠ¤íŠ¸ë¦¼, ì˜¤ë¥˜ ë“±)                  |
| `src/sse/`    | open-sse ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ Express ê²½ë¡œì— ì—°ê²°í•˜ëŠ” SSE ì—”ë“œí¬ì¸íŠ¸ í•¸ë“¤ëŸ¬ |
| `src/store/`  | ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ê´€ë¦¬                                              |

#### ì£¼ëª©í• ë§Œí•œ API ê²½ë¡œ

| ê²½ë¡œ                                          | ë°©ë²•               | ëª©ì                                                                              |
| --------------------------------------------- | ------------------ | -------------------------------------------------------------------------------- |
| `/api/provider-models`                        | ê°€ì ¸ì˜¤ê¸°/ê²Œì‹œ/ì‚­ì œ | ê³µê¸‰ìë³„ ì‚¬ìš©ì ì •ì˜ ëª¨ë¸ì„ ìœ„í•œ CRUD                                            |
| `/api/models/catalog`                         | ë°›ê¸°               | ê³µê¸‰ìë³„ë¡œ ê·¸ë£¹í™”ëœ ëª¨ë“  ëª¨ë¸(ì±„íŒ…, ì„ë² ë”©, ì´ë¯¸ì§€, ì‚¬ìš©ì ì •ì˜)ì˜ ì§‘ê³„ ì¹´íƒˆë¡œê·¸ |
| `/api/settings/proxy`                         | ê°€ì ¸ì˜¤ê¸°/ë„£ê¸°/ì‚­ì œ | ê³„ì¸µì  ì•„ì›ƒë°”ìš´ë“œ í”„ë¡ì‹œ êµ¬ì„±(`global/providers/combos/keys`)                    |
| `/api/settings/proxy/test`                    | í¬ìŠ¤íŠ¸             | í”„ë¡ì‹œ ì—°ê²°ì„ í™•ì¸í•˜ê³  ê³µìš© IP/ì§€ì—° ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.                           |
| `/v1/providers/[provider]/chat/completions`   | í¬ìŠ¤íŠ¸             | ëª¨ë¸ ê²€ì¦ì„ í†µí•œ ì œê³µì—…ì²´ë³„ ì „ìš© ì±„íŒ… ì™„ë£Œ                                       |
| `/v1/providers/[provider]/embeddings`         | í¬ìŠ¤íŠ¸             | ëª¨ë¸ ê²€ì¦ì„ í†µí•œ ì œê³µìë³„ ì „ìš© ì„ë² ë”©                                            |
| `/v1/providers/[provider]/images/generations` | í¬ìŠ¤íŠ¸             | ëª¨ë¸ ê²€ì¦ì„ í†µí•œ ì œê³µìë³„ ì „ìš© ì´ë¯¸ì§€ ìƒì„±                                       |
| `/api/settings/ip-filter`                     | ê°€ì ¸ì˜¤ê¸°/ë„£ê¸°      | IP í—ˆìš© ëª©ë¡/ì°¨ë‹¨ ëª©ë¡ ê´€ë¦¬                                                      |
| `/api/settings/thinking-budget`               | ê°€ì ¸ì˜¤ê¸°/ë„£ê¸°      | í† í° ì˜ˆì‚° êµ¬ì„± ì¶”ë¡ (í†µê³¼/ìë™/ë§ì¶¤/ì ì‘)                                         |
| `/api/settings/system-prompt`                 | ê°€ì ¸ì˜¤ê¸°/ë„£ê¸°      | ëª¨ë“  ìš”ì²­ì— â€‹â€‹ëŒ€í•´ ê¸€ë¡œë²Œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì£¼ì…                                   |
| `/api/sessions`                               | ë°›ê¸°               | í™œì„± ì„¸ì…˜ ì¶”ì  ë° ì¸¡ì •í•­ëª©                                                       |
| `/api/rate-limits`                            | ë°›ê¸°               | ê³„ì •ë³„ ë¹„ìœ¨í•œë„ í˜„í™©                                                             |

---

## 5. ì£¼ìš” ë””ìì¸ íŒ¨í„´

### 5.1 í—ˆë¸Œ ì•¤ ìŠ¤í¬í¬ ë²ˆì—­

ëª¨ë“  í˜•ì‹ì€ **OpenAI í˜•ì‹ì„ í—ˆë¸Œ**ë¡œ í†µí•´ ë³€í™˜ë©ë‹ˆë‹¤. ìƒˆ ê³µê¸‰ìë¥¼ ì¶”ê°€í•˜ë ¤ë©´ N ìŒì´ ì•„ë‹Œ **í•œ ìŒ**ì˜ ë²ˆì—­ê¸°(OpenAI ê°„)ë§Œ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.

### 5.2 ì‹¤í–‰ì ì „ëµ íŒ¨í„´

ê° ê³µê¸‰ìì—ëŠ” `BaseExecutor`ì—ì„œ ìƒì†ë˜ëŠ” ì „ìš© ì‹¤í–‰ì í´ë˜ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤. `executors/index.ts`ì˜ íŒ©í† ë¦¬ëŠ” ëŸ°íƒ€ì„ ì‹œ ì˜¬ë°”ë¥¸ íŒ©í† ë¦¬ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

### 5.3 ìì²´ ë“±ë¡ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ

ë²ˆì—­ê¸° ëª¨ë“ˆì€ `register()`ì„ í†µí•´ ê°€ì ¸ì˜¬ ë•Œ ìì²´ì ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ ë²ˆì—­ìë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ íŒŒì¼ì„ ìƒì„±í•˜ê³  ê°€ì ¸ì˜¤ëŠ” ê²ƒë¿ì…ë‹ˆë‹¤.

### 5.4 ì§€ìˆ˜ ë°±ì˜¤í”„ë¥¼ ì‚¬ìš©í•œ ê³„ì • ëŒ€ì²´

ê³µê¸‰ìê°€ 429/401/500ì„ ë°˜í™˜í•˜ë©´ ì‹œìŠ¤í…œì€ ì§€ìˆ˜ ì¿¨ë‹¤ìš´(1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ â†’ ìµœëŒ€ 2ë¶„)ì„ ì ìš©í•˜ì—¬ ë‹¤ìŒ ê³„ì •ìœ¼ë¡œ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 5.5 ì½¤ë³´ ëª¨ë¸ ì²´ì¸

"ì½¤ë³´"ëŠ” ì—¬ëŸ¬ `provider/model` ë¬¸ìì—´ì„ ê·¸ë£¹í™”í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ ì‘ì—…ì´ ì‹¤íŒ¨í•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—…ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.

### 5.6 ìƒíƒœ ì €ì¥ ìŠ¤íŠ¸ë¦¬ë° ë³€í™˜

ì‘ë‹µ ë³€í™˜ì€ `initState()` ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ SSE ì²­í¬(ì‚¬ê³  ë¸”ë¡ ì¶”ì , ë„êµ¬ í˜¸ì¶œ ì¶•ì , ì½˜í…ì¸  ë¸”ë¡ ì¸ë±ì‹±) ì „ì²´ì—ì„œ ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

### 5.7 ì‚¬ìš© ì•ˆì „ ë²„í¼

í´ë¼ì´ì–¸íŠ¸ê°€ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë° í˜•ì‹ ë³€í™˜ì˜ ì˜¤ë²„í—¤ë“œë¡œ ì¸í•´ ì»¨í…ìŠ¤íŠ¸ ì°½ ì œí•œì— ë„ë‹¬í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë³´ê³ ëœ ì‚¬ìš©ëŸ‰ì— 2000í† í° ë²„í¼ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## 6. ì§€ì›ë˜ëŠ” í˜•ì‹

| í˜•ì‹             | ë°©í–¥        | ì‹ë³„ì             |
| ---------------- | ----------- | ------------------ |
| OpenAI ì±„íŒ… ì™„ë£Œ | ì†ŒìŠ¤ + íƒ€ê²Ÿ | `openai`           |
| OpenAI ì‘ë‹µ API  | ì†ŒìŠ¤ + íƒ€ê²Ÿ | `openai-responses` |
| ì¸ë¥˜í•™ í´ë¡œë“œ    | ì†ŒìŠ¤ + íƒ€ê²Ÿ | `claude`           |
| êµ¬ê¸€ ì œë¯¸ë‹ˆ      | ì†ŒìŠ¤ + íƒ€ê²Ÿ | `gemini`           |
| êµ¬ê¸€ ì œë¯¸ë‹ˆ CLI  | ëŒ€ìƒë§Œ      | `gemini-cli`       |
| ë°˜ì¤‘ë ¥           | ì†ŒìŠ¤ + íƒ€ê²Ÿ | `antigravity`      |
| AWS í‚¤ë¡œ         | ëŒ€ìƒë§Œ      | `kiro`             |
| ì»¤ì„œ             | ëŒ€ìƒë§Œ      | `cursor`           |

---

## 7. ì§€ì›ë˜ëŠ” ê³µê¸‰ì

| ê³µê¸‰ì                   | ì¸ì¦ ë°©ë²•              | ì§‘í–‰ì    | ì£¼ìš” ë‚´ìš©                                   |
| ------------------------ | ---------------------- | --------- | ------------------------------------------- |
| ì¸ë¥˜í•™ í´ë¡œë“œ            | API í‚¤ ë˜ëŠ” OAuth      | ê¸°ë³¸ê°’    | `x-api-key` í—¤ë” ì‚¬ìš©                       |
| êµ¬ê¸€ ì œë¯¸ë‹ˆ              | API í‚¤ ë˜ëŠ” OAuth      | ê¸°ë³¸ê°’    | `x-goog-api-key` í—¤ë” ì‚¬ìš©                  |
| êµ¬ê¸€ ì œë¯¸ë‹ˆ CLI          | OAuth                  | ìŒë‘¥ì´CLI | `streamGenerateContent` ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©     |
| ë°˜ì¤‘ë ¥                   | OAuth                  | ë°˜ì¤‘ë ¥    | ë‹¤ì¤‘ URL ëŒ€ì²´, ì‚¬ìš©ì ì •ì˜ ì¬ì‹œë„ êµ¬ë¬¸ ë¶„ì„ |
| ì˜¤í”ˆAI                   | API í‚¤                 | ê¸°ë³¸ê°’    | í‘œì¤€ ë¬´ê¸°ëª… ì¸ì¦                            |
| ì½”ë±ìŠ¤                   | OAuth                  | ì½”ë±ìŠ¤    | ì‹œìŠ¤í…œ ì§€ì¹¨ ì£¼ì…, â€‹â€‹ì‚¬ê³  ê´€ë¦¬               |
| GitHub ë¶€ì¡°ì¢…ì‚¬          | OAuth + Copilot í† í°   | ê¹ƒí—ˆë¸Œ    | ë“€ì–¼ í† í°, VSCode í—¤ë” ëª¨ë°©                 |
| í‚¤ë¡œ(AWS)                | AWS SSO OIDC ë˜ëŠ” ì†Œì…œ | í‚¤ë¡œ      | ë°”ì´ë„ˆë¦¬ EventStream êµ¬ë¬¸ ë¶„ì„              |
| ì»¤ì„œ IDE                 | ì²´í¬ì„¬ ì¸ì¦            | ì»¤ì„œ      | Protobuf ì¸ì½”ë”©, SHA-256 ì²´í¬ì„¬             |
| í€€                       | OAuth                  | ê¸°ë³¸ê°’    | í‘œì¤€ ì¸ì¦                                   |
| ì•„ì´í”Œë¡œìš°               | OAuth(ê¸°ë³¸ + ì „ë‹¬ì)   | ê¸°ë³¸ê°’    | ì´ì¤‘ ì¸ì¦ í—¤ë”                              |
| ì˜¤í”ˆë¼ìš°í„°               | API í‚¤                 | ê¸°ë³¸ê°’    | í‘œì¤€ ë¬´ê¸°ëª… ì¸ì¦                            |
| GLM, í‚¤ë¯¸, ë¯¸ë‹ˆë§¥ìŠ¤      | API í‚¤                 | ê¸°ë³¸ê°’    | Claude í˜¸í™˜, `x-api-key` ì‚¬ìš©               |
| `openai-compatible-*`    | API í‚¤                 | ê¸°ë³¸ê°’    | ë™ì : ëª¨ë“  OpenAI í˜¸í™˜ ì—”ë“œí¬ì¸íŠ¸           |
| `anthropic-compatible-*` | API í‚¤                 | ê¸°ë³¸ê°’    | ë™ì : Claudeì™€ í˜¸í™˜ë˜ëŠ” ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸     |

---

## 8. ë°ì´í„° íë¦„ ìš”ì•½

### ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource â†’ OpenAI â†’ target"]
    C --> D["Executor\nbuildUrl + buildHeaders"]
    D --> E["fetch(providerURL)"]
    E --> F["createSSEStream()\nTRANSLATE mode"]
    F --> G["parseSSELine()"]
    G --> H["translateResponse()\ntarget â†’ OpenAI â†’ source"]
    H --> I["extractUsage()\n+ addBuffer"]
    I --> J["formatSSE()"]
    J --> K["Client receives\ntranslated SSE"]
    K --> L["logUsage()\nsaveRequestUsage()"]
```

### ë¹„ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource â†’ OpenAI â†’ target"]
    C --> D["Executor.execute()"]
    D --> E["translateResponse()\ntarget â†’ OpenAI â†’ source"]
    E --> F["Return JSON\nresponse"]
```

### ìš°íšŒ íë¦„(Claude CLI)

```mermaid
flowchart LR
    A["Claude CLI request"] --> B{"Match bypass\npattern?"}
    B -->|"Title/Warmup/Count"| C["Generate fake\nOpenAI response"]
    B -->|"No match"| D["Normal flow"]
    C --> E["Translate to\nsource format"]
    E --> F["Return without\ncalling provider"]
```
