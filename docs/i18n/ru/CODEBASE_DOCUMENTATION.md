# omniroute ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

üåê **Languages:** üá∫üá∏ [English](../../CODEBASE_DOCUMENTATION.md) | üáßüá∑ [Portugu√™s (Brasil)](../pt-BR/CODEBASE_DOCUMENTATION.md) | üá™üá∏ [Espa√±ol](../es/CODEBASE_DOCUMENTATION.md) | üá´üá∑ [Fran√ßais](../fr/CODEBASE_DOCUMENTATION.md) | üáÆüáπ [Italiano](../it/CODEBASE_DOCUMENTATION.md) | üá∑üá∫ [–†—É—Å—Å–∫–∏–π](../ru/CODEBASE_DOCUMENTATION.md) | üá®üá≥ [‰∏≠Êñá (ÁÆÄ‰Ωì)](../zh-CN/CODEBASE_DOCUMENTATION.md) | üá©üá™ [Deutsch](../de/CODEBASE_DOCUMENTATION.md) | üáÆüá≥ [‡§π‡§ø‡§®‡•ç‡§¶‡•Ä](../in/CODEBASE_DOCUMENTATION.md) | üáπüá≠ [‡πÑ‡∏ó‡∏¢](../th/CODEBASE_DOCUMENTATION.md) | üá∫üá¶ [–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞](../uk-UA/CODEBASE_DOCUMENTATION.md) | üá∏üá¶ [ÿßŸÑÿπÿ±ÿ®Ÿäÿ©](../ar/CODEBASE_DOCUMENTATION.md) | üáØüáµ [Êó•Êú¨Ë™û](../ja/CODEBASE_DOCUMENTATION.md) | üáªüá≥ [Ti·∫øng Vi·ªát](../vi/CODEBASE_DOCUMENTATION.md) | üáßüá¨ [–ë—ä–ª–≥–∞—Ä—Å–∫–∏](../bg/CODEBASE_DOCUMENTATION.md) | üá©üá∞ [Dansk](../da/CODEBASE_DOCUMENTATION.md) | üá´üáÆ [Suomi](../fi/CODEBASE_DOCUMENTATION.md) | üáÆüá± [◊¢◊ë◊®◊ô◊™](../he/CODEBASE_DOCUMENTATION.md) | üá≠üá∫ [Magyar](../hu/CODEBASE_DOCUMENTATION.md) | üáÆüá© [Bahasa Indonesia](../id/CODEBASE_DOCUMENTATION.md) | üá∞üá∑ [ÌïúÍµ≠Ïñ¥](../ko/CODEBASE_DOCUMENTATION.md) | üá≤üáæ [Bahasa Melayu](../ms/CODEBASE_DOCUMENTATION.md) | üá≥üá± [Nederlands](../nl/CODEBASE_DOCUMENTATION.md) | üá≥üá¥ [Norsk](../no/CODEBASE_DOCUMENTATION.md) | üáµüáπ [Portugu√™s (Portugal)](../pt/CODEBASE_DOCUMENTATION.md) | üá∑üá¥ [Rom√¢nƒÉ](../ro/CODEBASE_DOCUMENTATION.md) | üáµüá± [Polski](../pl/CODEBASE_DOCUMENTATION.md) | üá∏üá∞ [Slovenƒçina](../sk/CODEBASE_DOCUMENTATION.md) | üá∏üá™ [Svenska](../sv/CODEBASE_DOCUMENTATION.md) | üáµüá≠ [Filipino](../phi/CODEBASE_DOCUMENTATION.md)

> –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –ø–æ **omniroute** –ø—Ä–æ–∫—Å–∏-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—É —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, —Ä–∞–±–æ—Ç–∞—é—â–∏–º –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ –æ–º–Ω–∏—Ä—É—Ç?

omniroute ‚Äî —ç—Ç–æ **–ø—Ä–æ–∫—Å–∏-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä**, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –ò–ò (Claude CLI, Codex, Cursor IDE –∏ —Ç.¬†–¥.) –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏ –ò–ò (Anthropic, Google, OpenAI, AWS, GitHub –∏¬†—Ç.¬†–¥.). –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –±–æ–ª—å—à—É—é –ø—Ä–æ–±–ª–µ–º—É:

> **–†–∞–∑–ª–∏—á–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ò–ò –≥–æ–≤–æ—Ä—è—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö ¬´—è–∑—ã–∫–∞—Ö¬ª (—Ñ–æ—Ä–º–∞—Ç–∞—Ö API), –∏ —Ä–∞–∑–Ω—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –ò–ò —Ç–æ–∂–µ –æ–∂–∏–¥–∞—é—Ç —Ä–∞–∑–Ω—ã—Ö ¬´—è–∑—ã–∫–æ–≤¬ª.** omniroute –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –º–µ–∂–¥—É –Ω–∏–º–∏.

–î—É–º–∞–π—Ç–µ –æ–± —ç—Ç–æ–º –∫–∞–∫ –æ–± —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–µ –≤ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –ù–∞—Ü–∏–π: –ª—é–±–æ–π –¥–µ–ª–µ–≥–∞—Ç –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ, –∞ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –µ–≥–æ –¥–ª—è –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –¥–µ–ª–µ–≥–∞—Ç–∞.

---

## 2. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```mermaid
graph LR
    subgraph Clients
        A[Claude CLI]
        B[Codex]
        C[Cursor IDE]
        D[OpenAI-compatible]
    end

    subgraph omniroute
        E[Handler Layer]
        F[Translator Layer]
        G[Executor Layer]
        H[Services Layer]
    end

    subgraph Providers
        I[Anthropic Claude]
        J[Google Gemini]
        K[OpenAI / Codex]
        L[GitHub Copilot]
        M[AWS Kiro]
        N[Antigravity]
        O[Cursor API]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    G --> I
    G --> J
    G --> K
    G --> L
    G --> M
    G --> N
    G --> O
    H -.-> E
    H -.-> G
```

### –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥

–í—Å—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ **—Ñ–æ—Ä–º–∞—Ç OpenAI –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç–æ—Ä–∞**:

```
Client Format ‚Üí [OpenAI Hub] ‚Üí Provider Format    (request)
Provider Format ‚Üí [OpenAI Hub] ‚Üí Client Format    (response)
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ **N —Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä–æ–≤** (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç) –≤–º–µ—Å—Ç–æ **N¬≤** (–∫–∞–∂–¥–∞—è –ø–∞—Ä–∞).

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
omniroute/
‚îú‚îÄ‚îÄ open-sse/                  ‚Üê Core proxy library (portable, framework-agnostic)
‚îÇ   ‚îú‚îÄ‚îÄ index.js               ‚Üê Main entry point, exports everything
‚îÇ   ‚îú‚îÄ‚îÄ config/                ‚Üê Configuration & constants
‚îÇ   ‚îú‚îÄ‚îÄ executors/             ‚Üê Provider-specific request execution
‚îÇ   ‚îú‚îÄ‚îÄ handlers/              ‚Üê Request handling orchestration
‚îÇ   ‚îú‚îÄ‚îÄ services/              ‚Üê Business logic (auth, models, fallback, usage)
‚îÇ   ‚îú‚îÄ‚îÄ translator/            ‚Üê Format translation engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request/           ‚Üê Request translators (8 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ response/          ‚Üê Response translators (7 files)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers/           ‚Üê Shared translation utilities (6 files)
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 ‚Üê Utility functions
‚îú‚îÄ‚îÄ src/                       ‚Üê Application layer (Express/Worker runtime)
‚îÇ   ‚îú‚îÄ‚îÄ app/                   ‚Üê Web UI, API routes, middleware
‚îÇ   ‚îú‚îÄ‚îÄ lib/                   ‚Üê Database, auth, and shared library code
‚îÇ   ‚îú‚îÄ‚îÄ mitm/                  ‚Üê Man-in-the-middle proxy utilities
‚îÇ   ‚îú‚îÄ‚îÄ models/                ‚Üê Database models
‚îÇ   ‚îú‚îÄ‚îÄ shared/                ‚Üê Shared utilities (wrappers around open-sse)
‚îÇ   ‚îú‚îÄ‚îÄ sse/                   ‚Üê SSE endpoint handlers
‚îÇ   ‚îî‚îÄ‚îÄ store/                 ‚Üê State management
‚îú‚îÄ‚îÄ data/                      ‚Üê Runtime data (credentials, logs)
‚îÇ   ‚îî‚îÄ‚îÄ provider-credentials.json   (external credentials override, gitignored)
‚îî‚îÄ‚îÄ tester/                    ‚Üê Test utilities
```

---

## 4. –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –º–æ–¥—É–ª—è–º

### 4.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`open-sse/config/`)

**–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

| –§–∞–π–ª                          | –¶–µ–ª—å                                                                                                                                                                                                                                                             |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constants.ts`                | –û–±—ä–µ–∫—Ç `PROVIDERS` —Å –±–∞–∑–æ–≤—ã–º–∏ URL-–∞–¥—Ä–µ—Å–∞–º–∏, —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ OAuth (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞. –¢–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `HTTP_STATUS`, `ERROR_TYPES`, `COOLDOWN_MS`, `BACKOFF_CONFIG` –∏ `SKIP_PATTERNS`. |
| `credentialLoader.ts`         | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `data/provider-credentials.json` –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö —Å –∂–µ—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ `PROVIDERS`. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.                       |
| `providerModels.ts`           | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –º–æ–¥–µ–ª–µ–π: –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∫–∞—Ä—Ç ‚Üí –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –º–æ–¥–µ–ª–µ–π. –¢–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ `getModels()`, `getProviderByAlias()`.                                                                                                                      |
| `codexInstructions.ts`        | –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –≤–Ω–µ–¥—Ä—è–µ–º—ã–µ –≤ –∑–∞–ø—Ä–æ—Å—ã –ö–æ–¥–µ–∫—Å–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Å–æ—á–Ω–∏—Ü—ã, –ø–æ–ª–∏—Ç–∏–∫–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è).                                                                                                                                        |
| `defaultThinkingSignature.ts` | ¬´–ú—ã—Å–ª—è—â–∏–µ¬ª –ø–æ–¥–ø–∏—Å–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –º–æ–¥–µ–ª–µ–π Claude –∏ Gemini.                                                                                                                                                                                                     |
| `ollamaModels.ts`             | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –û–ª–ª–∞–º—ã (–∏–º—è, —Ä–∞–∑–º–µ—Ä, —Å–µ–º–µ–π—Å—Ç–≤–æ, –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ).                                                                                                                                                                            |

#### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```mermaid
flowchart TD
    A["App starts"] --> B["constants.ts defines PROVIDERS\nwith hardcoded defaults"]
    B --> C{"data/provider-credentials.json\nexists?"}
    C -->|Yes| D["credentialLoader reads JSON"]
    C -->|No| E["Use hardcoded defaults"]
    D --> F{"For each provider in JSON"}
    F --> G{"Provider exists\nin PROVIDERS?"}
    G -->|No| H["Log warning, skip"]
    G -->|Yes| I{"Value is object?"}
    I -->|No| J["Log warning, skip"]
    I -->|Yes| K["Merge clientId, clientSecret,\ntokenUrl, authUrl, refreshUrl"]
    K --> F
    H --> F
    J --> F
    F -->|Done| L["PROVIDERS ready with\nmerged credentials"]
    E --> L
```

---

### 4.2 –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (`open-sse/executors/`)

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç **–ª–æ–≥–∏–∫—É, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞**, –∏—Å–ø–æ–ª—å–∑—É—è **–®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**. –ö–∞–∂–¥—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

```mermaid
classDiagram
    class BaseExecutor {
        +buildUrl(model, stream, options)
        +buildHeaders(credentials, stream, body)
        +transformRequest(body, model, stream, credentials)
        +execute(url, options)
        +shouldRetry(status, error)
        +refreshCredentials(credentials, log)
    }

    class DefaultExecutor {
        +refreshCredentials()
    }

    class AntigravityExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +shouldRetry()
        +refreshCredentials()
    }

    class CursorExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseResponse()
        +generateChecksum()
    }

    class KiroExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseEventStream()
        +refreshCredentials()
    }

    BaseExecutor <|-- DefaultExecutor
    BaseExecutor <|-- AntigravityExecutor
    BaseExecutor <|-- CursorExecutor
    BaseExecutor <|-- KiroExecutor
    BaseExecutor <|-- CodexExecutor
    BaseExecutor <|-- GeminiCLIExecutor
    BaseExecutor <|-- GithubExecutor
```

| –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å      | –ü—Ä–æ–≤–∞–π–¥–µ—Ä                                   | –ö–ª—é—á–µ–≤—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏                                                                                                                                                               |
| ---------------- | ------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `base.ts`        | ‚Äî                                           | –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è –±–∞–∑–∞: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL-–∞–¥—Ä–µ—Å–æ–≤, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö                                                                                      |
| `default.ts`     | –ö–ª–æ–¥, –ë–ª–∏–∑–Ω–µ—Ü—ã, OpenAI, GLM, –ö–∏–º–∏, –ú–∏–Ω–∏–ú–∞–∫—Å | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ OAuth –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤                                                                                                                           |
| `antigravity.ts` | –û–±–ª–∞—á–Ω—ã–π –∫–æ–¥ Google                         | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞/—Å–µ–∞–Ω—Å–∞, —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö URL-–∞–¥—Ä–µ—Å–æ–≤, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö (¬´—Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ 7 –º–∏–Ω—É—Ç 23 —Å–µ–∫—É–Ω–¥—ã¬ª) |
| `cursor.ts`      | –ö—É—Ä—Å–æ—Ä IDE                                  | **–°–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–µ SHA-256, –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ Protobuf, –¥–≤–æ–∏—á–Ω—ã–π –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π ‚Üí –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ SSE                                       |
| `codex.ts`       | –ö–æ–¥–µ–∫—Å OpenAI                               | –í–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —É–ø—Ä–∞–≤–ª—è–µ—Ç —É—Ä–æ–≤–Ω—è–º–∏ –º—ã—à–ª–µ–Ω–∏—è, —É–¥–∞–ª—è–µ—Ç –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã                                                                                         |
| `gemini-cli.ts`  | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ Google Gemini    | –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ URL-–∞–¥—Ä–µ—Å–∞ (`streamGenerateContent`), –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ Google OAuth                                                                                           |
| `github.ts`      | –í—Ç–æ—Ä–æ–π –ø–∏–ª–æ—Ç GitHub                         | –°–∏—Å—Ç–µ–º–∞ –¥–≤—É—Ö —Ç–æ–∫–µ–Ω–æ–≤ (GitHub OAuth + —Ç–æ–∫–µ–Ω Copilot), –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ VSCode                                                                                                       |
| `kiro.ts`        | AWS CodeWhisperer                           | –ë–∏–Ω–∞—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ AWS EventStream, –∫–∞–¥—Ä—ã —Å–æ–±—ã—Ç–∏–π AMZN, –æ—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤                                                                                                                  |
| `index.ts`       | ‚Äî                                           | –§–∞–±—Ä–∏–∫–∞: –∏–º—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –∫–∞—Ä—Ç ‚Üí –∫–ª–∞—Å—Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                                                                                                 |

---

### 4.3 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`open-sse/handlers/`)

**–£—Ä–æ–≤–µ–Ω—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.

| –§–∞–π–ª                  | –¶–µ–ª—å                                                                                                                                                                                                                                              |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chatCore.ts`         | **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** (~600 —Å—Ç—Ä–æ–∫). –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ ‚Üí —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ‚Üí –ø–æ—Ç–æ–∫–æ–≤—ã–π/–Ω–µ–ø–æ—Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Üí –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. |
| `responsesHandler.ts` | –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è API –æ—Ç–≤–µ—Ç–æ–≤ OpenAI: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è —á–∞—Ç–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `chatCore` ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç SSE –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤.                                                                                                |
| `embeddings.ts`       | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –º–æ–¥–µ–ª—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è ‚Üí –ø–æ—Å—Ç–∞–≤—â–∏–∫, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ API –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å OpenAI. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 6+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.                                                            |
| `imageGeneration.ts`  | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –ø–æ—Å—Ç–∞–≤—â–∏–∫, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º—ã OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π, Gemini-image (–ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è) –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º (Nebius). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64 –∏–ª–∏ URL.                   |

#### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞ (chatCore.ts)

```mermaid
sequenceDiagram
    participant Client
    participant chatCore
    participant Translator
    participant Executor
    participant Provider

    Client->>chatCore: Request (any format)
    chatCore->>chatCore: Detect source format
    chatCore->>chatCore: Check bypass patterns
    chatCore->>chatCore: Resolve model & provider
    chatCore->>Translator: Translate request (source ‚Üí OpenAI ‚Üí target)
    chatCore->>Executor: Get executor for provider
    Executor->>Executor: Build URL, headers, transform request
    Executor->>Executor: Refresh credentials if needed
    Executor->>Provider: HTTP fetch (streaming or non-streaming)

    alt Streaming
        Provider-->>chatCore: SSE stream
        chatCore->>chatCore: Pipe through SSE transform stream
        Note over chatCore: Transform stream translates<br/>each chunk: target ‚Üí OpenAI ‚Üí source
        chatCore-->>Client: Translated SSE stream
    else Non-streaming
        Provider-->>chatCore: JSON response
        chatCore->>Translator: Translate response
        chatCore-->>Client: Translated JSON
    end

    alt Error (401, 429, 500...)
        chatCore->>Executor: Retry with credential refresh
        chatCore->>chatCore: Account fallback logic
    end
```

---

### 4.4 –£—Å–ª—É–≥–∏ (`open-sse/services/`)

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏.

| –§–∞–π–ª                 | –¶–µ–ª—å                                                                                                                                                                                                                                                                                                                                                                      |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `provider.ts`        | **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞** (`detectFormat`): –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ Claude/OpenAI/Gemini/Antigravity/Responses (–≤–∫–ª—é—á–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫—É `max_tokens` –¥–ª—è Claude). –ê —Ç–∞–∫–∂–µ: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º—ã—à–ª–µ–Ω–∏—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ `openai-compatible-*` –∏ `anthropic-compatible-*`. |
| `model.ts`           | –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–æ–∫–∏ –º–æ–¥–µ–ª–∏ (`claude/model-name` ‚Üí `{provider: "claude", model: "model-name"}`), —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ —Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º –∫–æ–ª–ª–∏–∑–∏–π, –æ—á–∏—Å—Ç–∫–∞ –≤–≤–æ–¥–∞ (–æ—Ç–∫–ª–æ–Ω—è–µ—Ç –æ–±—Ö–æ–¥ –ø—É—Ç–∏/—É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã) –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤.                                                                                 |
| `accountFallback.ts` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ç—Å—Ä–æ—á–∫–∞ (1 —Å ‚Üí 2 —Å ‚Üí 4 —Å ‚Üí –º–∞–∫—Å–∏–º—É–º 2 –º–∏–Ω—É—Ç—ã), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ (–∫–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç –æ—Ç–∫–∞—Ç, –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç).                                                                                                                                                      |
| `tokenRefresh.ts`    | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ OAuth –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞**: Google (Gemini, Antigravity), Claude, Codex, Qwen, iFlow, GitHub (OAuth + –¥–≤–æ–π–Ω–æ–π —Ç–æ–∫–µ–Ω Copilot), Kiro (AWS SSO OIDC + Social Auth). –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∫—ç—à –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –æ–±–µ—â–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.                                                                   |
| `combo.ts`           | **–ö–æ–º–±–æ-–º–æ–¥–µ–ª–∏**: —Ü–µ–ø–æ—á–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –ï—Å–ª–∏ –º–æ–¥–µ–ª—å A –¥–∞–µ—Ç —Å–±–æ–π –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏, –¥–æ–ø—É—Å–∫–∞—é—â–µ–π –≤–æ–∑–≤—Ä–∞—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –º–æ–¥–µ–ª—å B, –∑–∞—Ç–µ–º C –∏ —Ç. –¥. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞.                                                                                                                                                                    |
| `usage.ts`           | –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –∫–≤–æ—Ç–∞—Ö/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–∑ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–∫–≤–æ—Ç—ã GitHub Copilot, –∫–≤–æ—Ç—ã –º–æ–¥–µ–ª–∏ Antigravity, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ö–æ–¥–µ–∫—Å–∞, —Ä–∞–∑–±–∏–≤–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Kiro, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Claude).                                                                                                                                                                      |
| `accountSelector.ts` | –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –æ—Ü–µ–Ω–∫–∏: —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è, –ø–æ–∑–∏—Ü–∏—é —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.                                                                                                                                                  |
| `contextManager.ts`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞: —Å–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–µ) –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è.                                                                                                                                                      |
| `ipFilter.ts`        | –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ IP: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º—ã –±–µ–ª–æ–≥–æ –∏ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤ API.                                                                                                                                                                                                |
| `sessionManager.ts`  | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é —Å–Ω—è—Ç–∏—è –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤ –ø–∞–ª—å—Ü–µ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–∞–Ω—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–µ–∞–Ω—Å–æ–≤.                                                                                                                                                   |
| `signatureCache.ts`  | –ö—ç—à –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–≥–Ω–∞—Ç—É—Ä –∑–∞–ø—Ä–æ—Å–æ–≤: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å—á–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞.                                                                                                                                          |
| `systemPrompt.ts`    | –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.                                                                                                                                                                                              |
| `thinkingBudget.ts`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–º —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∫–≤–æ–∑–Ω–æ–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –º—ã—à–ª–µ–Ω–∏—è), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±—é–¥–∂–µ—Ç) –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏) —Ä–µ–∂–∏–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏ –º—ã—à–ª–µ–Ω–∏—è/—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è.                                                                                                                |
| `wildcardRouter.ts`  | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏: —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `*/claude-*`) –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä –ø–æ—Å—Ç–∞–≤—â–∏–∫/–º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.                                                                                                                                                                     |

#### –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

```mermaid
sequenceDiagram
    participant R1 as Request 1
    participant R2 as Request 2
    participant Cache as refreshPromiseCache
    participant OAuth as OAuth Provider

    R1->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: No in-flight promise
    Cache->>OAuth: Start refresh
    R2->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: Found in-flight promise
    Cache-->>R2: Return existing promise
    OAuth-->>Cache: New access token
    Cache-->>R1: New access token
    Cache-->>R2: Same access token (shared)
    Cache->>Cache: Delete cache entry
```

#### –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏

```mermaid
stateDiagram-v2
    [*] --> Active
    Active --> Error: Request fails (401/429/500)
    Error --> Cooldown: Apply backoff
    Cooldown --> Active: Cooldown expires
    Active --> Active: Request succeeds (reset backoff)

    state Error {
        [*] --> ClassifyError
        ClassifyError --> ShouldFallback: Rate limit / Auth / Transient
        ClassifyError --> NoFallback: 400 Bad Request
    }

    state Cooldown {
        [*] --> ExponentialBackoff
        ExponentialBackoff: Level 0 = 1s
        ExponentialBackoff: Level 1 = 2s
        ExponentialBackoff: Level 2 = 4s
        ExponentialBackoff: Max = 2min
    }
```

#### –ö–æ–º–±–æ-—Ü–µ–ø–æ—á–∫–∞ –º–æ–¥–µ–ª–µ–π

```mermaid
flowchart LR
    A["Request with\ncombo model"] --> B["Model A"]
    B -->|"2xx Success"| C["Return response"]
    B -->|"429/401/500"| D{"Fallback\neligible?"}
    D -->|Yes| E["Model B"]
    D -->|No| F["Return error"]
    E -->|"2xx Success"| C
    E -->|"429/401/500"| G{"Fallback\neligible?"}
    G -->|Yes| H["Model C"]
    G -->|No| F
    H -->|"2xx Success"| C
    H -->|"Fail"| I["All failed ‚Üí\nReturn last status"]
```

---

### 4.5 –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ (`open-sse/translator/`)

**–ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–≤–æ–¥–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤**, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–∏—Å—Ç–µ–º—É —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—â–∏—Ö—Å—è –ø–ª–∞–≥–∏–Ω–æ–≤.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    subgraph "Request Translation"
        A["Claude ‚Üí OpenAI"]
        B["Gemini ‚Üí OpenAI"]
        C["Antigravity ‚Üí OpenAI"]
        D["OpenAI Responses ‚Üí OpenAI"]
        E["OpenAI ‚Üí Claude"]
        F["OpenAI ‚Üí Gemini"]
        G["OpenAI ‚Üí Kiro"]
        H["OpenAI ‚Üí Cursor"]
    end

    subgraph "Response Translation"
        I["Claude ‚Üí OpenAI"]
        J["Gemini ‚Üí OpenAI"]
        K["Kiro ‚Üí OpenAI"]
        L["Cursor ‚Üí OpenAI"]
        M["OpenAI ‚Üí Claude"]
        N["OpenAI ‚Üí Antigravity"]
        O["OpenAI ‚Üí Responses"]
    end
```

| –ö–∞—Ç–∞–ª–æ–≥      | –§–∞–π–ª—ã          | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                                                                                                                                                                            |
| ------------ | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `request/`   | 8 –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤ | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–ª –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏. –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `register(from, to, fn)` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ.                                                                                                                                                                  |
| `response/`  | 7 –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤ | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π SSE, –±–ª–æ–∫–∏ –º—ã—à–ª–µ–Ω–∏—è, –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.                                                                                                                                                                    |
| `helpers/`   | 6 –ø–æ–º–æ—â–Ω–∏–∫–æ–≤   | –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã: `claudeHelper` (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º—ã—à–ª–µ–Ω–∏—è), `geminiHelper` (—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–µ–π/—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ), `openaiHelper` (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞), `toolCallHelper` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞, –≤—Å—Ç–∞–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞), `maxTokensHelper`, `responsesApiHelper`. |
| `index.ts`   | ‚Äî              | –ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–≤–æ–¥–∞: `translateRequest()`, `translateResponse()`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, —Ä–µ–µ—Å—Ç—Ä.                                                                                                                                                                                                      |
| `formats.ts` | ‚Äî              | –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞: `OPENAI`, `CLAUDE`, `GEMINI`, `ANTIGRAVITY`, `KIRO`, `CURSOR`, `OPENAI_RESPONSES`.                                                                                                                                                                                               |

#### –ö–ª—é—á–µ–≤–æ–π –¥–∏–∑–∞–π–Ω: —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ—Å—è –ø–ª–∞–≥–∏–Ω—ã

```javascript
// Each translator file calls register() on import:
import { register } from "../index.js";
register("claude", "openai", translateClaudeToOpenAI);

// The index.js imports all translator files, triggering registration:
import "./request/claude-to-openai.js"; // ‚Üê self-registers
```

---

### 4.6 –£—Ç–∏–ª–∏—Ç—ã (`open-sse/utils/`)

| –§–∞–π–ª               | –¶–µ–ª—å                                                                                                                                                                                                                                                                                                                                        |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `error.ts`         | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ–± –æ—à–∏–±–∫–∞—Ö (—Ñ–æ—Ä–º–∞—Ç, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å OpenAI), –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–≤—Ç–æ—Ä–∞ –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö, –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –æ—à–∏–±–æ–∫ SSE.                                                                                                                                           |
| `stream.ts`        | **SSE Transform Stream** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏. –î–≤–∞ —Ä–µ–∂–∏–º–∞: `TRANSLATE` (–ø–æ–ª–Ω–æ—Ñ–æ—Ä–º–∞—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥) –∏ `PASSTHROUGH` (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è + –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è). –£–ø—Ä–∞–≤–ª—è–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, –æ—Ü–µ–Ω–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –¥–ª–∏–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –≠–∫–∑–µ–º–ø–ª—è—Ä—ã –ø–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞/–¥–µ–∫–æ–¥–µ—Ä–∞ –∏–∑–±–µ–≥–∞—é—Ç –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. |
| `streamHelpers.ts` | –£—Ç–∏–ª–∏—Ç—ã SSE –Ω–∏–∑–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è: `parseSSELine` (—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω—ã–π –∫ –ø—Ä–æ–±–µ–ª–∞–º), `hasValuableContent` (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—É—Å—Ç—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–ª—è OpenAI/Claude/Gemini), `fixInvalidId`, `formatSSE` (—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è SSE —Å —É—á–µ—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π `perf_metrics`).                                                                                                 |
| `usageTracking.ts` | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (Claude/OpenAI/Gemini/Responses), –æ—Ü–µ–Ω–∫–∞ —Å –ø–æ–º–æ—â—å—é –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞/—Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ç–æ–∫–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ (–∑–∞–ø–∞—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ 2000 —Ç–æ–∫–µ–Ω–æ–≤), —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞, –≤–µ–¥–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –∫–æ–Ω—Å–æ–ª–∏ —Å —Ü–≤–µ—Ç–∞–º–∏ ANSI.                                          |
| `requestLogger.ts` | –í–µ–¥–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–π–ª–æ–≤ (—Å–æ–≥–ª–∞—Å–∏–µ —á–µ—Ä–µ–∑ `ENABLE_REQUEST_LOGS=true`). –°–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫–∏ —Å–µ–∞–Ω—Å–æ–≤ —Å –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏: `1_req_client.json` ‚Üí `7_res_client.txt`. –í–µ—Å—å –≤–≤–æ–¥-–≤—ã–≤–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º (–≤—ã—Å—Ç—Ä–µ–ª–∏–ª –∏ –∑–∞–±—ã–ª). –ú–∞—Å–∫–∏—Ä—É–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏.                                                            |
| `bypassHandler.ts` | –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∏–∑ Claude CLI (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø—Ä–æ–≥—Ä–µ–≤, –ø–æ–¥—Å—á–µ—Ç) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –≤—ã–∑–æ–≤–∞ –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –ø–æ—Ç–æ–∫–æ–≤—É—é, —Ç–∞–∫ –∏ –Ω–µ–ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É. –ù–∞–º–µ—Ä–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –æ–±–ª–∞—Å—Ç—å—é –¥–µ–π—Å—Ç–≤–∏—è Claude CLI.                                                                     |
| `networkProxy.ts`  | –†–∞–∑—Ä–µ—à–∞–µ—Ç URL-–∞–¥—Ä–µ—Å –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ‚Üí –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã (`HTTPS_PROXY`/`HTTP_PROXY`/`ALL_PROXY`). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è `NO_PROXY`. –ö—ç—à–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.                                                            |

#### –ü–æ—Ç–æ–∫–æ–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä SSE

```mermaid
flowchart TD
    A["Provider SSE stream"] --> B["TextDecoder\n(per-stream instance)"]
    B --> C["Buffer lines\n(split on newline)"]
    C --> D["parseSSELine()\n(trim whitespace, parse JSON)"]
    D --> E{"Mode?"}
    E -->|TRANSLATE| F["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E -->|PASSTHROUGH| G["fixInvalidId()\nnormalize chunk"]
    F --> H["hasValuableContent()\nfilter empty chunks"]
    G --> H
    H -->|"Has content"| I["extractUsage()\ntrack token counts"]
    H -->|"Empty"| J["Skip chunk"]
    I --> K["formatSSE()\nserialize + clean perf_metrics"]
    K --> L["TextEncoder\n(per-stream instance)"]
    L --> M["Enqueue to\nclient stream"]

    style A fill:#f9f,stroke:#333
    style M fill:#9f9,stroke:#333
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ–∞–Ω—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

```
logs/
‚îî‚îÄ‚îÄ claude_gemini_claude-sonnet_20260208_143045/
    ‚îú‚îÄ‚îÄ 1_req_client.json      ‚Üê Raw client request
    ‚îú‚îÄ‚îÄ 2_req_source.json      ‚Üê After initial conversion
    ‚îú‚îÄ‚îÄ 3_req_openai.json      ‚Üê OpenAI intermediate format
    ‚îú‚îÄ‚îÄ 4_req_target.json      ‚Üê Final target format
    ‚îú‚îÄ‚îÄ 5_res_provider.txt     ‚Üê Provider SSE chunks (streaming)
    ‚îú‚îÄ‚îÄ 5_res_provider.json    ‚Üê Provider response (non-streaming)
    ‚îú‚îÄ‚îÄ 6_res_openai.txt       ‚Üê OpenAI intermediate chunks
    ‚îú‚îÄ‚îÄ 7_res_client.txt       ‚Üê Client-facing SSE chunks
    ‚îî‚îÄ‚îÄ 6_error.json           ‚Üê Error details (if any)
```

---

### 4.7 –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å (`src/`)

| –ö–∞—Ç–∞–ª–æ–≥       | –¶–µ–ª—å                                                                                       |
| ------------- | ------------------------------------------------------------------------------------------ |
| `src/app/`    | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –º–∞—Ä—à—Ä—É—Ç—ã API, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û Express, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ OAuth  |
| `src/lib/`    | –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (`localDb.ts`, `usageDb.ts`), –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø            |
| `src/mitm/`   | –ü—Ä–æ–∫—Å–∏-—É—Ç–∏–ª–∏—Ç—ã ¬´–ß–µ–ª–æ–≤–µ–∫ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ¬ª –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞                       |
| `src/models/` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö                                                             |
| `src/shared/` | –û–±–µ—Ä—Ç–∫–∏ –≤–æ–∫—Ä—É–≥ —Ñ—É–Ω–∫—Ü–∏–π open-sse (–ø–æ—Å—Ç–∞–≤—â–∏–∫, –ø–æ—Ç–æ–∫, –æ—à–∏–±–∫–∞ –∏ —Ç. –¥.)                         |
| `src/sse/`    | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ SSE, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É open-sse –∫ –º–∞—Ä—à—Ä—É—Ç–∞–º Express |
| `src/store/`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è                                                           |

#### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã API

| –ú–∞—Ä—à—Ä—É—Ç                                       | –ú–µ—Ç–æ–¥—ã                     | –¶–µ–ª—å                                                                                                        |
| --------------------------------------------- | -------------------------- | ----------------------------------------------------------------------------------------------------------- |
| `/api/provider-models`                        | –ü–û–õ–£–ß–ò–¢–¨/–û–¢–ü–†–ê–í–ò–¢–¨/–£–î–ê–õ–ò–¢–¨ | CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞                                                    |
| `/api/models/catalog`                         | –ü–û–õ–£–ß–ò–¢–¨                   | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (—á–∞—Ç, –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–∞—Å—Ç–æ–º), —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º |
| `/api/settings/proxy`                         | –ü–û–õ–£–ß–ò–¢–¨/–ü–û–°–¢–ê–í–ò–¢–¨/–£–î–ê–õ–ò–¢–¨ | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ (`global/providers/combos/keys`)                       |
| `/api/settings/proxy/test`                    | –ü–û–°–¢                       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π IP-–∞–¥—Ä–µ—Å –∏ –∑–∞–¥–µ—Ä–∂–∫—É                         |
| `/v1/providers/[provider]/chat/completions`   | –ü–û–°–¢                       | –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–∞—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–æ–¥–µ–ª–∏                                       |
| `/v1/providers/[provider]/embeddings`         | –ü–û–°–¢                       | –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–æ–¥–µ–ª–∏                                              |
| `/v1/providers/[provider]/images/generations` | –ü–û–°–¢                       | –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–æ–¥–µ–ª–∏                                  |
| `/api/settings/ip-filter`                     | –ü–û–õ–£–ß–ò–¢–¨/–ü–û–°–¢–ê–í–ò–¢–¨         | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö/—á–µ—Ä–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤                                                            |
| `/api/settings/thinking-budget`               | –ü–û–õ–£–ß–ò–¢–¨/–ü–û–°–¢–ê–í–ò–¢–¨         | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ —Ç–æ–∫–µ–Ω–∞ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è (—Å–∫–≤–æ–∑–Ω–æ–π/–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π/–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)               |
| `/api/settings/system-prompt`                 | –ü–û–õ–£–ß–ò–¢–¨/–ü–û–°–¢–ê–í–ò–¢–¨         | –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤                                                     |
| `/api/sessions`                               | –ü–û–õ–£–ß–ò–¢–¨                   | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –∏ –º–µ—Ç—Ä–∏–∫–∏                                                                      |
| `/api/rate-limits`                            | –ü–û–õ–£–ß–ò–¢–¨                   | –°—Ç–∞—Ç—É—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞                                                              |

---

## 5. –ö–ª—é—á–µ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 5.1 –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥

–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **—Ñ–æ—Ä–º–∞—Ç OpenAI –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç–æ—Ä–∞**. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ **–æ–¥–Ω—É –ø–∞—Ä—É** —Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä–æ–≤ (–≤/–∏–∑ OpenAI), –∞ –Ω–µ N –ø–∞—Ä.

### 5.2 –®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

–£ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –µ—Å—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–π –æ—Ç `BaseExecutor`. –§–∞–±—Ä–∏–∫–∞ –≤ `executors/index.ts` –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### 5.3 –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤

–ú–æ–¥—É–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —á–µ—Ä–µ–∑ `register()`. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏ –µ–≥–æ –∏–º–ø–æ—Ä—Ç.

### 5.4 –†–µ–∑–µ—Ä–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –æ—Ç–∫–∞—Ç–æ–º

–ö–æ–≥–¥–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429/401/500, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å, –ø—Ä–∏–º–µ–Ω—è—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (1 —Å ‚Üí 2 —Å ‚Üí 4 —Å ‚Üí –º–∞–∫—Å–∏–º—É–º 2 –º–∏–Ω—É—Ç—ã).

### 5.5 –¶–µ–ø–æ—á–∫–∏ –∫–æ–º–±–æ-–º–æ–¥–µ–ª–µ–π

¬´–ö–æ–º–±–æ¬ª –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ `provider/model`. –ï—Å–ª–∏ –ø–µ—Ä–≤–æ–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.

### 5.6 –ü–æ—Ç–æ–∫–æ–≤–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–æ–≤ SSE (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞) —Å –ø–æ–º–æ—â—å—é –º–µ—Ö–∞–Ω–∏–∑–º–∞ `initState()`.

### 5.7 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ö —Å–æ–æ–±—â–∞–µ–º–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –±—É—Ñ–µ—Ä –Ω–∞ 2000 —Ç–æ–∫–µ–Ω–æ–≤, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑-–∑–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞.

---

## 6. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç                                   | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä      |
| ---------------------------------------- | --------------- | ------------------ |
| –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è —á–∞—Ç–∞ OpenAI                   | –∏—Å—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª—å | `openai`           |
| API –æ—Ç–≤–µ—Ç–æ–≤ OpenAI                       | –∏—Å—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª—å | `openai-responses` |
| –ê–Ω—Ç—Ä–æ–ø–Ω—ã–π –ö–ª–æ–¥                           | –∏—Å—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª—å | `claude`           |
| Google –ë–ª–∏–∑–Ω–µ—Ü—ã                          | –∏—Å—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª—å | `gemini`           |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ Google Gemini | —Ç–æ–ª—å–∫–æ —Ü–µ–ª—å     | `gemini-cli`       |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è                           | –∏—Å—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª—å | `antigravity`      |
| AWS –ö–∏—Ä–æ                                 | —Ç–æ–ª—å–∫–æ —Ü–µ–ª—å     | `kiro`             |
| –ö—É—Ä—Å–æ—Ä                                   | —Ç–æ–ª—å–∫–æ —Ü–µ–ª—å     | `cursor`           |

---

## 7. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä                                | –ú–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏       | –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å    | –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è                                                      |
| ---------------------------------------- | -------------------------- | -------------- | ------------------------------------------------------------------------ |
| –ê–Ω—Ç—Ä–æ–ø–Ω—ã–π –ö–ª–æ–¥                           | –ö–ª—é—á API –∏–ª–∏ OAuth         | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-api-key`                                         |
| Google –ë–ª–∏–∑–Ω–µ—Ü—ã                          | –ö–ª—é—á API –∏–ª–∏ OAuth         | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-goog-api-key`                                    |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ Google Gemini | –û–ê—É—Ç–µ–Ω—Ç                    | –ë–ª–∏–∑–Ω–µ—Ü—ãCLI    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É `streamGenerateContent`                        |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è                           | –û–ê—É—Ç–µ–Ω—Ç                    | –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è | –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö URL-–∞–¥—Ä–µ—Å–æ–≤, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤ |
| –û–ø–µ–Ω–ê–ò                                   | API-–∫–ª—é—á                   | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Å–∏—Ç–µ–ª—è                               |
| –ö–æ–¥–µ–∫—Å                                   | –û–ê—É—Ç–µ–Ω—Ç                    | –ö–æ–¥–µ–∫—Å         | –í–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —É–ø—Ä–∞–≤–ª—è–µ—Ç –º—ã—à–ª–µ–Ω–∏–µ–º                         |
| –í—Ç–æ—Ä–æ–π –ø–∏–ª–æ—Ç GitHub                      | OAuth + —Ç–æ–∫–µ–Ω Copilot      | –ì–∏—Ç—Ö–∞–±         | –î–≤–æ–π–Ω–æ–π —Ç–æ–∫–µ–Ω, –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ VSCode                                 |
| –ö–∏—Ä–æ (AWS)                               | AWS SSO OIDC –∏–ª–∏ Social    | –ö–∏—Ä–æ           | –ê–Ω–∞–ª–∏–∑ –¥–≤–æ–∏—á–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π                                          |
| –ö—É—Ä—Å–æ—Ä IDE                               | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã | –ö—É—Ä—Å–æ—Ä         | –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ Protobuf, –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã SHA-256                          |
| –ö–≤–µ–Ω                                     | –û–ê—É—Ç–µ–Ω—Ç                    | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è                                               |
| iFlow                                    | OAuth (–±–∞–∑–æ–≤—ã–π + –Ω–æ—Å–∏—Ç–µ–ª—å) | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–≤–æ–π–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏                                         |
| OpenRouter                               | API-–∫–ª—é—á                   | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Å–∏—Ç–µ–ª—è                               |
| –ì–õ–ú, –ö–∏–º–∏, –ú–∏–Ω–∏–ú–∞–∫—Å                      | API-–∫–ª—é—á                   | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Claude, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `x-api-key`                          |
| `openai-compatible-*`                    | API-–∫–ª—é—á                   | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π: –ª—é–±–∞—è –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å OpenAI                 |
| `anthropic-compatible-*`                 | API-–∫–ª—é—á                   | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é   | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π: –ª—é–±–∞—è –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å Claude                 |

---

## 8. –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ç–æ–∫–µ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–ø—Ä–æ—Å –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor\nbuildUrl + buildHeaders"]
    D --> E["fetch(providerURL)"]
    E --> F["createSSEStream()\nTRANSLATE mode"]
    F --> G["parseSSELine()"]
    G --> H["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    H --> I["extractUsage()\n+ addBuffer"]
    I --> J["formatSSE()"]
    J --> K["Client receives\ntranslated SSE"]
    K --> L["logUsage()\nsaveRequestUsage()"]
```

### –ù–µ–ø–æ—Ç–æ–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor.execute()"]
    D --> E["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E --> F["Return JSON\nresponse"]
```

### –û–±—Ö–æ–¥ –ø–æ—Ç–æ–∫–∞ (Claude CLI)

```mermaid
flowchart LR
    A["Claude CLI request"] --> B{"Match bypass\npattern?"}
    B -->|"Title/Warmup/Count"| C["Generate fake\nOpenAI response"]
    B -->|"No match"| D["Normal flow"]
    C --> E["Translate to\nsource format"]
    E --> F["Return without\ncalling provider"]
```
