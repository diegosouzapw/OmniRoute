# omniroute ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –∫–æ–¥–æ–≤–æ—ó –±–∞–∑–∏

üåê **Languages:** üá∫üá∏ [English](../../CODEBASE_DOCUMENTATION.md) | üáßüá∑ [Portugu√™s (Brasil)](../pt-BR/CODEBASE_DOCUMENTATION.md) | üá™üá∏ [Espa√±ol](../es/CODEBASE_DOCUMENTATION.md) | üá´üá∑ [Fran√ßais](../fr/CODEBASE_DOCUMENTATION.md) | üáÆüáπ [Italiano](../it/CODEBASE_DOCUMENTATION.md) | üá∑üá∫ [–†—É—Å—Å–∫–∏–π](../ru/CODEBASE_DOCUMENTATION.md) | üá®üá≥ [‰∏≠Êñá (ÁÆÄ‰Ωì)](../zh-CN/CODEBASE_DOCUMENTATION.md) | üá©üá™ [Deutsch](../de/CODEBASE_DOCUMENTATION.md) | üáÆüá≥ [‡§π‡§ø‡§®‡•ç‡§¶‡•Ä](../in/CODEBASE_DOCUMENTATION.md) | üáπüá≠ [‡πÑ‡∏ó‡∏¢](../th/CODEBASE_DOCUMENTATION.md) | üá∫üá¶ [–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞](../uk-UA/CODEBASE_DOCUMENTATION.md) | üá∏üá¶ [ÿßŸÑÿπÿ±ÿ®Ÿäÿ©](../ar/CODEBASE_DOCUMENTATION.md) | üáØüáµ [Êó•Êú¨Ë™û](../ja/CODEBASE_DOCUMENTATION.md) | üáªüá≥ [Ti·∫øng Vi·ªát](../vi/CODEBASE_DOCUMENTATION.md) | üáßüá¨ [–ë—ä–ª–≥–∞—Ä—Å–∫–∏](../bg/CODEBASE_DOCUMENTATION.md) | üá©üá∞ [Dansk](../da/CODEBASE_DOCUMENTATION.md) | üá´üáÆ [Suomi](../fi/CODEBASE_DOCUMENTATION.md) | üáÆüá± [◊¢◊ë◊®◊ô◊™](../he/CODEBASE_DOCUMENTATION.md) | üá≠üá∫ [Magyar](../hu/CODEBASE_DOCUMENTATION.md) | üáÆüá© [Bahasa Indonesia](../id/CODEBASE_DOCUMENTATION.md) | üá∞üá∑ [ÌïúÍµ≠Ïñ¥](../ko/CODEBASE_DOCUMENTATION.md) | üá≤üáæ [Bahasa Melayu](../ms/CODEBASE_DOCUMENTATION.md) | üá≥üá± [Nederlands](../nl/CODEBASE_DOCUMENTATION.md) | üá≥üá¥ [Norsk](../no/CODEBASE_DOCUMENTATION.md) | üáµüáπ [Portugu√™s (Portugal)](../pt/CODEBASE_DOCUMENTATION.md) | üá∑üá¥ [Rom√¢nƒÉ](../ro/CODEBASE_DOCUMENTATION.md) | üáµüá± [Polski](../pl/CODEBASE_DOCUMENTATION.md) | üá∏üá∞ [Slovenƒçina](../sk/CODEBASE_DOCUMENTATION.md) | üá∏üá™ [Svenska](../sv/CODEBASE_DOCUMENTATION.md) | üáµüá≠ [Filipino](../phi/CODEBASE_DOCUMENTATION.md)

> –í–∏—á–µ—Ä–ø–Ω–∏–π, –∑—Ä—É—á–Ω–∏–π –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤ –ø–æ—Å—ñ–±–Ω–∏–∫ —ñ–∑ **omniroute** –±–∞–≥–∞—Ç–æ–ø—Ä–æ–≤–∞–π–¥–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ–∫—Å—ñ-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ AI.

---

## 1. –©–æ —Ç–∞–∫–µ omniroute?

omniroute ‚Äî —Ü–µ **–ø—Ä–æ–∫—Å—ñ-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä**, —è–∫–∏–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–∞–º–∏ AI (Claude CLI, Codex, Cursor IDE —Ç–æ—â–æ) —Ç–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞–º–∏ AI (Anthropic, Google, OpenAI, AWS, GitHub —Ç–æ—â–æ). –¶–µ –≤–∏—Ä—ñ—à—É—î –æ–¥–Ω—É –≤–µ–ª–∏–∫—É –ø—Ä–æ–±–ª–µ–º—É:

> **–†—ñ–∑–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∏ –®–Ü —Ä–æ–∑–º–æ–≤–ª—è—é—Ç—å —Ä—ñ–∑–Ω–∏–º–∏ ¬´–º–æ–≤–∞–º–∏¬ª (—Ñ–æ—Ä–º–∞—Ç–∞–º–∏ API), —ñ —Ä—ñ–∑–Ω—ñ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ –®–Ü —Ç–∞–∫–æ–∂ –æ—á—ñ–∫—É—é—Ç—å —Ä—ñ–∑–Ω–∏—Ö ¬´–º–æ–≤¬ª.** omniroute –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î –º—ñ–∂ –Ω–∏–º–∏.

–î—É–º–∞–π—Ç–µ –ø—Ä–æ —Ü–µ —è–∫ –ø—Ä–æ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á–∞ –≤ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –û–±‚Äô—î–¥–Ω–∞–Ω–∏—Ö –ù–∞—Ü—ñ–π ‚Äî –±—É–¥—å-—è–∫–∏–π –¥–µ–ª–µ–≥–∞—Ç –º–æ–∂–µ –≥–æ–≤–æ—Ä–∏—Ç–∏ –±—É–¥—å-—è–∫–æ—é –º–æ–≤–æ—é, —ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—ó –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ —ñ–Ω—à–æ–≥–æ –¥–µ–ª–µ–≥–∞—Ç–∞.

---

## 2. –û–≥–ª—è–¥ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

```mermaid
graph LR
    subgraph Clients
        A[Claude CLI]
        B[Codex]
        C[Cursor IDE]
        D[OpenAI-compatible]
    end

    subgraph omniroute
        E[Handler Layer]
        F[Translator Layer]
        G[Executor Layer]
        H[Services Layer]
    end

    subgraph Providers
        I[Anthropic Claude]
        J[Google Gemini]
        K[OpenAI / Codex]
        L[GitHub Copilot]
        M[AWS Kiro]
        N[Antigravity]
        O[Cursor API]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    G --> I
    G --> J
    G --> K
    G --> L
    G --> M
    G --> N
    G --> O
    H -.-> E
    H -.-> G
```

### –û—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø: –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥

–£—Å—ñ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ **—Ñ–æ—Ä–º–∞—Ç OpenAI —è–∫ —Ü–µ–Ω—Ç—Ä**:

```
Client Format ‚Üí [OpenAI Hub] ‚Üí Provider Format    (request)
Provider Format ‚Üí [OpenAI Hub] ‚Üí Client Format    (response)
```

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ **N –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á—ñ–≤** (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ñ–æ—Ä–º–∞—Ç) –∑–∞–º—ñ—Å—Ç—å **N¬≤** (–∫–æ–∂–Ω–∞ –ø–∞—Ä–∞).

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
omniroute/
‚îú‚îÄ‚îÄ open-sse/                  ‚Üê Core proxy library (portable, framework-agnostic)
‚îÇ   ‚îú‚îÄ‚îÄ index.js               ‚Üê Main entry point, exports everything
‚îÇ   ‚îú‚îÄ‚îÄ config/                ‚Üê Configuration & constants
‚îÇ   ‚îú‚îÄ‚îÄ executors/             ‚Üê Provider-specific request execution
‚îÇ   ‚îú‚îÄ‚îÄ handlers/              ‚Üê Request handling orchestration
‚îÇ   ‚îú‚îÄ‚îÄ services/              ‚Üê Business logic (auth, models, fallback, usage)
‚îÇ   ‚îú‚îÄ‚îÄ translator/            ‚Üê Format translation engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request/           ‚Üê Request translators (8 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ response/          ‚Üê Response translators (7 files)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers/           ‚Üê Shared translation utilities (6 files)
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 ‚Üê Utility functions
‚îú‚îÄ‚îÄ src/                       ‚Üê Application layer (Express/Worker runtime)
‚îÇ   ‚îú‚îÄ‚îÄ app/                   ‚Üê Web UI, API routes, middleware
‚îÇ   ‚îú‚îÄ‚îÄ lib/                   ‚Üê Database, auth, and shared library code
‚îÇ   ‚îú‚îÄ‚îÄ mitm/                  ‚Üê Man-in-the-middle proxy utilities
‚îÇ   ‚îú‚îÄ‚îÄ models/                ‚Üê Database models
‚îÇ   ‚îú‚îÄ‚îÄ shared/                ‚Üê Shared utilities (wrappers around open-sse)
‚îÇ   ‚îú‚îÄ‚îÄ sse/                   ‚Üê SSE endpoint handlers
‚îÇ   ‚îî‚îÄ‚îÄ store/                 ‚Üê State management
‚îú‚îÄ‚îÄ data/                      ‚Üê Runtime data (credentials, logs)
‚îÇ   ‚îî‚îÄ‚îÄ provider-credentials.json   (external credentials override, gitignored)
‚îî‚îÄ‚îÄ tester/                    ‚Üê Test utilities
```

---

## 4. –†–æ–∑–±–∏–≤–∫–∞ –ø–æ –º–æ–¥—É–ª—è—Ö

### 4.1 –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (`open-sse/config/`)

**–Ñ–¥–∏–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –ø—Ä–∞–≤–¥–∏** –¥–ª—è –≤—Å—ñ—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤.

| –§–∞–π–ª                          | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                                                                                                                                                                               |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constants.ts`                | –û–±‚Äô—î–∫—Ç `PROVIDERS` –∑ –±–∞–∑–æ–≤–∏–º–∏ URL-–∞–¥—Ä–µ—Å–∞–º–∏, –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ OAuth (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º), –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–∏–º–∏ –ø—ñ–¥–∫–∞–∑–∫–∞–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞. –¢–∞–∫–æ–∂ –≤–∏–∑–Ω–∞—á–∞—î `HTTP_STATUS`, `ERROR_TYPES`, `COOLDOWN_MS`, `BACKOFF_CONFIG` —Ç–∞ `SKIP_PATTERNS`. |
| `credentialLoader.ts`         | –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–æ–≤–Ω—ñ—à–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ `data/provider-credentials.json` —Ç–∞ –æ–±‚Äô—î–¥–Ω—É—î —ó—Ö —ñ–∑ –∂–æ—Ä—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–æ–≤–∞–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É `PROVIDERS`. –ó–±–µ—Ä—ñ–≥–∞—î —Å–µ–∫—Ä–µ—Ç–∏ –ø–æ–∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–∂–µ—Ä–µ–ª–∞, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å.                                      |
| `providerModels.ts`           | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —Ä–µ—î—Å—Ç—Ä –º–æ–¥–µ–ª–µ–π: –ø—Å–µ–≤–¥–æ–Ω—ñ–º–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ –∫–∞—Ä—Ç ‚Üí —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –º–æ–¥–µ–ª–µ–π. –¢–∞–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫ `getModels()`, `getProviderByAlias()`.                                                                                                                              |
| `codexInstructions.ts`        | –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –≤–≤–µ–¥–µ–Ω—ñ –≤ –∑–∞–ø–∏—Ç–∏ Codex (–æ–±–º–µ–∂–µ–Ω–Ω—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è, –ø—Ä–∞–≤–∏–ª–∞ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –ø–æ–ª—ñ—Ç–∏–∫–∏ –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è).                                                                                                                                                            |
| `defaultThinkingSignature.ts` | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ ¬´–º–∏—Å–ª—è—á—ñ¬ª –ø—ñ–¥–ø–∏—Å–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π Claude —ñ Gemini.                                                                                                                                                                                                                 |
| `ollamaModels.ts`             | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ö–µ–º–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π Ollama (–Ω–∞–∑–≤–∞, —Ä–æ–∑–º—ñ—Ä, —Å—ñ–º–µ–π—Å—Ç–≤–æ, –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è).                                                                                                                                                                                    |

#### –ü–æ—Ç—ñ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

```mermaid
flowchart TD
    A["App starts"] --> B["constants.ts defines PROVIDERS\nwith hardcoded defaults"]
    B --> C{"data/provider-credentials.json\nexists?"}
    C -->|Yes| D["credentialLoader reads JSON"]
    C -->|No| E["Use hardcoded defaults"]
    D --> F{"For each provider in JSON"}
    F --> G{"Provider exists\nin PROVIDERS?"}
    G -->|No| H["Log warning, skip"]
    G -->|Yes| I{"Value is object?"}
    I -->|No| J["Log warning, skip"]
    I -->|Yes| K["Merge clientId, clientSecret,\ntokenUrl, authUrl, refreshUrl"]
    K --> F
    H --> F
    J --> F
    F -->|Done| L["PROVIDERS ready with\nmerged credentials"]
    E --> L
```

---

### 4.2 –í–∏–∫–æ–Ω–∞–≤—Ü—ñ (`open-sse/executors/`)

–í–∏–∫–æ–Ω–∞–≤—Ü—ñ —ñ–Ω–∫–∞–ø—Å—É–ª—é—é—Ç—å **—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –ª–æ–≥—ñ–∫—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **—à–∞–±–ª–æ–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó**. –ö–æ–∂–µ–Ω –≤–∏–∫–æ–Ω–∞–≤–µ—Ü—å –∑–∞–º—ñ–Ω—é—î –±–∞–∑–æ–≤—ñ –º–µ—Ç–æ–¥–∏ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.

```mermaid
classDiagram
    class BaseExecutor {
        +buildUrl(model, stream, options)
        +buildHeaders(credentials, stream, body)
        +transformRequest(body, model, stream, credentials)
        +execute(url, options)
        +shouldRetry(status, error)
        +refreshCredentials(credentials, log)
    }

    class DefaultExecutor {
        +refreshCredentials()
    }

    class AntigravityExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +shouldRetry()
        +refreshCredentials()
    }

    class CursorExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseResponse()
        +generateChecksum()
    }

    class KiroExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseEventStream()
        +refreshCredentials()
    }

    BaseExecutor <|-- DefaultExecutor
    BaseExecutor <|-- AntigravityExecutor
    BaseExecutor <|-- CursorExecutor
    BaseExecutor <|-- KiroExecutor
    BaseExecutor <|-- CodexExecutor
    BaseExecutor <|-- GeminiCLIExecutor
    BaseExecutor <|-- GithubExecutor
```

| –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å       | –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫                               | –ö–ª—é—á–æ–≤—ñ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó                                                                                                                                                            |
| ---------------- | ------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `base.ts`        | ‚Äî                                          | –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞ –±–∞–∑–∞: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è URL-–∞–¥—Ä–µ—Å–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ª–æ–≥—ñ–∫–∞ –ø–æ–≤—Ç–æ—Ä—É, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö                                                                                      |
| `default.ts`     | Claude, Gemini, OpenAI, GLM, Kimi, MiniMax | –û–Ω–æ–≤–ª–µ–Ω–Ω—è —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ OAuth –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤                                                                                                            |
| `antigravity.ts` | Google Cloud Code                          | –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É/—Å–µ–∞–Ω—Å—É, —Ä–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è –∫—ñ–ª—å–∫–æ—Ö URL-–∞–¥—Ä–µ—Å, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫—É ("—Å–∫–∏–Ω—É—Ç–∏ —á–µ—Ä–µ–∑ 2 –≥–æ–¥. 7 —Ö–≤. 23 —Å.") |
| `cursor.ts`      | –ö—É—Ä—Å–æ—Ä IDE                                 | **–ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–µ**: –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Å—É–º–∏ SHA-256, –∫–æ–¥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É Protobuf, –¥–≤—ñ–π–∫–æ–≤–∏–π EventStream ‚Üí –∞–Ω–∞–ª—ñ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ SSE                                               |
| `codex.ts`       | OpenAI Codex                               | –í–ø—Ä–æ–≤–∞–¥–∂—É—î —Å–∏—Å—Ç–µ–º–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –∫–µ—Ä—É—î —Ä—ñ–≤–Ω—è–º–∏ –º–∏—Å–ª–µ–Ω–Ω—è, –≤–∏–¥–∞–ª—è—î –Ω–µ–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏                                                                                         |
| `gemini-cli.ts`  | Google Gemini CLI                          | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó URL-–∞–¥—Ä–µ—Å–∏ (`streamGenerateContent`), –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ Google OAuth                                                                                       |
| `github.ts`      | –ö–æ–ø—ñ–ª–æ—Ç GitHub                             | –ü–æ–¥–≤—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∞—Ä–∫–µ—Ä—ñ–≤ (GitHub OAuth + –º–∞—Ä–∫–µ—Ä Copilot), —ñ–º—ñ—Ç–∞—Ü—ñ—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ VSCode                                                                                             |
| `kiro.ts`        | AWS CodeWhisperer                          | –î–≤—ñ–π–∫–æ–≤–∏–π –∞–Ω–∞–ª—ñ–∑ AWS EventStream, –∫–∞–¥—Ä–∏ –ø–æ–¥—ñ–π AMZN, –æ—Ü—ñ–Ω–∫–∞ –º–∞—Ä–∫–µ—Ä—ñ–≤                                                                                                              |
| `index.ts`       | ‚Äî                                          | –§–∞–±—Ä–∏–∫–∞: –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ–º‚Äô—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ ‚Üí –∫–ª–∞—Å –≤–∏–∫–æ–Ω–∞–≤—Ü—è, —ñ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–∏–º –≤–∞—Ä—ñ–∞–Ω—Ç–æ–º –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º                                                                                 |

---

### 4.3 –û–±—Ä–æ–±–Ω–∏–∫–∏ (`open-sse/handlers/`)

**–†—ñ–≤–µ–Ω—å –æ—Ä–∫–µ—Å—Ç—Ä–æ–≤–∫–∏** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω—É—î –ø–µ—Ä–µ–∫–ª–∞–¥, –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø–æ—Ç–æ–∫–æ–≤–µ –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è —Ç–∞ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫.

| –§–∞–π–ª                  | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                                                                                                                                  |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chatCore.ts`         | **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –æ—Ä–∫–µ—Å—Ç—Ä** (~600 —Ä—è–¥–∫—ñ–≤). –û–±—Ä–æ–±–ª—è—î –ø–æ–≤–Ω–∏–π –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –∑–∞–ø–∏—Ç—É: –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É ‚Üí –ø–µ—Ä–µ–∫–ª–∞–¥ ‚Üí –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü—è ‚Üí –ø–æ—Ç–æ–∫–æ–≤–∞/–Ω–µ–ø–æ—Ç–æ–∫–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚Üí –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ ‚Üí –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ ‚Üí –∂—É—Ä–Ω–∞–ª –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. |
| `responsesHandler.ts` | –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è API –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π OpenAI: –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–∞—Ç—É ‚Üí –Ω–∞–¥—Å–∏–ª–∞—î –¥–æ `chatCore` ‚Üí –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î SSE –Ω–∞–∑–∞–¥ —É —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.                                                                       |
| `embeddings.ts`       | –û–±—Ä–æ–±–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è: —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –º–æ–¥–µ–ª—å –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è ‚Üí –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫, –Ω–∞–¥—Å–∏–ª–∞—î –¥–æ API –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞, –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è, —Å—É–º—ñ—Å–Ω—É –∑ OpenAI. –ü—ñ–¥—Ç—Ä–∏–º—É—î 6+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤.                                |
| `imageGeneration.ts`  | –û–±—Ä–æ–±–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–æ–±—Ä–∞–∂–µ–Ω—å: —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –º–æ–¥–µ–ª—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è ‚Üí –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫, –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–µ–∂–∏–º–∏, —Å—É–º—ñ—Å–Ω—ñ –∑ OpenAI, Gemini-image (Antigravity) —ñ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π (Nebius). –ü–æ–≤–µ—Ä—Ç–∞—î base64 –∞–±–æ URL-–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.                           |

#### –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –∑–∞–ø–∏—Ç—É (chatCore.ts)

```mermaid
sequenceDiagram
    participant Client
    participant chatCore
    participant Translator
    participant Executor
    participant Provider

    Client->>chatCore: Request (any format)
    chatCore->>chatCore: Detect source format
    chatCore->>chatCore: Check bypass patterns
    chatCore->>chatCore: Resolve model & provider
    chatCore->>Translator: Translate request (source ‚Üí OpenAI ‚Üí target)
    chatCore->>Executor: Get executor for provider
    Executor->>Executor: Build URL, headers, transform request
    Executor->>Executor: Refresh credentials if needed
    Executor->>Provider: HTTP fetch (streaming or non-streaming)

    alt Streaming
        Provider-->>chatCore: SSE stream
        chatCore->>chatCore: Pipe through SSE transform stream
        Note over chatCore: Transform stream translates<br/>each chunk: target ‚Üí OpenAI ‚Üí source
        chatCore-->>Client: Translated SSE stream
    else Non-streaming
        Provider-->>chatCore: JSON response
        chatCore->>Translator: Translate response
        chatCore-->>Client: Translated JSON
    end

    alt Error (401, 429, 500...)
        chatCore->>Executor: Retry with credential refresh
        chatCore->>chatCore: Account fallback logic
    end
```

---

### 4.4 –ü–æ—Å–ª—É–≥–∏ (`open-sse/services/`)

–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —è–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –æ–±—Ä–æ–±–Ω–∏–∫–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ.

| –§–∞–π–ª                 | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                                                                                                                                                                                                                                                                        |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `provider.ts`        | **–í–∏—è–≤–ª–µ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É** (`detectFormat`): –∞–Ω–∞–ª—ñ–∑—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∏ Claude/OpenAI/Gemini/Antigravity/Responses (–≤–∫–ª—é—á–∞—î `max_tokens` –µ–≤—Ä–∏—Å—Ç–∏–∫—É –¥–ª—è Claude). –¢–∞–∫–æ–∂: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è URL-–∞–¥—Ä–µ—Å, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –º–∏—Å–ª–µ–Ω–Ω—è. –ü—ñ–¥—Ç—Ä–∏–º—É—î –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ `openai-compatible-*` —Ç–∞ `anthropic-compatible-*`. |
| `model.ts`           | –°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ä—è–¥–∫–∞ –º–æ–¥–µ–ª—ñ (`claude/model-name` ‚Üí `{provider: "claude", model: "model-name"}`), –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤ —ñ–∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è–º –∑—ñ—Ç–∫–Ω–µ–Ω—å, –æ—á–∏—â–µ–Ω–Ω—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–≤—ñ–¥—Ö–∏–ª—è—î –æ–±—Ö—ñ–¥ —à–ª—è—Ö—ñ–≤/–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏) —Ç–∞ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –º–æ–¥–µ–ª—å —ñ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞—Å–æ–±—É –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤.                                                  |
| `accountFallback.ts` | –û–±—Ä–æ–±–∫–∞ –ª—ñ–º—ñ—Ç—É —à–≤–∏–¥–∫–æ—Å—Ç—ñ: –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∞ –≤—ñ–¥–¥–∞—á–∞ (1 —Å ‚Üí 2 —Å ‚Üí 4 —Å ‚Üí –º–∞–∫—Å. 2 —Ö–≤), –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫ (—è–∫—ñ –ø–æ–º–∏–ª–∫–∏ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –≤—ñ–¥–∫–∞—Ç, –∞ —è–∫—ñ –Ω—ñ).                                                                                                                                                                        |
| `tokenRefresh.ts`    | –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ OAuth –¥–ª—è **–∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞**: Google (Gemini, Antigravity), Claude, Codex, Qwen, iFlow, GitHub (OAuth + Copilot dual-token), Kiro (AWS SSO OIDC + Social Auth). –í–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ –∫–µ—à –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—ó –æ–±—ñ—Ü—è–Ω–æ–∫ —É –ø–æ–ª—å–æ—Ç—ñ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É —Å–ø—Ä–æ–±—É –∑ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏–º –≤—ñ–¥—Å—Ç—Ä–æ—á–∫–æ—é.                                                                    |
| `combo.ts`           | **–ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω—ñ –º–æ–¥–µ–ª—ñ**: –ª–∞–Ω—Ü—é–∂–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π. –Ø–∫—â–æ –º–æ–¥–µ–ª—å A –≤–∏—Ö–æ–¥–∏—Ç—å –∑ –ª–∞–¥—É —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É, –ø—Ä–∏–¥–∞—Ç–Ω—É –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è, —Å–ø—Ä–æ–±—É–π—Ç–µ –º–æ–¥–µ–ª—å B, –ø–æ—Ç—ñ–º C —Ç–æ—â–æ. –ü–æ–≤–µ—Ä—Ç–∞—î —Ñ–∞–∫—Ç–∏—á–Ω—ñ –∫–æ–¥–∏ —Å—Ç–∞–Ω—É –≤–∏—Å—Ö—ñ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É.                                                                                                                                                        |
| `usage.ts`           | –û—Ç—Ä–∏–º—É—î –¥–∞–Ω—ñ –ø—Ä–æ –∫–≤–æ—Ç—É/–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ API –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ (–∫–≤–æ—Ç–∏ GitHub Copilot, –∫–≤–æ—Ç–∏ –º–æ–¥–µ–ª—ñ Antigravity, –æ–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ Codex, –∞–Ω–∞–ª—ñ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Kiro, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Claude).                                                                                                                                                                                |
| `accountSelector.ts` | –Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∑ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É –±–∞–ª—ñ–≤: –≤—Ä–∞—Ö–æ–≤—É—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç, —Å—Ç–∞–Ω –∑–¥–æ—Ä–æ–≤‚Äô—è, –ø–æ–∑–∏—Ü—ñ—é —Ü–∏–∫–ª—ñ—á–Ω–æ–≥–æ —Ü–∏–∫–ª—É —Ç–∞ —Å—Ç–∞–Ω –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è, —â–æ–± –≤–∏–±—Ä–∞—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É.                                                                                                                                                |
| `contextManager.ts`  | –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑–∞–ø–∏—Ç—É: —Å—Ç–≤–æ—Ä—é—î —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—î –æ–±‚Äô—î–∫—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏ (—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Ç—É, —á–∞—Å–æ–≤—ñ –ø–æ–∑–Ω–∞—á–∫–∏, —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞) –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è.                                                                                                                                             |
| `ipFilter.ts`        | –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ IP: –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–µ–∂–∏–º–∏ –±—ñ–ª–æ–≥–æ —Ç–∞ —á–æ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫—ñ–≤. –ü–µ—Ä–µ–≤—ñ—Ä—è—î IP –∫–ª—ñ—î–Ω—Ç–∞ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é –∑–∞–ø–∏—Ç—ñ–≤ API.                                                                                                                                                                                                 |
| `sessionManager.ts`  | –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–±–∏—Ç–∫—ñ–≤ –ø–∞–ª—å—Ü—ñ–≤ –∫–ª—ñ—î–Ω—Ç–∞: –≤—ñ–¥—Å—Ç–µ–∂—É—î –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ–∞–Ω—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ö–µ—à–æ–≤–∞–Ω–∏—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –∫–ª—ñ—î–Ω—Ç–∞, –≤—ñ–¥—Å—Ç–µ–∂—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ —ñ –Ω–∞–¥–∞—î –ø–æ–∫–∞–∑–Ω–∏–∫–∏ —Å–µ–∞–Ω—Å—É.                                                                                                                                                                          |
| `signatureCache.ts`  | –ö–µ—à –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—ñ–¥–ø–∏—Å—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤: –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏–º –∑–∞–ø–∏—Ç–∞–º, –∫–µ—à—É—é—á–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ø—ñ–¥–ø–∏—Å–∏ –∑–∞–ø–∏—Ç—ñ–≤ —ñ –ø–æ–≤–µ—Ä—Ç–∞—é—á–∏ –∫–µ—à–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –ø—Ä–æ—Ç—è–≥–æ–º –ø–µ–≤–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É —á–∞—Å—É.                                                                                                                                                                 |
| `systemPrompt.ts`    | –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ—ó —Å–∏—Å—Ç–µ–º–Ω–æ—ó –ø—ñ–¥–∫–∞–∑–∫–∏: –¥–æ–¥–∞—î –∞–±–æ –¥–æ–¥–∞—î –Ω–∞—Å—Ç—Ä–æ—é–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º–Ω—É –ø—ñ–¥–∫–∞–∑–∫—É –¥–æ –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤ —ñ–∑ –æ–±—Ä–æ–±–∫–æ—é —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞.                                                                                                                                                                                                        |
| `thinkingBudget.ts`  | –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—é–¥–∂–µ—Ç–æ–º —Ä–µ–∑–æ–Ω–∞–Ω—Å–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤: –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø—Ä–æ—Ö—ñ–¥–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π (–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–≥–∞–ª—É–∂–µ–Ω–æ–≥–æ –º–∏—Å–ª–µ–Ω–Ω—è), —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π (—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π –±—é–¥–∂–µ—Ç) —ñ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ) —Ä–µ–∂–∏–º–∏ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∂–µ—Ç–æ–Ω–∞–º–∏ –º–∏—Å–ª–µ–Ω–Ω—è/–º—ñ—Ä–∫—É–≤–∞–Ω–Ω—è.                                                                                                                       |
| `wildcardRouter.ts`  | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è —à–∞–±–ª–æ–Ω—ñ–≤ —à–∞–±–ª–æ–Ω—ñ–≤ –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏: —Ä–æ–∑–≤‚Äô—è–∑—É—î —à–∞–±–ª–æ–Ω–∏ –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `*/claude-*`) –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø–∞—Ä –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫/–º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É.                                                                                                                                                                                    |

#### –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞

```mermaid
sequenceDiagram
    participant R1 as Request 1
    participant R2 as Request 2
    participant Cache as refreshPromiseCache
    participant OAuth as OAuth Provider

    R1->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: No in-flight promise
    Cache->>OAuth: Start refresh
    R2->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: Found in-flight promise
    Cache-->>R2: Return existing promise
    OAuth-->>Cache: New access token
    Cache-->>R1: New access token
    Cache-->>R2: Same access token (shared)
    Cache->>Cache: Delete cache entry
```

#### –ó–∞–ø–∞—Å–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç —Å—Ç–∞–Ω—É –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É

```mermaid
stateDiagram-v2
    [*] --> Active
    Active --> Error: Request fails (401/429/500)
    Error --> Cooldown: Apply backoff
    Cooldown --> Active: Cooldown expires
    Active --> Active: Request succeeds (reset backoff)

    state Error {
        [*] --> ClassifyError
        ClassifyError --> ShouldFallback: Rate limit / Auth / Transient
        ClassifyError --> NoFallback: 400 Bad Request
    }

    state Cooldown {
        [*] --> ExponentialBackoff
        ExponentialBackoff: Level 0 = 1s
        ExponentialBackoff: Level 1 = 2s
        ExponentialBackoff: Level 2 = 4s
        ExponentialBackoff: Max = 2min
    }
```

#### –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å –ª–∞–Ω—Ü—é–∂–∫–∞

```mermaid
flowchart LR
    A["Request with\ncombo model"] --> B["Model A"]
    B -->|"2xx Success"| C["Return response"]
    B -->|"429/401/500"| D{"Fallback\neligible?"}
    D -->|Yes| E["Model B"]
    D -->|No| F["Return error"]
    E -->|"2xx Success"| C
    E -->|"429/401/500"| G{"Fallback\neligible?"}
    G -->|Yes| H["Model C"]
    G -->|No| F
    H -->|"2xx Success"| C
    H -->|"Fail"| I["All failed ‚Üí\nReturn last status"]
```

---

### 4.5 –ü–µ—Ä–µ–∫–ª–∞–¥–∞—á (`open-sse/translator/`)

**–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—É —Ñ–æ—Ä–º–∞—Ç—ñ–≤**, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–∏—Å—Ç–µ–º—É –ø–ª–∞–≥—ñ–Ω—ñ–≤ —ñ–∑ —Å–∞–º–æ—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—î—é.

#### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    subgraph "Request Translation"
        A["Claude ‚Üí OpenAI"]
        B["Gemini ‚Üí OpenAI"]
        C["Antigravity ‚Üí OpenAI"]
        D["OpenAI Responses ‚Üí OpenAI"]
        E["OpenAI ‚Üí Claude"]
        F["OpenAI ‚Üí Gemini"]
        G["OpenAI ‚Üí Kiro"]
        H["OpenAI ‚Üí Cursor"]
    end

    subgraph "Response Translation"
        I["Claude ‚Üí OpenAI"]
        J["Gemini ‚Üí OpenAI"]
        K["Kiro ‚Üí OpenAI"]
        L["Cursor ‚Üí OpenAI"]
        M["OpenAI ‚Üí Claude"]
        N["OpenAI ‚Üí Antigravity"]
        O["OpenAI ‚Üí Responses"]
    end
```

| –î–æ–≤—ñ–¥–Ω–∏–∫     | –§–∞–π–ª–∏          | –û–ø–∏—Å                                                                                                                                                                                                                                                                                                |
| ------------ | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `request/`   | 8 –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á—ñ–≤ | –ü–µ—Ä–µ—Ç–≤–æ—Ä—é–π—Ç–µ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É –º—ñ–∂ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏. –ö–æ–∂–µ–Ω —Ñ–∞–π–ª —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ —Ä–µ—î—Å—Ç—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `register(from, to, fn)` –ø—ñ–¥ —á–∞—Å —ñ–º–ø–æ—Ä—Ç—É.                                                                                                                                                                          |
| `response/`  | 7 –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á—ñ–≤ | –ü–µ—Ä–µ—Ç–≤–æ—Ä—é–π—Ç–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏ –ø–æ—Ç–æ–∫–æ–≤–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º—ñ–∂ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏. –û–±—Ä–æ–±–ª—è—î —Ç–∏–ø–∏ –ø–æ–¥—ñ–π SSE, –±–ª–æ–∫–∏ –º–∏—Å–ª–µ–Ω–Ω—è, –≤–∏–∫–ª–∏–∫–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤.                                                                                                                                                                            |
| `helpers/`   | 6 –ø–æ–º—ñ—á–Ω–∏–∫—ñ–≤   | –°–ø—ñ–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏: `claudeHelper` (–≤–∏–ª—É—á–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–æ–∫, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º–∏—Å–ª–µ–Ω–Ω—è), `geminiHelper` (–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–∞—Å—Ç–∏–Ω/–≤–º—ñ—Å—Ç—É), `openaiHelper` (—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É), `toolCallHelper` (–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞, –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π), `maxTokensHelper`, `responsesApiHelper`. |
| `index.ts`   | ‚Äî              | –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—É: `translateRequest()`, `translateResponse()`, –¥–µ—Ä–∂–∞–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è, —Ä–µ—î—Å—Ç—Ä.                                                                                                                                                                                                        |
| `formats.ts` | ‚Äî              | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—É: `OPENAI`, `CLAUDE`, `GEMINI`, `ANTIGRAVITY`, `KIRO`, `CURSOR`, `OPENAI_RESPONSES`.                                                                                                                                                                                               |

#### –î–∏–∑–∞–π–Ω –∫–ª—é—á–∞: –ø–ª–∞–≥—ñ–Ω–∏, —â–æ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è

```javascript
// Each translator file calls register() on import:
import { register } from "../index.js";
register("claude", "openai", translateClaudeToOpenAI);

// The index.js imports all translator files, triggering registration:
import "./request/claude-to-openai.js"; // ‚Üê self-registers
```

---

### 4.6 –£—Ç–∏–ª—ñ—Ç–∏ (`open-sse/utils/`)

| –§–∞–π–ª               | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                                                                                                                                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `error.ts`         | –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–º–∏–ª–∫—É (—Ñ–æ—Ä–º–∞—Ç, —Å—É–º—ñ—Å–Ω–∏–π –∑ OpenAI), —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–º–∏–ª–æ–∫ –≤–≥–æ—Ä—ñ, –≤–∏–ª—É—á–µ–Ω–Ω—è —á–∞—Å—É –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏ Antigravity –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏, –ø–æ—Ç–æ–∫–æ–≤–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ–º–∏–ª–æ–∫ SSE.                                                                                                                    |
| `stream.ts`        | **SSE Transform Stream** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –ø–æ—Ç–æ–∫–æ–≤–∏–π –∫–æ–Ω–≤–µ—î—Ä. –î–≤–∞ —Ä–µ–∂–∏–º–∏: `TRANSLATE` (–ø–æ–≤–Ω–æ—Ñ–æ—Ä–º–∞—Ç–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥) —ñ `PASSTHROUGH` (–Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ + –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è). –ö–µ—Ä—É—î—Ç—å—Å—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—î—é —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤, –æ—Ü—ñ–Ω–∫–æ—é –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è–º –¥–æ–≤–∂–∏–Ω–∏ –≤–º—ñ—Å—Ç—É. –ï–∫–∑–µ–º–ø–ª—è—Ä–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –∫–æ–¥–µ—Ä–∞/–¥–µ–∫–æ–¥–µ—Ä–∞ —É–Ω–∏–∫–∞—é—Ç—å —Å–ø—ñ–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É. |
| `streamHelpers.ts` | –£—Ç–∏–ª—ñ—Ç–∏ SSE –Ω–∏–∑—å–∫–æ–≥–æ —Ä—ñ–≤–Ω—è: `parseSSELine` (—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–∏–π –¥–æ –ø—Ä–æ–±—ñ–ª—ñ–≤), `hasValuableContent` (—Ñ—ñ–ª—å—Ç—Ä—É—î –ø–æ—Ä–æ–∂–Ω—ñ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏ –¥–ª—è OpenAI/Claude/Gemini), `fixInvalidId`, `formatSSE` (—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è SSE –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ñ–æ—Ä–º–∞—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `perf_metrics` –æ—á–∏—â–µ–Ω–Ω—è).                                                             |
| `usageTracking.ts` | –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ —ñ–∑ –±—É–¥—å-—è–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É (Claude/OpenAI/Gemini/Responses), –æ—Ü—ñ–Ω–∫–∞ –∑ –æ–∫—Ä–µ–º–∏–º–∏ —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è–º–∏ —Å–∏–º–≤–æ–ª—ñ–≤ –Ω–∞ –º–∞—Ä–∫–µ—Ä –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤/–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, –¥–æ–¥–∞–≤–∞–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ (2000 –∑–∞–ø–∞—Å—ñ–≤ –º–∞—Ä–∫–µ—Ä—ñ–≤), —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ–ª—ñ–≤ –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É, –∫–æ–Ω—Å–æ–ª—å–Ω–µ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è –∑ –∫–æ–ª—å–æ—Ä–∞–º–∏ ANSI.                     |
| `requestLogger.ts` | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ñ–∞–π–ª—ñ–≤ (—É–≤—ñ–º–∫–Ω—ñ—Ç—å—Å—è —á–µ—Ä–µ–∑ `ENABLE_REQUEST_LOGS=true`). –°—Ç–≤–æ—Ä—é—î –ø–∞–ø–∫–∏ —Å–µ–∞–Ω—Å—É –∑ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏: `1_req_client.json` ‚Üí `7_res_client.txt`. –í–µ—Å—å –≤–≤—ñ–¥-–≤–∏–≤—ñ–¥ —î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º (–∑–∞–ø—É—Å—Ç–∏–≤ —ñ –∑–∞–±—É–≤). –ú–∞—Å–∫—É—î —á—É—Ç–ª–∏–≤—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏.                                                                |
| `bypassHandler.ts` | –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î –ø–µ–≤–Ω—ñ —à–∞–±–ª–æ–Ω–∏ –≤—ñ–¥ Claude CLI (–≤–∏–ª—É—á–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, —Ä–æ–∑–º–∏–Ω–∫–∞, –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫) —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ñ–∞–ª—å—à–∏–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–µ–∑ –≤–∏–∫–ª–∏–∫—É –∂–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞. –ü—ñ–¥—Ç—Ä–∏–º—É—î —è–∫ –ø–æ—Ç–æ–∫–æ–≤–µ, —Ç–∞–∫ —ñ –Ω–µ –ø–æ—Ç–æ–∫–æ–≤–µ. –ù–∞–≤–º–∏—Å–Ω–æ –æ–±–º–µ–∂–µ–Ω–æ –æ–±–ª–∞—Å—Ç—é CLI Claude.                                                                                    |
| `networkProxy.ts`  | –í–∏—Ä—ñ—à—É—î URL-–∞–¥—Ä–µ—Å—É –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–∞–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º: –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ ‚Üí –≥–ª–æ–±–∞–ª—å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è ‚Üí –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (`HTTPS_PROXY`/`HTTP_PROXY`/`ALL_PROXY`). –ü—ñ–¥—Ç—Ä–∏–º—É—î –≤–∏–∫–ª—é—á–µ–Ω–Ω—è `NO_PROXY`. –ö–µ—à –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –Ω–∞ 30 —Å.                                         |

#### SSE Streaming Pipeline

```mermaid
flowchart TD
    A["Provider SSE stream"] --> B["TextDecoder\n(per-stream instance)"]
    B --> C["Buffer lines\n(split on newline)"]
    C --> D["parseSSELine()\n(trim whitespace, parse JSON)"]
    D --> E{"Mode?"}
    E -->|TRANSLATE| F["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E -->|PASSTHROUGH| G["fixInvalidId()\nnormalize chunk"]
    F --> H["hasValuableContent()\nfilter empty chunks"]
    G --> H
    H -->|"Has content"| I["extractUsage()\ntrack token counts"]
    H -->|"Empty"| J["Skip chunk"]
    I --> K["formatSSE()\nserialize + clean perf_metrics"]
    K --> L["TextEncoder\n(per-stream instance)"]
    L --> M["Enqueue to\nclient stream"]

    style A fill:#f9f,stroke:#333
    style M fill:#9f9,stroke:#333
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ–∞–Ω—Å—É —Ä–µ—î—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ø–∏—Ç—ñ–≤

```
logs/
‚îî‚îÄ‚îÄ claude_gemini_claude-sonnet_20260208_143045/
    ‚îú‚îÄ‚îÄ 1_req_client.json      ‚Üê Raw client request
    ‚îú‚îÄ‚îÄ 2_req_source.json      ‚Üê After initial conversion
    ‚îú‚îÄ‚îÄ 3_req_openai.json      ‚Üê OpenAI intermediate format
    ‚îú‚îÄ‚îÄ 4_req_target.json      ‚Üê Final target format
    ‚îú‚îÄ‚îÄ 5_res_provider.txt     ‚Üê Provider SSE chunks (streaming)
    ‚îú‚îÄ‚îÄ 5_res_provider.json    ‚Üê Provider response (non-streaming)
    ‚îú‚îÄ‚îÄ 6_res_openai.txt       ‚Üê OpenAI intermediate chunks
    ‚îú‚îÄ‚îÄ 7_res_client.txt       ‚Üê Client-facing SSE chunks
    ‚îî‚îÄ‚îÄ 6_error.json           ‚Üê Error details (if any)
```

---

### 4.7 –†—ñ–≤–µ–Ω—å –ø—Ä–æ–≥—Ä–∞–º–∏ (`src/`)

| –î–æ–≤—ñ–¥–Ω–∏–∫      | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                          |
| ------------- | -------------------------------------------------------------------------------------------------------------------- |
| `src/app/`    | –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –º–∞—Ä—à—Ä—É—Ç–∏ API, –ø—Ä–æ–º—ñ–∂–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è Express, –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É OAuth |
| `src/lib/`    | –î–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (`localDb.ts`, `usageDb.ts`), –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è, —Å–ø—ñ–ª—å–Ω–∏–π                                          |
| `src/mitm/`   | –ü—Ä–æ–∫—Å—ñ-—É—Ç–∏–ª—ñ—Ç–∏ Man-in-the-middle –¥–ª—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç—Ä–∞—Ñ—ñ–∫—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞                                                 |
| `src/models/` | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö                                                                                         |
| `src/shared/` | –û–±–≥–æ—Ä—Ç–∫–∏ –Ω–∞–≤–∫–æ–ª–æ —Ñ—É–Ω–∫—Ü—ñ–π open-sse (–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –ø–æ—Ç—ñ–∫, –ø–æ–º–∏–ª–∫–∞ —Ç–æ—â–æ)                                                   |
| `src/sse/`    | –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ SSE, —è–∫—ñ –ø—ñ–¥–∫–ª—é—á–∞—é—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É open-sse –¥–æ –µ–∫—Å–ø—Ä–µ—Å-–º–∞—Ä—à—Ä—É—Ç—ñ–≤                               |
| `src/store/`  | –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º                                                                                       |

#### –í—ñ–¥–æ–º—ñ –º–∞—Ä—à—Ä—É—Ç–∏ API

| –ú–∞—Ä—à—Ä—É—Ç                                       | –ú–µ—Ç–æ–¥–∏          | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                                                                                |
| --------------------------------------------- | --------------- | ---------------------------------------------------------------------------------------------------------- |
| `/api/provider-models`                        | GET/POST/DELETE | CRUD –¥–ª—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞                                                              |
| `/api/models/catalog`                         | –û–¢–†–ò–ú–ê–¢–ò        | –ó–≤–µ–¥–µ–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ —É—Å—ñ—Ö –º–æ–¥–µ–ª–µ–π (—á–∞—Ç, –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –Ω–∞—Å—Ç—Ä–æ—é–≤–∞–Ω–Ω—è), –∑–≥—Ä—É–ø–æ–≤–∞–Ω–∏–π –∑–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–æ–º |
| `/api/settings/proxy`                         | GET/PUT/DELETE  | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω–æ–≥–æ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –ø—Ä–æ–∫—Å—ñ (`global/providers/combos/keys`)                                |
| `/api/settings/proxy/test`                    | –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏    | –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–æ–∫—Å—ñ —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–≥–∞–ª—å–Ω–æ–¥–æ—Å—Ç—É–ø–Ω—É IP-–∞–¥—Ä–µ—Å—É/–∑–∞—Ç—Ä–∏–º–∫—É                               |
| `/v1/providers/[provider]/chat/completions`   | –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏    | –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–∞—Ç—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –º–æ–¥–µ–ª—ñ                                   |
| `/v1/providers/[provider]/embeddings`         | –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏    | –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –≤–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –º–æ–¥–µ–ª—ñ                                      |
| `/v1/providers/[provider]/images/generations` | –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏    | –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –º–æ–¥–µ–ª—ñ                               |
| `/api/settings/ip-filter`                     | GET/PUT         | –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫–æ–º –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö/—á–æ—Ä–Ω–∏—Ö IP-–∞–¥—Ä–µ—Å                                                               |
| `/api/settings/thinking-budget`               | GET/PUT         | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –±—é–¥–∂–µ—Ç—É —Ç–æ–∫–µ–Ω–∞ –º—ñ—Ä–∫—É–≤–∞–Ω–Ω—è (–ø—Ä–æ—Ö—ñ–¥–Ω–∏–π/–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π/—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π/–∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π)                     |
| `/api/settings/system-prompt`                 | GET/PUT         | –ì–ª–æ–±–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –ø—ñ–¥–∫–∞–∑–∫–∞ –¥–ª—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤                                                               |
| `/api/sessions`                               | –û–¢–†–ò–ú–ê–¢–ò        | –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó —Ç–∞ –º–µ—Ç—Ä–∏–∫–∏                                                                      |
| `/api/rate-limits`                            | –û–¢–†–ò–ú–ê–¢–ò        | –°—Ç–∞—Ç—É—Å –æ–±–º–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–≤–∫–∏ –Ω–∞ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å                                                                 |

---

## 5. –ö–ª—é—á–æ–≤—ñ —à–∞–±–ª–æ–Ω–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è

### 5.1 –ü–µ—Ä–µ–∫–ª–∞–¥ Hub-and-Spoke

–£—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ **—Ñ–æ—Ä–º–∞—Ç OpenAI —è–∫ —Ü–µ–Ω—Ç—Ä**. –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –≤–∏–º–∞–≥–∞—î –ª–∏—à–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è **–æ–¥–Ω—ñ—î—ó –ø–∞—Ä–∏** –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á—ñ–≤ (–¥–æ/–∑ OpenAI), –∞ –Ω–µ N –ø–∞—Ä.

### 5.2 –®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –≤–∏–∫–æ–Ω–∞–≤—Ü—è

–ö–æ–∂–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä –º–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–ª–∞—Å –≤–∏–∫–æ–Ω–∞–≤—Ü—è, —É—Å–ø–∞–¥–∫–æ–≤–∞–Ω–∏–π –≤—ñ–¥ `BaseExecutor`. –§–∞–±—Ä–∏–∫–∞ –≤ `executors/index.ts` –≤–∏–±–∏—Ä–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

### 5.3 –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥—ñ–Ω—ñ–≤ —ñ–∑ —Å–∞–º–æ—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—î—é

–ú–æ–¥—É–ª—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á–∞ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å —ñ–º–ø–æ—Ä—Ç—É —á–µ—Ä–µ–∑ `register()`. –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—á–∞ –æ–∑–Ω–∞—á–∞—î –ª–∏—à–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É —Ç–∞ –π–æ–≥–æ —ñ–º–ø–æ—Ä—Ç.

### 5.4 –†–µ–∑–µ—Ä–≤–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —ñ–∑ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏–º –≤—ñ–¥—Å—Ç—Ä–æ—á–∫–æ—é

–ö–æ–ª–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ–≤–µ—Ä—Ç–∞—î 429/401/500, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è (1 —Å ‚Üí 2 —Å ‚Üí 4 —Å ‚Üí –º–∞–∫—Å. 2 —Ö–≤).

### –õ–∞–Ω—Ü—é–≥–∏ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π 5.5

"Combo" –≥—Ä—É–ø—É—î –∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤ `provider/model`. –Ø–∫—â–æ –ø–µ—Ä—à–∏–π –Ω–µ –≤–¥–∞—î—Ç—å—Å—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ.

### 5.6 –ü–æ—Ç–æ–∫–æ–≤–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —ñ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º —Å—Ç–∞–Ω—É

–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å—Ç–∞–Ω —É –±–ª–æ–∫–∞—Ö SSE (–≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –±–ª–æ–∫—ñ–≤ –º–∏—Å–ª–µ–Ω–Ω—è, –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –≤–∏–∫–ª–∏–∫—ñ–≤ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è –±–ª–æ–∫—ñ–≤ –≤–º—ñ—Å—Ç—É) —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω—ñ–∑–º `initState()`.

### 5.7 –ë—É—Ñ–µ—Ä –±–µ–∑–ø–µ–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ë—É—Ñ–µ—Ä –Ω–∞ 2000 –º–∞—Ä–∫–µ—Ä—ñ–≤ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—é –∫–ª—ñ—î–Ω—Ç–∞–º–∏ –æ–±–º–µ–∂–µ–Ω—å –≤—ñ–∫–æ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —á–µ—Ä–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ñ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∞ –ø–µ—Ä–µ–∫–ª–∞–¥ —Ñ–æ—Ä–º–∞—Ç—É.

---

## 6. –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏

| –§–æ—Ä–º–∞—Ç                 | –ù–∞–ø—Ä—è–º         | –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä      |
| ---------------------- | -------------- | ------------------ |
| –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–∞—Ç—É OpenAI | –¥–∂–µ—Ä–µ–ª–æ + —Ü—ñ–ª—å | `openai`           |
| OpenAI Responses API   | –¥–∂–µ—Ä–µ–ª–æ + —Ü—ñ–ª—å | `openai-responses` |
| –ê–Ω—Ç—Ä–æ–ø–Ω–∏–π –ö–ª–æ–¥         | –¥–∂–µ—Ä–µ–ª–æ + —Ü—ñ–ª—å | `claude`           |
| Google Gemini          | –¥–∂–µ—Ä–µ–ª–æ + —Ü—ñ–ª—å | `gemini`           |
| Google Gemini CLI      | —Ç—ñ–ª—å–∫–∏ –º–µ—Ç–∞    | `gemini-cli`       |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è         | –¥–∂–µ—Ä–µ–ª–æ + —Ü—ñ–ª—å | `antigravity`      |
| AWS Kiro               | —Ç—ñ–ª—å–∫–∏ –º–µ—Ç–∞    | `kiro`             |
| –ö—É—Ä—Å–æ—Ä                 | —Ç—ñ–ª—å–∫–∏ –º–µ—Ç–∞    | `cursor`           |

---

## 7. –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏

| –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫             | –ú–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó               | –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å       | –ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏                                                          |
| ------------------------ | ------------------------------- | ---------------- | ------------------------------------------------------------------------- |
| –ê–Ω—Ç—Ä–æ–ø–Ω–∏–π –ö–ª–æ–¥           | –ö–ª—é—á API –∞–±–æ OAuth              | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-api-key`                                        |
| Google Gemini            | –ö–ª—é—á API –∞–±–æ OAuth              | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-goog-api-key`                                   |
| Google Gemini CLI        | OAuth                           | GeminiCLI        | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É `streamGenerateContent`                        |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è           | OAuth                           | –ê–Ω—Ç–∏–≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è   | –†–µ–∑–µ—Ä–≤–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ –∫—ñ–ª—å–∫–æ–º–∞ URL-–∞–¥—Ä–µ—Å–∞–º–∏, –Ω–∞—Å—Ç—Ä–æ—é–≤–∞–Ω–∏–π –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ |
| OpenAI                   | –ö–ª—é—á API                        | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Å—ñ—è                                         |
| –ö–æ–¥–µ–∫—Å                   | OAuth                           | –ö–æ–¥–µ–∫—Å           | –í–ø—Ä–æ–≤–∞–¥–∂—É—î —Å–∏—Å—Ç–µ–º–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –∫–µ—Ä—É—î –º–∏—Å–ª–µ–Ω–Ω—è–º                           |
| –ö–æ–ø—ñ–ª–æ—Ç GitHub           | OAuth + –º–∞—Ä–∫–µ—Ä Copilot          | Github           | –ü–æ–¥–≤—ñ–π–Ω–∏–π –º–∞—Ä–∫–µ—Ä, —ñ–º—ñ—Ç–∞—Ü—ñ—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ VSCode                               |
| –ö—ñ—Ä–æ (AWS)               | AWS SSO OIDC –∞–±–æ Social         | –ö—ñ—Ä–æ             | –†–æ–∑–±—ñ—Ä –¥–≤—ñ–π–∫–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫—É –ø–æ–¥—ñ–π                                            |
| –ö—É—Ä—Å–æ—Ä IDE               | –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Å—É–º–∏ | –ö—É—Ä—Å–æ—Ä           | –ö–æ–¥—É–≤–∞–Ω–Ω—è Protobuf, –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Å—É–º–∏ SHA-256                               |
| –ö–≤–µ–Ω                     | OAuth                           | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è                                                    |
| iFlow                    | OAuth (–±–∞–∑–æ–≤–∏–π + –Ω–æ—Å—ñ–π)         | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–¥–≤—ñ–π–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó                                           |
| OpenRouter               | –ö–ª—é—á API                        | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Å—ñ—è                                         |
| GLM, Kimi, MiniMax       | –ö–ª—é—á API                        | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | Claude-—Å—É–º—ñ—Å–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `x-api-key`                               |
| `openai-compatible-*`    | –ö–ª—é—á API                        | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: –±—É–¥—å-—è–∫–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞, —Å—É–º—ñ—Å–Ω–∞ –∑ OpenAI                      |
| `anthropic-compatible-*` | –ö–ª—é—á API                        | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º | –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: –±—É–¥—å-—è–∫–∞ Claude-—Å—É–º—ñ—Å–Ω–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞                         |

---

## 8. –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ—Ç–æ–∫—É –¥–∞–Ω–∏—Ö

### –ó–∞–ø–∏—Ç –Ω–∞ –ø–æ—Ç–æ–∫–æ–≤–µ –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor\nbuildUrl + buildHeaders"]
    D --> E["fetch(providerURL)"]
    E --> F["createSSEStream()\nTRANSLATE mode"]
    F --> G["parseSSELine()"]
    G --> H["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    H --> I["extractUsage()\n+ addBuffer"]
    I --> J["formatSSE()"]
    J --> K["Client receives\ntranslated SSE"]
    K --> L["logUsage()\nsaveRequestUsage()"]
```

### –ù–µ–ø–æ—Ç–æ–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor.execute()"]
    D --> E["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E --> F["Return JSON\nresponse"]
```

### –û–±—Ö—ñ–¥–Ω–∏–π –ø–æ—Ç—ñ–∫ (Claude CLI)

```mermaid
flowchart LR
    A["Claude CLI request"] --> B{"Match bypass\npattern?"}
    B -->|"Title/Warmup/Count"| C["Generate fake\nOpenAI response"]
    B -->|"No match"| D["Normal flow"]
    C --> E["Translate to\nsource format"]
    E --> F["Return without\ncalling provider"]
```
