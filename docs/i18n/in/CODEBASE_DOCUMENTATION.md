# omniroute - рдХреЛрдбрдмреЗрд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг

ЁЯМР **Languages:** ЁЯЗ║ЁЯЗ╕ [English](../../CODEBASE_DOCUMENTATION.md) | ЁЯЗзЁЯЗ╖ [Portugu├кs (Brasil)](../pt-BR/CODEBASE_DOCUMENTATION.md) | ЁЯЗкЁЯЗ╕ [Espa├▒ol](../es/CODEBASE_DOCUMENTATION.md) | ЁЯЗлЁЯЗ╖ [Fran├зais](../fr/CODEBASE_DOCUMENTATION.md) | ЁЯЗоЁЯЗ╣ [Italiano](../it/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╖ЁЯЗ║ [╨а╤Г╤Б╤Б╨║╨╕╨╣](../ru/CODEBASE_DOCUMENTATION.md) | ЁЯЗиЁЯЗ│ [ф╕нцЦЗ (чоАф╜У)](../zh-CN/CODEBASE_DOCUMENTATION.md) | ЁЯЗйЁЯЗк [Deutsch](../de/CODEBASE_DOCUMENTATION.md) | ЁЯЗоЁЯЗ│ [рд╣рд┐рдиреНрджреА](../in/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╣ЁЯЗн [р╣Др╕Чр╕в](../th/CODEBASE_DOCUMENTATION.md) | ЁЯЗ║ЁЯЗж [╨г╨║╤А╨░╤Ч╨╜╤Б╤М╨║╨░](../uk-UA/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╕ЁЯЗж [╪з┘Д╪╣╪▒╪и┘К╪й](../ar/CODEBASE_DOCUMENTATION.md) | ЁЯЗпЁЯЗ╡ [цЧецЬмшкЮ](../ja/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╗ЁЯЗ│ [Tiс║┐ng Viс╗Зt](../vi/CODEBASE_DOCUMENTATION.md) | ЁЯЗзЁЯЗм [╨С╤К╨╗╨│╨░╤А╤Б╨║╨╕](../bg/CODEBASE_DOCUMENTATION.md) | ЁЯЗйЁЯЗ░ [Dansk](../da/CODEBASE_DOCUMENTATION.md) | ЁЯЗлЁЯЗо [Suomi](../fi/CODEBASE_DOCUMENTATION.md) | ЁЯЗоЁЯЗ▒ [╫в╫С╫и╫Щ╫к](../he/CODEBASE_DOCUMENTATION.md) | ЁЯЗнЁЯЗ║ [Magyar](../hu/CODEBASE_DOCUMENTATION.md) | ЁЯЗоЁЯЗй [Bahasa Indonesia](../id/CODEBASE_DOCUMENTATION.md) | ЁЯЗ░ЁЯЗ╖ [эХЬъ╡ньЦ┤](../ko/CODEBASE_DOCUMENTATION.md) | ЁЯЗ▓ЁЯЗ╛ [Bahasa Melayu](../ms/CODEBASE_DOCUMENTATION.md) | ЁЯЗ│ЁЯЗ▒ [Nederlands](../nl/CODEBASE_DOCUMENTATION.md) | ЁЯЗ│ЁЯЗ┤ [Norsk](../no/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╡ЁЯЗ╣ [Portugu├кs (Portugal)](../pt/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╖ЁЯЗ┤ [Rom├вn─Г](../ro/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╡ЁЯЗ▒ [Polski](../pl/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╕ЁЯЗ░ [Sloven─Нina](../sk/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╕ЁЯЗк [Svenska](../sv/CODEBASE_DOCUMENTATION.md) | ЁЯЗ╡ЁЯЗн [Filipino](../phi/CODEBASE_DOCUMENTATION.md)

> **рдУрдореНрдиреАрд░реВрдЯреЗ** рдорд▓реНрдЯреА-рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдПрдЖрдИ рдкреНрд░реЙрдХреНрд╕реА рд░рд╛рдЙрдЯрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рдкрдХ, рд╢реБрд░реБрдЖрддреА-рдЕрдиреБрдХреВрд▓ рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ред

---

## 1. рд╕рд░реНрд╡рд╡реНрдпрд╛рдкреА рдХреНрдпрд╛ рд╣реИ?

рдСрдореНрдиреАрд░реВрдЯ рдПрдХ **рдкреНрд░реЙрдХреНрд╕реА рд░рд╛рдЙрдЯрд░** рд╣реИ рдЬреЛ рдПрдЖрдИ рдХреНрд▓рд╛рдЗрдВрдЯ (рдХреНрд▓рд╛рдЙрдб рд╕реАрдПрд▓рдЖрдИ, рдХреЛрдбреЗрдХреНрд╕, рдХрд░реНрд╕рд░ рдЖрдИрдбреАрдИ, рдЖрджрд┐) рдФрд░ рдПрдЖрдИ рдкреНрд░рджрд╛рддрд╛рдУрдВ (рдПрдВрдереНрд░реЛрдкрд┐рдХ, рдЧреВрдЧрд▓, рдУрдкрдирдПрдЖрдИ, рдПрдбрдмреНрд▓реНрдпреВрдПрд╕, рдЧрд┐рдЯрд╣рдм, рдЖрджрд┐) рдХреЗ рдмреАрдЪ рдмреИрдарддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдмрдбрд╝реА рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдХрд░рддрд╛ рд╣реИ:

> **рдЕрд▓рдЧ-рдЕрд▓рдЧ рдПрдЖрдИ рдХреНрд▓рд╛рдЗрдВрдЯ рдЕрд▓рдЧ-рдЕрд▓рдЧ "рднрд╛рд╖рд╛рдПрдВ" (рдПрдкреАрдЖрдИ рдкреНрд░рд╛рд░реВрдк) рдмреЛрд▓рддреЗ рд╣реИрдВ, рдФрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдПрдЖрдИ рдкреНрд░рджрд╛рддрд╛ рднреА рдЕрд▓рдЧ-рдЕрд▓рдЧ "рднрд╛рд╖рд╛рдУрдВ" рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред** рдСрдореНрдиреАрд░реВрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рдмреАрдЪ рдЕрдиреБрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИред

рдЗрд╕реЗ рд╕рдВрдпреБрдХреНрдд рд░рд╛рд╖реНрдЯреНрд░ рдореЗрдВ рдПрдХ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдЕрдиреБрд╡рд╛рджрдХ рдХреА рддрд░рд╣ рд╕рдордЭреЗрдВ - рдХреЛрдИ рднреА рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЛрдИ рднреА рднрд╛рд╖рд╛ рдмреЛрд▓ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЕрдиреБрд╡рд╛рджрдХ рдЗрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИред

---

## 2. рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдЕрд╡рд▓реЛрдХрди

```mermaid
graph LR
    subgraph Clients
        A[Claude CLI]
        B[Codex]
        C[Cursor IDE]
        D[OpenAI-compatible]
    end

    subgraph omniroute
        E[Handler Layer]
        F[Translator Layer]
        G[Executor Layer]
        H[Services Layer]
    end

    subgraph Providers
        I[Anthropic Claude]
        J[Google Gemini]
        K[OpenAI / Codex]
        L[GitHub Copilot]
        M[AWS Kiro]
        N[Antigravity]
        O[Cursor API]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    G --> I
    G --> J
    G --> K
    G --> L
    G --> M
    G --> N
    G --> O
    H -.-> E
    H -.-> G
```

### рдореБрдЦреНрдп рд╕рд┐рджреНрдзрд╛рдВрдд: рд╣рдм-рдПрдВрдб-рд╕реНрдкреЛрдХ рдЕрдиреБрд╡рд╛рдж

рд╕рднреА рдкреНрд░рд╛рд░реВрдк рдЕрдиреБрд╡рд╛рдж **рд╣рдм рдХреЗ рд░реВрдк рдореЗрдВ рдУрдкрдирдПрдЖрдИ рдкреНрд░рд╛рд░реВрдк** рд╕реЗ рд╣реЛрдХрд░ рдЧреБрдЬрд░рддрд╛ рд╣реИ:

**OMNI_рдЯреЛрдХрди_1**

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **N┬▓** (рдкреНрд░рддреНрдпреЗрдХ рдЬреЛрдбрд╝реА) рдХреЗ рдмрдЬрд╛рдп рдХреЗрд╡рд▓ **N рдЕрдиреБрд╡рд╛рджрдХреЛрдВ** (рдкреНрд░рддрд┐ рдкреНрд░рд╛рд░реВрдк рдПрдХ) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

---

## 3. рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕рдВрд░рдЪрдирд╛

```
omniroute/
тФЬтФАтФА open-sse/                  тЖР Core proxy library (portable, framework-agnostic)
тФВ   тФЬтФАтФА index.js               тЖР Main entry point, exports everything
тФВ   тФЬтФАтФА config/                тЖР Configuration & constants
тФВ   тФЬтФАтФА executors/             тЖР Provider-specific request execution
тФВ   тФЬтФАтФА handlers/              тЖР Request handling orchestration
тФВ   тФЬтФАтФА services/              тЖР Business logic (auth, models, fallback, usage)
тФВ   тФЬтФАтФА translator/            тЖР Format translation engine
тФВ   тФВ   тФЬтФАтФА request/           тЖР Request translators (8 files)
тФВ   тФВ   тФЬтФАтФА response/          тЖР Response translators (7 files)
тФВ   тФВ   тФФтФАтФА helpers/           тЖР Shared translation utilities (6 files)
тФВ   тФФтФАтФА utils/                 тЖР Utility functions
тФЬтФАтФА src/                       тЖР Application layer (Express/Worker runtime)
тФВ   тФЬтФАтФА app/                   тЖР Web UI, API routes, middleware
тФВ   тФЬтФАтФА lib/                   тЖР Database, auth, and shared library code
тФВ   тФЬтФАтФА mitm/                  тЖР Man-in-the-middle proxy utilities
тФВ   тФЬтФАтФА models/                тЖР Database models
тФВ   тФЬтФАтФА shared/                тЖР Shared utilities (wrappers around open-sse)
тФВ   тФЬтФАтФА sse/                   тЖР SSE endpoint handlers
тФВ   тФФтФАтФА store/                 тЖР State management
тФЬтФАтФА data/                      тЖР Runtime data (credentials, logs)
тФВ   тФФтФАтФА provider-credentials.json   (external credentials override, gitignored)
тФФтФАтФА tester/                    тЖР Test utilities
```

---

## 4. рдореЙрдбреНрдпреВрд▓-рджрд░-рдореЙрдбреНрдпреВрд▓ рдмреНрд░реЗрдХрдбрд╛рдЙрди

### 4.1 рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (`open-sse/config/`)

рд╕рднреА рдкреНрд░рджрд╛рддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП **рд╕рддреНрдп рдХрд╛ рдПрдХрд▓ рд╕реНрд░реЛрдд**ред

| рдлрд╝рд╛рдЗрд▓                         | рдЙрджреНрджреЗрд╢реНрдп                                                                                                                                                                                                                               |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constants.ts`                | `PROVIDERS` рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ URL, OAuth рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ), рд╣реЗрдбрд░ рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд┐рд╕реНрдЯрдо рд╕рдВрдХреЗрддреЛрдВ рдХреЗ рд╕рд╛рде рдСрдмреНрдЬреЗрдХреНрдЯред `HTTP_STATUS`, `ERROR_TYPES`, `COOLDOWN_MS`, `BACKOFF_CONFIG`, рдФрд░ `SKIP_PATTERNS` рдХреЛ рднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред |
| `credentialLoader.ts`         | `data/provider-credentials.json` рд╕реЗ рдмрд╛рд╣рд░реА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ `PROVIDERS` рдореЗрдВ рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкрд░ рдорд░реНрдЬ рдХрд░рддрд╛ рд╣реИред рдкрд╢реНрдЪрдЧрд╛рдореА рд╕рдВрдЧрддрддрд╛ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реБрдП рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рд╕реНрд░реЛрдд рдирд┐рдпрдВрддреНрд░рдг рд╕реЗ рдмрд╛рд╣рд░ рд░рдЦрддрд╛ рд╣реИред                              |
| `providerModels.ts`           | рдХреЗрдВрджреНрд░реАрдп рдореЙрдбрд▓ рд░рдЬрд┐рд╕реНрдЯреНрд░реА: рдорд╛рдирдЪрд┐рддреНрд░ рдкреНрд░рджрд╛рддрд╛ рдЙрдкрдирд╛рдо тЖТ рдореЙрдбрд▓ рдЖрдИрдбреАред `getModels()`, `getProviderByAlias()` рдЬреИрд╕реЗ рдХрд╛рд░реНрдпред                                                                                                                         |
| `codexInstructions.ts`        | рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢ рдХреЛрдбреЗрдХреНрд╕ рдЕрдиреБрд░реЛрдзреЛрдВ (рд╕рдВрдкрд╛рджрди рдмрд╛рдзрд╛рдПрдВ, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдирд┐рдпрдо, рдЕрдиреБрдореЛрджрди рдиреАрддрд┐рдпрд╛рдВ) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдП рдЧрдП рд╣реИрдВред                                                                                                                                 |
| `defaultThinkingSignature.ts` | рдХреНрд▓рд╛рдЙрдб рдФрд░ рдЬреЗрдорд┐рдиреА рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ "рд╕реЛрдЪ" рд╣рд╕реНрддрд╛рдХреНрд╖рд░ред                                                                                                                                                                                 |
| `ollamaModels.ts`             | рд╕реНрдерд╛рдиреАрдп рдУрд▓рд╛рдорд╛ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рд╕реНрдХреАрдорд╛ рдкрд░рд┐рднрд╛рд╖рд╛ (рдирд╛рдо, рдЖрдХрд╛рд░, рдкрд░рд┐рд╡рд╛рд░, рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг)ред                                                                                                                                                              |

#### рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд▓реЛрдбрд┐рдВрдЧ рдлрд╝реНрд▓реЛ

```mermaid
flowchart TD
    A["App starts"] --> B["constants.ts defines PROVIDERS\nwith hardcoded defaults"]
    B --> C{"data/provider-credentials.json\nexists?"}
    C -->|Yes| D["credentialLoader reads JSON"]
    C -->|No| E["Use hardcoded defaults"]
    D --> F{"For each provider in JSON"}
    F --> G{"Provider exists\nin PROVIDERS?"}
    G -->|No| H["Log warning, skip"]
    G -->|Yes| I{"Value is object?"}
    I -->|No| J["Log warning, skip"]
    I -->|Yes| K["Merge clientId, clientSecret,\ntokenUrl, authUrl, refreshUrl"]
    K --> F
    H --> F
    J --> F
    F -->|Done| L["PROVIDERS ready with\nmerged credentials"]
    E --> L
```

---

### 4.2 рдирд┐рд╖реНрдкрд╛рджрдХ (`open-sse/executors/`)

рдирд┐рд╖реНрдкрд╛рджрдХ **рд░рдгрдиреАрддрд┐ рдкреИрдЯрд░реНрди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рджрд╛рддрд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рддрд░реНрдХ** рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╖реНрдкрд╛рджрдХ рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рдЖрдзрд╛рд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рддрд╛ рд╣реИред

```mermaid
classDiagram
    class BaseExecutor {
        +buildUrl(model, stream, options)
        +buildHeaders(credentials, stream, body)
        +transformRequest(body, model, stream, credentials)
        +execute(url, options)
        +shouldRetry(status, error)
        +refreshCredentials(credentials, log)
    }

    class DefaultExecutor {
        +refreshCredentials()
    }

    class AntigravityExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +shouldRetry()
        +refreshCredentials()
    }

    class CursorExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseResponse()
        +generateChecksum()
    }

    class KiroExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseEventStream()
        +refreshCredentials()
    }

    BaseExecutor <|-- DefaultExecutor
    BaseExecutor <|-- AntigravityExecutor
    BaseExecutor <|-- CursorExecutor
    BaseExecutor <|-- KiroExecutor
    BaseExecutor <|-- CodexExecutor
    BaseExecutor <|-- GeminiCLIExecutor
    BaseExecutor <|-- GithubExecutor
```

| рдирд┐рд╖реНрдкрд╛рджрдХ         | рдкреНрд░рджрд╛рддрд╛                                         | рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛рдПрдВ                                                                                                          |
| ---------------- | ----------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| `base.ts`        | тАФ                                               | рд╕рд╛рд░ рдЖрдзрд╛рд░: рдпреВрдЖрд░рдПрд▓ рдирд┐рд░реНрдорд╛рдг, рд╣реЗрдбрд░, рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рддрд░реНрдХ, рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рддрд╛рдЬрд╝рд╛                                                          |
| `default.ts`     | рдХреНрд▓рд╛рдЙрдб, рдЬреЗрдорд┐рдиреА, рдУрдкрдирдПрдЖрдИ, рдЬреАрдПрд▓рдПрдо, рдХрд┐рдореА, рдорд┐рдиреАрдореИрдХреНрд╕ | рдорд╛рдирдХ рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬреЗрдиреЗрд░рд┐рдХ OAuth рдЯреЛрдХрди рддрд╛рдЬрд╝рд╛ рдХрд░реЗрдВ                                                                          |
| `antigravity.ts` | рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдХреЛрдб                                 | рдкреНрд░реЛрдЬреЗрдХреНрдЯ/рд╕рддреНрд░ рдЖрдИрдбреА рдЬрдирд░реЗрд╢рди, рдорд▓реНрдЯреА-рдпреВрдЖрд░рдПрд▓ рдлрд╝реЙрд▓рдмреИрдХ, рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рд╕реЗ рдХрд╕реНрдЯрдо рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдкрд╛рд░реНрд╕рд┐рдВрдЧ ("2h7m23s рдХреЗ рдмрд╛рдж рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ") |
| `cursor.ts`      | рдХрд░реНрд╕рд░ рдЖрдИрдбреАрдИ                                     | **рд╕рдмрд╕реЗ рдЬрдЯрд┐рд▓**: SHA-256 рдЪреЗрдХрд╕рдо рдСрде, рдкреНрд░реЛрдЯреЛрдмрдл рдЕрдиреБрд░реЛрдз рдПрдиреНрдХреЛрдбрд┐рдВрдЧ, рдмрд╛рдЗрдирд░реА рдЗрд╡реЗрдВрдЯрд╕реНрдЯреНрд░реАрдо тЖТ SSE рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрд╛рд░реНрд╕рд┐рдВрдЧ                   |
| `codex.ts`       | рдУрдкрдирдПрдЖрдИ рдХреЛрдбреЗрдХреНрд╕                                  | рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рд╕реЛрдЪ рдХреЗ рд╕реНрддрд░ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЕрд╕рдорд░реНрдерд┐рдд рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╣рдЯрд╛рддрд╛ рд╣реИ                          |
| `gemini-cli.ts`  | рдЧреВрдЧрд▓ рдЬреЗрдорд┐рдиреА рд╕реАрдПрд▓рдЖрдИ                              | рдХрд╕реНрдЯрдо рдпреВрдЖрд░рдПрд▓ рдмрд┐рд▓реНрдбрд┐рдВрдЧ (`streamGenerateContent`), Google OAuth рдЯреЛрдХрди рд░рд┐рдлреНрд░реЗрд╢                                                   |
| `github.ts`      | рдЧрд┐рдЯрд╣рдм рдХреЛрдкрд╛рдпрд▓рдЯ                                   | рджреЛрд╣рд░реА рдЯреЛрдХрди рдкреНрд░рдгрд╛рд▓реА (GitHub OAuth + Copilot рдЯреЛрдХрди), VSCode рд╣реЗрдбрд░ рдХреА рдирдХрд▓                                                         |
| `kiro.ts`        | рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рдХреЛрдбрд╡реНрд╣рд┐рд╕реНрдкрд░рд░                         | рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рдЗрд╡реЗрдВрдЯрд╕реНрдЯреНрд░реАрдо рдмрд╛рдЗрдирд░реА рдкрд╛рд░реНрд╕рд┐рдВрдЧ, рдПрдПрдордЬреЗрдбрдПрди рдЗрд╡реЗрдВрдЯ рдлреНрд░реЗрдо, рдЯреЛрдХрди рдЕрдиреБрдорд╛рди                                                   |
| `index.ts`       | тАФ                                               | рдлрд╝реИрдХреНрдЯрд░реА: рдорд╛рдирдЪрд┐рддреНрд░ рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдирд╛рдо тЖТ рдирд┐рд╖реНрдкрд╛рджрдХ рд╡рд░реНрдЧ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдлрд╝реЙрд▓рдмреИрдХ рдХреЗ рд╕рд╛рде                                                   |

---

### 4.3 рд╣реИрдВрдбрд▓рд░ (`open-sse/handlers/`)

**рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдкрд░рдд** - рдЕрдиреБрд╡рд╛рдж, рдирд┐рд╖реНрдкрд╛рджрди, рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдФрд░ рддреНрд░реБрдЯрд┐ рдкреНрд░рдмрдВрдзрди рдХрд╛ рд╕рдордиреНрд╡рдп рдХрд░рддреА рд╣реИред

| рдлрд╝рд╛рдЗрд▓                 | рдЙрджреНрджреЗрд╢реНрдп                                                                                                                                                                                                                       |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `chatCore.ts`         | **рдХреЗрдВрджреНрд░реАрдп рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░** (~600 рдкрдВрдХреНрддрд┐рдпрд╛рдБ)ред рд╕рдВрдкреВрд░реНрдг рдЕрдиреБрд░реЛрдз рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ: рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ тЖТ рдЕрдиреБрд╡рд╛рдж тЖТ рдирд┐рд╖реНрдкрд╛рджрдХ рдкреНрд░реЗрд╖рдг тЖТ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ/рдЧреИрд░-рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ тЖТ рдЯреЛрдХрди рддрд╛рдЬрд╝рд╛ рдХрд░рдирд╛ тЖТ рддреНрд░реБрдЯрд┐ рдкреНрд░рдмрдВрдзрди тЖТ рдЙрдкрдпреЛрдЧ рд▓реЙрдЧрд┐рдВрдЧред |
| `responsesHandler.ts` | OpenAI рдХреЗ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдПрдкреАрдЖрдИ рдХреЗ рд▓рд┐рдП рдПрдбрд╛рдкреНрдЯрд░: рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдлреЙрд░реНрдореЗрдЯ рдХреЛ рдХрдирд╡рд░реНрдЯ рдХрд░рддрд╛ рд╣реИ тЖТ рдЪреИрдЯ рдХрдВрдкреНрд▓реАрдЯреЗрд╢рди тЖТ `chatCore` рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ тЖТ SSE рдХреЛ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рд╡рд╛рдкрд╕ рдХрдирд╡рд░реНрдЯ рдХрд░рддрд╛ рд╣реИред                                                    |
| `embeddings.ts`       | рдПрдВрдмреЗрдбрд┐рдВрдЧ рдЬреЗрдирд░реЗрд╢рди рд╣реИрдВрдбрд▓рд░: рдПрдВрдмреЗрдбрд┐рдВрдЧ рдореЙрдбрд▓ тЖТ рдкреНрд░рджрд╛рддрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ, рдкреНрд░рджрд╛рддрд╛ рдПрдкреАрдЖрдИ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ, рдУрдкрдирдПрдЖрдИ-рд╕рдВрдЧрдд рдПрдВрдмреЗрдбрд┐рдВрдЧ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИред 6+ рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред                                                           |
| `imageGeneration.ts`  | рдЫрд╡рд┐ рдирд┐рд░реНрдорд╛рдг рд╣реИрдВрдбрд▓рд░: рдЫрд╡рд┐ рдореЙрдбрд▓ тЖТ рдкреНрд░рджрд╛рддрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ, рдУрдкрдирдПрдЖрдИ-рд╕рдВрдЧрдд, рдЬреЗрдорд┐рдиреА-рдЫрд╡рд┐ (рдПрдВрдЯреАрдЧреНрд░реЗрд╡рд┐рдЯреА), рдФрд░ рдлрд╝реЙрд▓рдмреИрдХ (рдиреЗрдмрд┐рдпрд╕) рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдмреЗрд╕64 рдпрд╛ рдпреВрдЖрд░рдПрд▓ рдЫрд╡рд┐рдпрд╛рдБ рд▓реМрдЯрд╛рддрд╛ рд╣реИред                                                     |

#### рдЕрдиреБрд░реЛрдз рдЬреАрд╡рдирдЪрдХреНрд░ (chatCore.ts)

**OMNI_рдЯреЛрдХрди_5**

---

### 4.4 рд╕реЗрд╡рд╛рдПрдБ (`open-sse/services/`)

рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдЬреЛ рд╕рдВрдЪрд╛рд▓рдХреЛрдВ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрдХреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред

| рдлрд╝рд╛рдЗрд▓                | рдЙрджреНрджреЗрд╢реНрдп                                                                                                                                                                                                                                                                                                                                                                   |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `provider.ts`        | **рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛** (`detectFormat`): рдХреНрд▓реЙрдб/рдУрдкрдирдПрдЖрдИ/рдЬреЗрдорд┐рдиреА/рдПрдВрдЯреАрдЧреНрд░реЗрд╡рд┐рдЯреА/рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдмреЙрдбреА рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ (рдХреНрд▓рд╛рдЙрдб рдХреЗ рд▓рд┐рдП `max_tokens` рдЕрдиреБрдорд╛рди рд╢рд╛рдорд┐рд▓ рд╣реИ)ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛: рдпреВрдЖрд░рдПрд▓ рдмрд┐рд▓реНрдбрд┐рдВрдЧ, рд╣реЗрдбрд░ рдмрд┐рд▓реНрдбрд┐рдВрдЧ, рдерд┐рдВрдХрд┐рдВрдЧ рдХреЙрдиреНрдлрд┐рдЧ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдгред `openai-compatible-*` рдФрд░ `anthropic-compatible-*` рдЧрддрд┐рд╢реАрд▓ рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред |
| `model.ts`           | рдореЙрдбрд▓ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкрд╛рд░реНрд╕рд┐рдВрдЧ (`claude/model-name` тЖТ `{provider: "claude", model: "model-name"}`), рдЯрдХрд░рд╛рд╡ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд╕рд╛рде рдЙрдкрдирд╛рдо рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди, рдЗрдирдкреБрдЯ рд╕реИрдирд┐рдЯрд╛рдЗрдЬреЗрд╢рди (рдкрде рдЯреНрд░реИрд╡рд░реНрд╕рд▓/рдирд┐рдпрдВрддреНрд░рдг рд╡рд░реНрдг рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ), рдФрд░ рдПрд╕рд┐рдВрдХ рдЙрдкрдирд╛рдо рдЧреЗрдЯрд░ рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде рдореЙрдбрд▓ рдЬрд╛рдирдХрд╛рд░реА рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рдиред                                                                                                   |
| `accountFallback.ts` | рджрд░-рд╕реАрдорд╛ рдкреНрд░рдмрдВрдзрди: рдШрд╛рддреАрдп рдмреИрдХрдСрдлрд╝ (1s тЖТ 2s тЖТ 4s тЖТ рдЕрдзрд┐рдХрддрдо 2 рдорд┐рдирдЯ), рдЦрд╛рддрд╛ рдХреВрд▓реНрдбрд╛рдЙрди рдкреНрд░рдмрдВрдзрди, рддреНрд░реБрдЯрд┐ рд╡рд░реНрдЧреАрдХрд░рдг (рдХреМрди рд╕реА рддреНрд░реБрдЯрд┐рдпрд╛рдБ рдлрд╝реЙрд▓рдмреИрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреА рд╣реИрдВ рдмрдирд╛рдо рдирд╣реАрдВ)ред                                                                                                                                                                                                              |
| `tokenRefresh.ts`    | **рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рджрд╛рддрд╛** рдХреЗ рд▓рд┐рдП OAuth рдЯреЛрдХрди рддрд╛рдЬрд╝рд╛ рдХрд░реЗрдВ: Google (рдорд┐рдереБрди, рдПрдВрдЯреАрдЧреНрд░реЗрд╡рд┐рдЯреА), рдХреНрд▓рд╛рдЙрдб, рдХреЛрдбреЗрдХреНрд╕, рдХреНрд╡реЗрди, iFlow, GitHub (OAuth + Copilot рдбреБрдЕрд▓-рдЯреЛрдХрди), рдХрд┐рд░реЛ (AWS SSO OIDC + рд╕реЛрд╢рд▓ рдСрде)ред рдЗрд╕рдореЗрдВ рдЗрди-рдлрд╝реНрд▓рд╛рдЗрдЯ рдкреНрд░реЙрдорд┐рд╕ рдбрд┐рдбреБрдкреНрд▓реАрдХреЗрд╢рди рдХреИрд╢ рдФрд░ рдПрдХреНрд╕рдкреЛрдиреЗрдВрд╢рд┐рдпрд▓ рдмреИрдХрдСрдлрд╝ рдХреЗ рд╕рд╛рде рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рд╢рд╛рдорд┐рд▓ рд╣реИред                                                                                          |
| `combo.ts`           | **рдХреЙрдореНрдмреЛ рдореЙрдбрд▓**: рдлрд╝реЙрд▓рдмреИрдХ рдореЙрдбрд▓ рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛рдПрдБред рдпрджрд┐ рдореЙрдбрд▓ рдП рдлрд╝реЙрд▓рдмреИрдХ-рдпреЛрдЧреНрдп рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдореЙрдбрд▓ рдмреА, рдлрд┐рд░ рд╕реА, рдЖрджрд┐ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЕрдкрд╕реНрдЯреНрд░реАрдо рд╕реНрдерд┐рддрд┐ рдХреЛрдб рд▓реМрдЯрд╛рддрд╛ рд╣реИред                                                                                                                                                                                      |
| `usage.ts`           | рдкреНрд░рджрд╛рддрд╛ рдПрдкреАрдЖрдИ (рдЧрд┐рдЯрд╣рдм рдХреЛрдкрд╛рдпрд▓рдЯ рдХреЛрдЯрд╛, рдПрдВрдЯреАрдЧреНрд░реЗрд╡рд┐рдЯреА рдореЙрдбрд▓ рдХреЛрдЯрд╛, рдХреЛрдбреЗрдХреНрд╕ рджрд░ рд╕реАрдорд╛, рдХрд┐рд░реЛ рдЙрдкрдпреЛрдЧ рдмреНрд░реЗрдХрдбрд╛рдЙрди, рдХреНрд▓рд╛рдЙрдб рд╕реЗрдЯрд┐рдВрдЧреНрд╕) рд╕реЗ рдХреЛрдЯрд╛/рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                                                     |
| `accountSelector.ts` | рд╕реНрдХреЛрд░рд┐рдВрдЧ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╕рд╛рде рд╕реНрдорд╛рд░реНрдЯ рдЦрд╛рддрд╛ рдЪрдпрди: рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдЗрд╖реНрдЯрддрдо рдЦрд╛рддрд╛ рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдердорд┐рдХрддрд╛, рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕реНрдерд┐рддрд┐, рд░рд╛рдЙрдВрдб-рд░реЙрдмрд┐рди рд╕реНрдерд┐рддрд┐ рдФрд░ рдХреВрд▓рдбрд╛рдЙрди рд╕реНрдерд┐рддрд┐ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                           |
| `contextManager.ts`  | рдЕрдиреБрд░реЛрдз рд╕рдВрджрд░реНрдн рдЬреАрд╡рдирдЪрдХреНрд░ рдкреНрд░рдмрдВрдзрди: рдбрд┐рдмрдЧрд┐рдВрдЧ рдФрд░ рд▓реЙрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдореЗрдЯрд╛рдбреЗрдЯрд╛ (рдЕрдиреБрд░реЛрдз рдЖрдИрдбреА, рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк, рдкреНрд░рджрд╛рддрд╛ рдЬрд╛рдирдХрд╛рд░реА) рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐-рдЕрдиреБрд░реЛрдз рд╕рдВрджрд░реНрдн рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                               |
| `ipFilter.ts`        | рдЖрдИрдкреА-рдЖрдзрд╛рд░рд┐рдд рдЕрднрд┐рдЧрдо рдирд┐рдпрдВрддреНрд░рдг: рдЕрдиреБрдорддрд┐ рд╕реВрдЪреА рдФрд░ рдмреНрд▓реЙрдХрд▓рд┐рд╕реНрдЯ рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдПрдкреАрдЖрдИ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдирд┐рдпрдореЛрдВ рдХреЗ рд╡рд┐рд░реБрджреНрдз рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдкреА рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                   |
| `sessionManager.ts`  | рдХреНрд▓рд╛рдЗрдВрдЯ рдлрд╝рд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рд╕рддреНрд░ рдЯреНрд░реИрдХрд┐рдВрдЧ: рд╣реИрд╢ рдХрд┐рдП рдЧрдП рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдХреНрд░рд┐рдп рд╕рддреНрд░реЛрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдирдЬрд╝рд░ рд░рдЦрддрд╛ рд╣реИ, рдФрд░ рд╕рддреНрд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                          |
| `signatureCache.ts`  | рдЕрдиреБрд░реЛрдз рд╣рд╕реНрддрд╛рдХреНрд╖рд░-рдЖрдзрд╛рд░рд┐рдд рдбрд┐рдбреБрдкреНрд▓реАрдХреЗрд╢рди рдХреИрд╢: рд╣рд╛рд▓ рдХреЗ рдЕрдиреБрд░реЛрдз рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреЛ рдХреИрд╢ рдХрд░рдХреЗ рдФрд░ рдПрдХ рд╕рдордп рд╡рд┐рдВрдбреЛ рдХреЗ рднреАрддрд░ рд╕рдорд╛рди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдХреИрд╢реНрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд▓реМрдЯрд╛рдХрд░ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред                                                                                                                                                                                 |
| `systemPrompt.ts`    | рд╡реИрд╢реНрд╡рд┐рдХ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди: рдкреНрд░рддрд┐-рдкреНрд░рджрд╛рддрд╛ рд╕рдВрдЧрддрддрд╛ рдкреНрд░рдмрдВрдзрди рдХреЗ рд╕рд╛рде, рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ рдХреЛ рдЬреЛрдбрд╝рддрд╛ рдпрд╛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред                                                                                                                                                                                                               |
| `thinkingBudget.ts`  | рд░реАрдЬрд╝рдирд┐рдВрдЧ рдЯреЛрдХрди рдмрдЬрдЯ рдкреНрд░рдмрдВрдзрди: рд╕реЛрдЪ/рддрд░реНрдХ рдЯреЛрдХрди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рдереНрд░реВ, рдСрдЯреЛ (рд╕реНрдЯреНрд░рд┐рдк рдерд┐рдВрдХрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди), рдХрд╕реНрдЯрдо (рдирд┐рд╢реНрдЪрд┐рдд рдмрдЬрдЯ), рдФрд░ рдЕрдиреБрдХреВрд▓реА (рдЬрдЯрд┐рд▓рддрд╛-рд╕реНрдХреЗрд▓) рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                       |
| `wildcardRouter.ts`  | рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдореЙрдбрд▓ рдкреИрдЯрд░реНрди рд░реВрдЯрд┐рдВрдЧ: рдЙрдкрд▓рдмреНрдзрддрд╛ рдФрд░ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдкреИрдЯрд░реНрди (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `*/claude-*`) рдХреЛ рдареЛрд╕ рдкреНрд░рджрд╛рддрд╛/рдореЙрдбрд▓ рдЬреЛрдбрд╝реЗ рдореЗрдВ рд╣рд▓ рдХрд░рддрд╛ рд╣реИред                                                                                                                                                                                                               |

#### рдЯреЛрдХрди рд░рд┐рдлреНрд░реЗрд╢ рдбрд┐рдбреБрдкреНрд▓реАрдХреЗрд╢рди

**OMNI_рдЯреЛрдХрди_6**

#### рдЦрд╛рддрд╛ рдлрд╝реЙрд▓рдмреИрдХ рд╕реНрдЯреЗрдЯ рдорд╢реАрди

```mermaid
stateDiagram-v2
    [*] --> Active
    Active --> Error: Request fails (401/429/500)
    Error --> Cooldown: Apply backoff
    Cooldown --> Active: Cooldown expires
    Active --> Active: Request succeeds (reset backoff)

    state Error {
        [*] --> ClassifyError
        ClassifyError --> ShouldFallback: Rate limit / Auth / Transient
        ClassifyError --> NoFallback: 400 Bad Request
    }

    state Cooldown {
        [*] --> ExponentialBackoff
        ExponentialBackoff: Level 0 = 1s
        ExponentialBackoff: Level 1 = 2s
        ExponentialBackoff: Level 2 = 4s
        ExponentialBackoff: Max = 2min
    }
```

#### рдХреЙрдореНрдмреЛ рдореЙрдбрд▓ рд╢реНрд░реГрдВрдЦрд▓рд╛

**OMNI_рдЯреЛрдХрди_8**

---

### 4.5 рдЕрдиреБрд╡рд╛рджрдХ (`open-sse/translator/`)

рд╕реНрд╡-рдкрдВрдЬреАрдХрд░рдг рдкреНрд▓рдЧрдЗрди рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рд╛рд░реВрдк рдЕрдиреБрд╡рд╛рдж рдЗрдВрдЬрди**ред

#### рд╡рд╛рд╕реНрддреБрдХрд▓рд╛

```mermaid
graph TD
    subgraph "Request Translation"
        A["Claude тЖТ OpenAI"]
        B["Gemini тЖТ OpenAI"]
        C["Antigravity тЖТ OpenAI"]
        D["OpenAI Responses тЖТ OpenAI"]
        E["OpenAI тЖТ Claude"]
        F["OpenAI тЖТ Gemini"]
        G["OpenAI тЖТ Kiro"]
        H["OpenAI тЖТ Cursor"]
    end

    subgraph "Response Translation"
        I["Claude тЖТ OpenAI"]
        J["Gemini тЖТ OpenAI"]
        K["Kiro тЖТ OpenAI"]
        L["Cursor тЖТ OpenAI"]
        M["OpenAI тЖТ Claude"]
        N["OpenAI тЖТ Antigravity"]
        O["OpenAI тЖТ Responses"]
    end
```

| рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛       | рдлрд╝рд╛рдЗрд▓реЗрдВ   | рд╡рд┐рд╡рд░рдг                                                                                                                                                                                                                                                             |
| ---------------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `request/`       | 8 рдЕрдиреБрд╡рд╛рджрдХ | рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдиреБрд░реЛрдз рдирд┐рдХрд╛рдпреЛрдВ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВред рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдЖрдпрд╛рдд рдкрд░ `register(from, to, fn)` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрд╡-рдкрдВрдЬреАрдХреГрдд рд╣реЛрддреА рд╣реИред                                                                                                                              |
| `response/`      | 7 рдЕрдиреБрд╡рд╛рджрдХ | рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреЗ рдмреАрдЪ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЦрдВрдбреЛрдВ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВред рдПрд╕рдПрд╕рдИ рдЗрд╡реЗрдВрдЯ рдкреНрд░рдХрд╛рд░, рдерд┐рдВрдХрд┐рдВрдЧ рдмреНрд▓реЙрдХ, рдЯреВрд▓ рдХреЙрд▓ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред                                                                                                                                        |
| `helpers/`       | 6 рд╕рд╣рд╛рдпрдХ   | рд╕рд╛рдЭрд╛ рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ: `claudeHelper` (рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ рдирд┐рд╖реНрдХрд░реНрд╖рдг, рд╕реЛрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди), `geminiHelper` (рднрд╛рдЧ/рд╕рд╛рдордЧреНрд░реА рдореИрдкрд┐рдВрдЧ), `openaiHelper` (рдкреНрд░рд╛рд░реВрдк рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ), `toolCallHelper` (рдЖрдИрдбреА рдЬрдирд░реЗрд╢рди, рдЕрдиреБрдкрд▓рдмреНрдз рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди), `maxTokensHelper`, `responsesApiHelper`ред |
| `index.ts`       | тАФ         | рдЕрдиреБрд╡рд╛рдж рдЗрдВрдЬрди: `translateRequest()`, `translateResponse()`, рд░рд╛рдЬреНрдп рдкреНрд░рдмрдВрдзрди, рд░рдЬрд┐рд╕реНрдЯреНрд░реАред                                                                                                                                                                               |
| **OMNI_рдЯреЛрдХрди_86** | тАФ         | рдкреНрд░рд╛рд░реВрдк рд╕реНрдерд┐рд░рд╛рдВрдХ: `OPENAI`, `CLAUDE`, `GEMINI`, `ANTIGRAVITY`, `KIRO`, `CURSOR`, `OPENAI_RESPONSES`ред                                                                                                                                                              |

#### рдореБрдЦреНрдп рдбрд┐рдЬрд╝рд╛рдЗрди: рд╕реНрд╡-рдкрдВрдЬреАрдХрд░рдг рдкреНрд▓рдЧрдЗрдиреНрд╕

```javascript
// Each translator file calls register() on import:
import { register } from "../index.js";
register("claude", "openai", translateClaudeToOpenAI);

// The index.js imports all translator files, triggering registration:
import "./request/claude-to-openai.js"; // тЖР self-registers
```

---

### 4.6 рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ (`open-sse/utils/`)

| рдлрд╝рд╛рдЗрд▓              | рдЙрджреНрджреЗрд╢реНрдп                                                                                                                                                                                                                                                                         |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `error.ts`         | рддреНрд░реБрдЯрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд┐рд░реНрдорд╛рдг (рдУрдкрдирдПрдЖрдИ-рд╕рдВрдЧрдд рдкреНрд░рд╛рд░реВрдк), рдЕрдкрд╕реНрдЯреНрд░реАрдо рддреНрд░реБрдЯрд┐ рдкрд╛рд░реНрд╕рд┐рдВрдЧ, рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рд╕реЗ рдПрдВрдЯреАрдЧреНрд░реЗрд╡рд┐рдЯреА рд░рд┐рдЯреНрд░реА-рдЯрд╛рдЗрдо рдирд┐рд╖реНрдХрд░реНрд╖рдг, рдПрд╕рдПрд╕рдИ рддреНрд░реБрдЯрд┐ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧред                                                                                                                      |
| `stream.ts`        | **рдПрд╕рдПрд╕рдИ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рд╕реНрдЯреНрд░реАрдо** - рдХреЛрд░ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиред рджреЛ рдореЛрдб: `TRANSLATE` (рдкреВрд░реНрдг рдкреНрд░рд╛рд░реВрдк рдЕрдиреБрд╡рд╛рдж) рдФрд░ `PASSTHROUGH` (рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг + рдЙрдкрдпреЛрдЧ рдирд┐рдХрд╛рд▓реЗрдВ)ред рдЪрдВрдХ рдмрдлрд╝рд░рд┐рдВрдЧ, рдЙрдкрдпреЛрдЧ рдЕрдиреБрдорд╛рди, рд╕рд╛рдордЧреНрд░реА рд▓рдВрдмрд╛рдИ рдЯреНрд░реИрдХрд┐рдВрдЧ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред рдкреНрд░рддрд┐-рд╕реНрдЯреНрд░реАрдо рдПрдирдХреЛрдбрд░/рдбрд┐рдХреЛрдбрд░ рдЙрджрд╛рд╣рд░рдг рд╕рд╛рдЭрд╛ рд╕реНрдерд┐рддрд┐ рд╕реЗ рдмрдЪрддреЗ рд╣реИрдВред |
| `streamHelpers.ts` | рдирд┐рдореНрди-рд╕реНрддрд░реАрдп SSE рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ: `parseSSELine` (рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк-рд╕рд╣рд┐рд╖реНрдгреБ), `hasValuableContent` (OpenAI/рдХреНрд▓рд╛рдЙрдб/рдЬреЗрдорд┐рдиреА рдХреЗ рд▓рд┐рдП рдЦрд╛рд▓реА рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рддрд╛ рд╣реИ), `fixInvalidId`, `formatSSE` (`perf_metrics` рдХреНрд▓реАрдирдЕрдк рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рд░реВрдк-рдЬрд╛рдЧрд░реВрдХ SSE рдХреНрд░рдордмрджреНрдзрддрд╛)ред                                  |
| `usageTracking.ts` | рдХрд┐рд╕реА рднреА рдкреНрд░рд╛рд░реВрдк рд╕реЗ рдЯреЛрдХрди рдЙрдкрдпреЛрдЧ рдирд┐рд╖реНрдХрд░реНрд╖рдг (рдХреНрд▓рд╛рдЙрдб/рдУрдкрдирдПрдЖрдИ/рдорд┐рдереБрди/рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ), рдЕрд▓рдЧ рдЯреВрд▓/рд╕рдВрджреЗрд╢ рдЪрд╛рд░-рдкреНрд░рддрд┐-рдЯреЛрдХрди рдЕрдиреБрдкрд╛рдд рдХреЗ рд╕рд╛рде рдЕрдиреБрдорд╛рди, рдмрдлрд░ рдЬреЛрдбрд╝ (2000 рдЯреЛрдХрди рд╕реБрд░рдХреНрд╖рд╛ рдорд╛рд░реНрдЬрд┐рди), рдкреНрд░рд╛рд░реВрдк-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝реАрд▓реНрдб рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ, рдПрдПрдирдПрд╕рдЖрдИ рд░рдВрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдХрдВрд╕реЛрд▓ рд▓реЙрдЧрд┐рдВрдЧред                                      |
| `requestLogger.ts` | рдлрд╝рд╛рдЗрд▓-рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрд░реЛрдз рд▓реЙрдЧрд┐рдВрдЧ (`ENABLE_REQUEST_LOGS=true` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдСрдкреНрдЯ-рдЗрди)ред рдХреНрд░рдорд╛рдВрдХрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рд╕рддреНрд░ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рддрд╛ рд╣реИ: `1_req_client.json` тЖТ `7_res_client.txt`ред рд╕рднреА I/O async (рджрд╛рдЧ-рдФрд░-рднреВрд▓) рд╣реИред рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЗрдбрд░ рдХреЛ рдЫреБрдкрд╛рддрд╛ рд╣реИ.                                              |
| `bypassHandler.ts` | рдХреНрд▓рд╛рдЙрдб рд╕реАрдПрд▓рдЖрдИ (рд╢реАрд░реНрд╖рдХ рдирд┐рд╖реНрдХрд░реНрд╖рдг, рд╡рд╛рд░реНрдордЕрдк, рдЧрд┐рдирддреА) рд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреИрдЯрд░реНрди рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдкреНрд░рджрд╛рддрд╛ рдХреЛ рдХреЙрд▓ рдХрд┐рдП рдмрд┐рдирд╛ рдирдХрд▓реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИред рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдФрд░ рдиреЙрди-рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рджреЛрдиреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЬрд╛рдирдмреВрдЭрдХрд░ рдХреНрд▓рд╛рдЙрдб рд╕реАрдПрд▓рдЖрдИ рджрд╛рдпрд░реЗ рддрдХ рд╕реАрдорд┐рддред                                     |
| `networkProxy.ts`  | рдХрд┐рд╕реА рджрд┐рдП рдЧрдП рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдкреНрд░реЙрдХреНрд╕реА URL рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЗ рд╕рд╛рде рд╣рд▓ рдХрд░рддрд╛ рд╣реИ: рдкреНрд░рджрд╛рддрд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди тЖТ рд╡реИрд╢реНрд╡рд┐рдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди тЖТ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ (`HTTPS_PROXY`/`HTTP_PROXY`/`ALL_PROXY`)ред `NO_PROXY` рдмрд╣рд┐рд╖реНрдХрд░рдг рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред 30 рдХреЗ рджрд╢рдХ рдХреЗ рд▓рд┐рдП рдХреИрд╢ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рдиред           |

#### рдПрд╕рдПрд╕рдИ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди

**OMNI_рдЯреЛрдХрди_11**

#### рд▓реЙрдЧрд░ рд╕рддреНрд░ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ

**OMNI_рдЯреЛрдХрди_12**

---

### 4.7 рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдкрд░рдд (`src/`)

| рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛    | рдЙрджреНрджреЗрд╢реНрдп                                                                        |
| ------------- | ------------------------------------------------------------------------------- |
| `src/app/`    | рд╡реЗрдм рдпреВрдЖрдИ, рдПрдкреАрдЖрдИ рд░реВрдЯ, рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдорд┐рдбрд▓рд╡реЗрдпрд░, рдУрдПрде рдХреЙрд▓рдмреИрдХ рд╣реИрдВрдбрд▓рд░                      |
| `src/lib/`    | рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдХреНрд╕реЗрд╕ (`localDb.ts`, `usageDb.ts`), рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рд╕рд╛рдЭрд╛                   |
| `src/mitm/`   | рдкреНрд░рджрд╛рддрд╛ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдореИрди-рдЗрди-рдж-рдорд┐рдбрд┐рд▓ рдкреНрд░реЙрдХреНрд╕реА рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ             |
| `src/models/` | рдбреЗрдЯрд╛рдмреЗрд╕ рдореЙрдбрд▓ рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ                                                          |
| `src/shared/` | рдУрдкрди-рдПрд╕рдПрд╕рдИ рдлрд╝рдВрдХреНрд╢рдВрд╕ (рдкреНрд░рджрд╛рддрд╛, рд╕реНрдЯреНрд░реАрдо, рддреНрд░реБрдЯрд┐, рдЖрджрд┐) рдХреЗ рдЖрд╕рдкрд╛рд╕ рд░реИрдкрд░                |
| `src/sse/`    | рдПрд╕рдПрд╕рдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╣реИрдВрдбрд▓рд░ рдЬреЛ рдУрдкрди-рдПрд╕рдПрд╕рдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдорд╛рд░реНрдЧреЛрдВ рд╕реЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ |
| `src/store/`  | рдЖрд╡реЗрджрди рд░рд╛рдЬреНрдп рдкреНрд░рдмрдВрдзрди                                                             |

#### рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рдПрдкреАрдЖрдИ рд░реВрдЯ

| рдорд╛рд░реНрдЧ                                         | рддрд░реАрдХреЗ                         | рдЙрджреНрджреЗрд╢реНрдп                                                                        |
| --------------------------------------------- | ----------------------------- | ------------------------------------------------------------------------------- |
| `/api/provider-models`                        | рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ/рдкреЛрд╕реНрдЯ рдХрд░реЗрдВ/рд╣рдЯрд╛рдПрдВ | рдкреНрд░рддрд┐ рдкреНрд░рджрд╛рддрд╛ рдХрд╕реНрдЯрдо рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рд╕реАрдЖрд░рдпреВрдбреА                                        |
| `/api/models/catalog`                         | рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                  | рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рд╕рдореВрд╣реАрдХреГрдд рд╕рднреА рдореЙрдбрд▓реЛрдВ (рдЪреИрдЯ, рдПрдореНрдмреЗрдбрд┐рдВрдЧ, рдЫрд╡рд┐, рдХрд╕реНрдЯрдо) рдХреА рдПрдХрддреНрд░рд┐рдд рд╕реВрдЪреА |
| `/api/settings/proxy`                         | рдкреНрд░рд╛рдкреНрдд/рдкреБрдЯ/рдбрд┐рд▓реАрдЯ             | рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдд рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдкреНрд░реЙрдХреНрд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (`global/providers/combos/keys`)     |
| `/api/settings/proxy/test`                    | рдкреЛрд╕реНрдЯ                         | рдкреНрд░реЙрдХреНрд╕реА рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА/рд╡рд┐рд▓рдВрдмрддрд╛ рд▓реМрдЯрд╛рддрд╛ рд╣реИ    |
| `/v1/providers/[provider]/chat/completions`   | рдкреЛрд╕реНрдЯ                         | рдореЙрдбрд▓ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐-рдкреНрд░рджрд╛рддрд╛ рд╕рдорд░реНрдкрд┐рдд рдЪреИрдЯ рдкреВрд░реНрдгрддрд╛рдПрдБ                         |
| `/v1/providers/[provider]/embeddings`         | рдкреЛрд╕реНрдЯ                         | рдореЙрдбрд▓ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде рд╕рдорд░реНрдкрд┐рдд рдкреНрд░рддрд┐-рдкреНрд░рджрд╛рддрд╛ рдПрдореНрдмреЗрдбрд┐рдВрдЧ                             |
| `/v1/providers/[provider]/images/generations` | рдкреЛрд╕реНрдЯ                         | рдореЙрдбрд▓ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐-рдкреНрд░рджрд╛рддрд╛ рд╕рдорд░реНрдкрд┐рдд рдЫрд╡рд┐ рдирд┐рд░реНрдорд╛рдг                           |
| `/api/settings/ip-filter`                     | рдкреНрд░рд╛рдкреНрдд/рдбрд╛рд▓реЗрдВ                 | рдЖрдИрдкреА тАЛтАЛрдЕрдиреБрдорддрд┐ рд╕реВрдЪреА/рдЕрд╡рд░реБрджреНрдз рд╕реВрдЪреА рдкреНрд░рдмрдВрдзрди                                         |
| `/api/settings/thinking-budget`               | рдкреНрд░рд╛рдкреНрдд/рдбрд╛рд▓реЗрдВ                 | рд░реАрдЬрд╝рдирд┐рдВрдЧ рдЯреЛрдХрди рдмрдЬрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (рдкрд╛рд╕рдереНрд░реВ/рдСрдЯреЛ/рдХрд╕реНрдЯрдо/рдЕрдиреБрдХреВрд▓реА)                      |
| `/api/settings/system-prompt`                 | рдкреНрд░рд╛рдкреНрдд/рдбрд╛рд▓реЗрдВ                 | рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рд╡реИрд╢реНрд╡рд┐рдХ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди                           |
| `/api/sessions`                               | рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                  | рд╕рдХреНрд░рд┐рдп рд╕рддреНрд░ рдЯреНрд░реИрдХрд┐рдВрдЧ рдФрд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕                                               |
| `/api/rate-limits`                            | рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                  | рдкреНрд░рддрд┐ рдЦрд╛рддрд╛ рджрд░ рд╕реАрдорд╛ рд╕реНрдерд┐рддрд┐                                                       |

---

## 5. рдореБрдЦреНрдп рдбрд┐рдЬрд╝рд╛рдЗрди рдкреИрдЯрд░реНрди

### 5.1 рд╣рдм-рдПрдВрдб-рд╕реНрдкреЛрдХ рдЕрдиреБрд╡рд╛рдж

рд╕рднреА рдкреНрд░рд╛рд░реВрдк **рд╣рдм рдХреЗ рд░реВрдк рдореЗрдВ рдУрдкрдирдПрдЖрдИ рдкреНрд░рд╛рд░реВрдк** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдПрдХ рдирдпрд╛ рдкреНрд░рджрд╛рддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдЕрдиреБрд╡рд╛рджрдХреЛрдВ рдХреА **рдПрдХ рдЬреЛрдбрд╝реА** (OpenAI рд╕реЗ/рд╕реЗ) рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, N рдЬреЛрдбрд╝реА рдХреА рдирд╣реАрдВред

### 5.2 рдирд┐рд╖реНрдкрд╛рджрдХ рд░рдгрдиреАрддрд┐ рдкреИрдЯрд░реНрди

рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рдкрд╛рд╕ `BaseExecutor` рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рдПрдХ рд╕рдорд░реНрдкрд┐рдд рдирд┐рд╖реНрдкрд╛рджрдХ рд╡рд░реНрдЧ рд╣реЛрддрд╛ рд╣реИред `executors/index.ts` рдореЗрдВ рдлрд╝реИрдХреНрдЯрд░реА рд░рдирдЯрд╛рдЗрдо рдкрд░ рд╕рд╣реА рдХрд╛ рдЪрдпрди рдХрд░рддреА рд╣реИред

### 5.3 рд╕реНрд╡-рдкрдВрдЬреАрдХрд░рдг рдкреНрд▓рдЧрдЗрди рд╕рд┐рд╕реНрдЯрдо

рдЕрдиреБрд╡рд╛рджрдХ рдореЙрдбреНрдпреВрд▓ `register()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдпрд╛рдд рдкрд░ рд╕реНрд╡рдпрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рддреЗ рд╣реИрдВред рдПрдХ рдирдпрд╛ рдЕрдиреБрд╡рд╛рджрдХ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдЕрд░реНрде рдХреЗрд╡рд▓ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдирд╛ рдФрд░ рдЙрд╕реЗ рдЖрдпрд╛рдд рдХрд░рдирд╛ рд╣реИред

### 5.4 рдПрдХреНрд╕рдкреЛрдиреЗрдВрд╢рд┐рдпрд▓ рдмреИрдХрдСрдлрд╝ рдХреЗ рд╕рд╛рде рдЦрд╛рддрд╛ рдлрд╝реЙрд▓рдмреИрдХ

рдЬрдм рдХреЛрдИ рдкреНрд░рджрд╛рддрд╛ 429/401/500 рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдШрд╛рддреАрдп рдХреВрд▓рдбрд╛рдЙрди (1s тЖТ 2s тЖТ 4s тЖТ рдЕрдзрд┐рдХрддрдо 2 рдорд┐рдирдЯ) рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реБрдП, рдЕрдЧрд▓реЗ рдЦрд╛рддреЗ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### 5.5 рдХреЙрдореНрдмреЛ рдореЙрдбрд▓ рдЪреЗрди

рдПрдХ "рдХреЙрдореНрдмреЛ" рдХрдИ `provider/model` рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рд╕рдореВрд╣рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдкрд╣рд▓рд╛ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдЧрд▓реЗ рдкрд░ рдлрд╝реЙрд▓рдмреИрдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

### 5.6 рд╕реНрдЯреЗрдЯрдлреБрд▓ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдЕрдиреБрд╡рд╛рдж

рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЕрдиреБрд╡рд╛рдж `initState()` рддрдВрддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ SSE рдЦрдВрдбреЛрдВ (рд╕реЛрдЪ рдмреНрд▓реЙрдХ рдЯреНрд░реИрдХрд┐рдВрдЧ, рдЯреВрд▓ рдХреЙрд▓ рд╕рдВрдЪрдп, рд╕рд╛рдордЧреНрд░реА рдмреНрд▓реЙрдХ рдЕрдиреБрдХреНрд░рдордг) рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИред

### 5.7 рдЙрдкрдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛ рдмрдлрд░

рд╕рд┐рд╕реНрдЯрдо рд╕рдВрдХреЗрддреЛрдВ рдФрд░ рдкреНрд░рд╛рд░реВрдк рдЕрдиреБрд╡рд╛рдж рд╕реЗ рдУрд╡рд░рд╣реЗрдб рдХреЗ рдХрд╛рд░рдг рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рд╕рдВрджрд░реНрдн рд╡рд┐рдВрдбреЛ рд╕реАрдорд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд░рд┐рдкреЛрд░реНрдЯ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧ рдореЗрдВ 2000-рдЯреЛрдХрди рдмрдлрд░ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред

---

## 6. рд╕рдорд░реНрдерд┐рдд рдкреНрд░рд╛рд░реВрдк

| рдкреНрд░рд╛рд░реВрдк                | рджрд┐рд╢рд╛           | рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛         |
| ---------------------- | -------------- | ------------------ |
| OpenAI рдЪреИрдЯ рдкреВрд░реНрдгрддрд╛рдПрдБ   | рд╕реНрд░реЛрдд + рд▓рдХреНрд╖реНрдп | `openai`           |
| рдУрдкрдирдПрдЖрдИ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдПрдкреАрдЖрдИ | рд╕реНрд░реЛрдд + рд▓рдХреНрд╖реНрдп | `openai-responses` |
| рдПрдВрдереНрд░реЛрдкрд┐рдХ рдХреНрд▓рд╛рдЙрдб       | рд╕реНрд░реЛрдд + рд▓рдХреНрд╖реНрдп | `claude`           |
| рдЧреВрдЧрд▓ рдЬреЗрдорд┐рдиреА            | рд╕реНрд░реЛрдд + рд▓рдХреНрд╖реНрдп | `gemini`           |
| рдЧреВрдЧрд▓ рдЬреЗрдорд┐рдиреА рд╕реАрдПрд▓рдЖрдИ     | рдХреЗрд╡рд▓ рд▓рдХреНрд╖реНрдп    | `gemini-cli`       |
| рдкреНрд░рддрд┐рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг     | рд╕реНрд░реЛрдд + рд▓рдХреНрд╖реНрдп | `antigravity`      |
| рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рдХрд┐рд░реЛ        | рдХреЗрд╡рд▓ рд▓рдХреНрд╖реНрдп    | `kiro`             |
| рдХрд░реНрд╕рд░                  | рдХреЗрд╡рд▓ рд▓рдХреНрд╖реНрдп    | `cursor`           |

---

## 7. рд╕рдорд░реНрдерд┐рдд рдкреНрд░рджрд╛рддрд╛

| рдкреНрд░рджрд╛рддрд╛                  | рдкреНрд░рд╛рдорд╛рдгрд┐рдХ рд╡рд┐рдзрд┐                   | рдирд┐рд╖реНрдкрд╛рджрдХ           | рдореБрдЦреНрдп рдиреЛрдЯреНрд╕                                            |
| ------------------------ | -------------------------------- | ------------------ | ------------------------------------------------------ |
| рдПрдВрдереНрд░реЛрдкрд┐рдХ рдХреНрд▓рд╛рдЙрдб         | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА рдпрд╛ OAuth             | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | `x-api-key` рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ                      |
| рдЧреВрдЧрд▓ рдЬреЗрдорд┐рдиреА              | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА рдпрд╛ OAuth             | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | `x-goog-api-key` рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ                 |
| рдЧреВрдЧрд▓ рдЬреЗрдорд┐рдиреА рд╕реАрдПрд▓рдЖрдИ       | OAuth                            | рдЬреЗрдорд┐рдиреАрд╕реАрдПрд▓рдЖрдИ       | `streamGenerateContent` рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ   |
| рдкреНрд░рддрд┐рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг       | OAuth                            | рдкреНрд░рддрд┐рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг | рдорд▓реНрдЯреА-рдпреВрдЖрд░рдПрд▓ рдлрд╝реЙрд▓рдмреИрдХ, рдХрд╕реНрдЯрдо рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдкрд╛рд░реНрд╕рд┐рдВрдЧ       |
| рдУрдкрдирдПрдЖрдИ                   | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА                      | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдорд╛рдирдХ рд╡рд╛рд╣рдХ рдкреНрд░рд╛рдзрд┐рдХрд░рдг                                    |
| рдХреЛрдбреЗрдХреНрд╕                  | OAuth                            | рдХреЛрдбреЗрдХреНрд╕            | рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рд╕реЛрдЪ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ |
| рдЧрд┐рдЯрд╣рдм рдХреЛрдкрд╛рдпрд▓рдЯ            | OAuth + рд╕рд╣рдкрд╛рдпрд▓рдЯ рдЯреЛрдХрди             | рдЬреАрдереВрдм              | рджреЛрд╣рд░рд╛ рдЯреЛрдХрди, VSCode рд╣реЗрдбрд░ рдХреА рдирдХрд▓                         |
| рдХрд┐рд░реЛ (рдПрдбрдмреНрд▓реНрдпреВрдПрд╕)        | рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рдПрд╕рдПрд╕рдУ рдУрдЖрдИрдбреАрд╕реА рдпрд╛ рд╕реЛрд╢рд▓ | рдХрд┐рд░реЛ               | рдмрд╛рдЗрдирд░реА рдЗрд╡реЗрдВрдЯрд╕реНрдЯреНрд░реАрдо рдкрд╛рд░реНрд╕рд┐рдВрдЧ                           |
| рдХрд░реНрд╕рд░ рдЖрдИрдбреАрдИ              | рдЪреЗрдХрд╕рдо рдСрде                         | рдХрд░реНрд╕рд░              | рдкреНрд░реЛрдЯреЛрдмрдлрд╝ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ, SHA-256 рдЪреЗрдХрд╕рдо                     |
| рдХреНрд╡реЗрди                    | OAuth                            | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдорд╛рдирдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг                                        |
| рдЖрдИрдлреНрд▓реЛ                   | OAuth (рдмреЗрд╕рд┐рдХ + рдмрд┐рдпрд░рд░)            | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдбреБрдЕрд▓ рдСрде рд╣реЗрдбрд░                                           |
| рдУрдкрдирд░рд╛рдЙрдЯрд░                 | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА                      | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдорд╛рдирдХ рд╡рд╛рд╣рдХ рдкреНрд░рд╛рдзрд┐рдХрд░рдг                                    |
| рдЬреАрдПрд▓рдПрдо, рдХрд┐рдореА, рдорд┐рдиреАрдореИрдХреНрд╕  | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА                      | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдХреНрд▓рд╛рдЙрдб-рд╕рдВрдЧрдд, `x-api-key` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ                 |
| `openai-compatible-*`    | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА                      | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдЧрддрд┐рд╢реАрд▓: рдХреЛрдИ рднреА OpenAI-рд╕рдВрдЧрдд рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ                 |
| `anthropic-compatible-*` | рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА                      | рдбрд┐рдлрд╝реЙрд▓реНрдЯ           | рдЧрддрд┐рд╢реАрд▓: рдХреЛрдИ рднреА рдХреНрд▓рд╛рдЙрдб-рд╕рдВрдЧрдд рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ                 |

---

## 8. рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣ рд╕рд╛рд░рд╛рдВрд╢

### рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдЕрдиреБрд░реЛрдз

**OMNI_рдЯреЛрдХрди_13**

### рдЧреИрд░-рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдЕрдиреБрд░реЛрдз

**OMNI_рдЯреЛрдХрди_14**

### рдмрд╛рдИрдкрд╛рд╕ рдкреНрд░рд╡рд╛рд╣ (рдХреНрд▓рд╛рдЙрдб рд╕реАрдПрд▓рдЖрдИ)

**OMNI_рдЯреЛрдХрди_15**
