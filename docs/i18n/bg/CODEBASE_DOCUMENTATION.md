# omniroute ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –∫–æ–¥–æ–≤–∞—Ç–∞ –±–∞–∑–∞

üåê **Languages:** üá∫üá∏ [English](../../CODEBASE_DOCUMENTATION.md) | üáßüá∑ [Portugu√™s (Brasil)](../pt-BR/CODEBASE_DOCUMENTATION.md) | üá™üá∏ [Espa√±ol](../es/CODEBASE_DOCUMENTATION.md) | üá´üá∑ [Fran√ßais](../fr/CODEBASE_DOCUMENTATION.md) | üáÆüáπ [Italiano](../it/CODEBASE_DOCUMENTATION.md) | üá∑üá∫ [–†—É—Å—Å–∫–∏–π](../ru/CODEBASE_DOCUMENTATION.md) | üá®üá≥ [‰∏≠Êñá (ÁÆÄ‰Ωì)](../zh-CN/CODEBASE_DOCUMENTATION.md) | üá©üá™ [Deutsch](../de/CODEBASE_DOCUMENTATION.md) | üáÆüá≥ [‡§π‡§ø‡§®‡•ç‡§¶‡•Ä](../in/CODEBASE_DOCUMENTATION.md) | üáπüá≠ [‡πÑ‡∏ó‡∏¢](../th/CODEBASE_DOCUMENTATION.md) | üá∫üá¶ [–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞](../uk-UA/CODEBASE_DOCUMENTATION.md) | üá∏üá¶ [ÿßŸÑÿπÿ±ÿ®Ÿäÿ©](../ar/CODEBASE_DOCUMENTATION.md) | üáØüáµ [Êó•Êú¨Ë™û](../ja/CODEBASE_DOCUMENTATION.md) | üáªüá≥ [Ti·∫øng Vi·ªát](../vi/CODEBASE_DOCUMENTATION.md) | üáßüá¨ [–ë—ä–ª–≥–∞—Ä—Å–∫–∏](../bg/CODEBASE_DOCUMENTATION.md) | üá©üá∞ [Dansk](../da/CODEBASE_DOCUMENTATION.md) | üá´üáÆ [Suomi](../fi/CODEBASE_DOCUMENTATION.md) | üáÆüá± [◊¢◊ë◊®◊ô◊™](../he/CODEBASE_DOCUMENTATION.md) | üá≠üá∫ [Magyar](../hu/CODEBASE_DOCUMENTATION.md) | üáÆüá© [Bahasa Indonesia](../id/CODEBASE_DOCUMENTATION.md) | üá∞üá∑ [ÌïúÍµ≠Ïñ¥](../ko/CODEBASE_DOCUMENTATION.md) | üá≤üáæ [Bahasa Melayu](../ms/CODEBASE_DOCUMENTATION.md) | üá≥üá± [Nederlands](../nl/CODEBASE_DOCUMENTATION.md) | üá≥üá¥ [Norsk](../no/CODEBASE_DOCUMENTATION.md) | üáµüáπ [Portugu√™s (Portugal)](../pt/CODEBASE_DOCUMENTATION.md) | üá∑üá¥ [Rom√¢nƒÉ](../ro/CODEBASE_DOCUMENTATION.md) | üáµüá± [Polski](../pl/CODEBASE_DOCUMENTATION.md) | üá∏üá∞ [Slovenƒçina](../sk/CODEBASE_DOCUMENTATION.md) | üá∏üá™ [Svenska](../sv/CODEBASE_DOCUMENTATION.md) | üáµüá≠ [Filipino](../phi/CODEBASE_DOCUMENTATION.md)

> –ò–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–æ, —É–¥–æ–±–Ω–æ –∑–∞ –Ω–∞—á–∏–Ω–∞–µ—â–∏ —Ä—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∑–∞ **omniroute** –ø—Ä–æ–∫—Å–∏ —Ä—É—Ç–µ—Ä —Å –∏–∑–∫—É—Å—Ç–≤–µ–Ω –∏–Ω—Ç–µ–ª–µ–∫—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏.

---

## 1. –ö–∞–∫–≤–æ –µ omniroute?

omniroute –µ **–ø—Ä–æ–∫—Å–∏ —Ä—É—Ç–µ—Ä**, –∫–æ–π—Ç–æ —Å–µ –Ω–∞–º–∏—Ä–∞ –º–µ–∂–¥—É AI –∫–ª–∏–µ–Ω—Ç–∏ (Claude CLI, Codex, Cursor IDE –∏ –¥—Ä.) –∏ AI –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ (Anthropic, Google, OpenAI, AWS, GitHub –∏ –¥—Ä.). –†–µ—à–∞–≤–∞ –µ–¥–∏–Ω –≥–æ–ª—è–º –ø—Ä–æ–±–ª–µ–º:

> **–†–∞–∑–ª–∏—á–Ω–∏—Ç–µ AI –∫–ª–∏–µ–Ω—Ç–∏ –≥–æ–≤–æ—Ä—è—Ç —Ä–∞–∑–ª–∏—á–Ω–∏ ‚Äû–µ–∑–∏—Ü–∏‚Äú (API —Ñ–æ—Ä–º–∞—Ç–∏) –∏ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ –Ω–∞ AI —Å—ä—â–æ –æ—á–∞–∫–≤–∞—Ç —Ä–∞–∑–ª–∏—á–Ω–∏ ‚Äû–µ–∑–∏—Ü–∏‚Äú.** omniroute –ø—Ä–µ–≤–µ–∂–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–µ–∂–¥—É —Ç—è—Ö.

–ú–∏—Å–ª–µ—Ç–µ –∑–∞ —Ç–æ–≤–∞ –∫–∞—Ç–æ –∑–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω –ø—Ä–µ–≤–æ–¥–∞—á –≤ –û–±–µ–¥–∏–Ω–µ–Ω–∏—Ç–µ –Ω–∞—Ü–∏–∏ - –≤—Å–µ–∫–∏ –¥–µ–ª–µ–≥–∞—Ç –º–æ–∂–µ –¥–∞ –≥–æ–≤–æ—Ä–∏ –≤—Å–µ–∫–∏ –µ–∑–∏–∫ –∏ –ø—Ä–µ–≤–æ–¥–∞—á—ä—Ç –≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞ –∑–∞ –≤—Å–µ–∫–∏ –¥—Ä—É–≥ –¥–µ–ª–µ–≥–∞—Ç.

---

## 2. –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ç–∞

```mermaid
graph LR
    subgraph Clients
        A[Claude CLI]
        B[Codex]
        C[Cursor IDE]
        D[OpenAI-compatible]
    end

    subgraph omniroute
        E[Handler Layer]
        F[Translator Layer]
        G[Executor Layer]
        H[Services Layer]
    end

    subgraph Providers
        I[Anthropic Claude]
        J[Google Gemini]
        K[OpenAI / Codex]
        L[GitHub Copilot]
        M[AWS Kiro]
        N[Antigravity]
        O[Cursor API]
    end

    A --> E
    B --> E
    C --> E
    D --> E
    E --> F
    F --> G
    G --> I
    G --> J
    G --> K
    G --> L
    G --> M
    G --> N
    G --> O
    H -.-> E
    H -.-> G
```

### –û—Å–Ω–æ–≤–µ–Ω –ø—Ä–∏–Ω—Ü–∏–ø: –ü—Ä–µ–≤–æ–¥ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–Ω–æ –Ω–∏–≤–æ

–í—Å–∏—á–∫–∏ –ø—Ä–µ–≤–æ–¥–∏ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏ –ø—Ä–µ–º–∏–Ω–∞–≤–∞—Ç –ø—Ä–µ–∑ **OpenAI —Ñ–æ—Ä–º–∞—Ç –∫–∞—Ç–æ —Ü–µ–Ω—Ç—ä—Ä**:

```
Client Format ‚Üí [OpenAI Hub] ‚Üí Provider Format    (request)
Provider Format ‚Üí [OpenAI Hub] ‚Üí Client Format    (response)
```

–¢–æ–≤–∞ –æ–∑–Ω–∞—á–∞–≤–∞, —á–µ –∏–º–∞—Ç–µ –Ω—É–∂–¥–∞ —Å–∞–º–æ –æ—Ç **N –ø—Ä–µ–≤–æ–¥–∞—á–∏** (–ø–æ –µ–¥–∏–Ω –Ω–∞ —Ñ–æ—Ä–º–∞—Ç) –≤–º–µ—Å—Ç–æ –æ—Ç **N¬≤** (–≤—Å—è–∫–∞ –¥–≤–æ–π–∫–∞).

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
omniroute/
‚îú‚îÄ‚îÄ open-sse/                  ‚Üê Core proxy library (portable, framework-agnostic)
‚îÇ   ‚îú‚îÄ‚îÄ index.js               ‚Üê Main entry point, exports everything
‚îÇ   ‚îú‚îÄ‚îÄ config/                ‚Üê Configuration & constants
‚îÇ   ‚îú‚îÄ‚îÄ executors/             ‚Üê Provider-specific request execution
‚îÇ   ‚îú‚îÄ‚îÄ handlers/              ‚Üê Request handling orchestration
‚îÇ   ‚îú‚îÄ‚îÄ services/              ‚Üê Business logic (auth, models, fallback, usage)
‚îÇ   ‚îú‚îÄ‚îÄ translator/            ‚Üê Format translation engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request/           ‚Üê Request translators (8 files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ response/          ‚Üê Response translators (7 files)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers/           ‚Üê Shared translation utilities (6 files)
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 ‚Üê Utility functions
‚îú‚îÄ‚îÄ src/                       ‚Üê Application layer (Express/Worker runtime)
‚îÇ   ‚îú‚îÄ‚îÄ app/                   ‚Üê Web UI, API routes, middleware
‚îÇ   ‚îú‚îÄ‚îÄ lib/                   ‚Üê Database, auth, and shared library code
‚îÇ   ‚îú‚îÄ‚îÄ mitm/                  ‚Üê Man-in-the-middle proxy utilities
‚îÇ   ‚îú‚îÄ‚îÄ models/                ‚Üê Database models
‚îÇ   ‚îú‚îÄ‚îÄ shared/                ‚Üê Shared utilities (wrappers around open-sse)
‚îÇ   ‚îú‚îÄ‚îÄ sse/                   ‚Üê SSE endpoint handlers
‚îÇ   ‚îî‚îÄ‚îÄ store/                 ‚Üê State management
‚îú‚îÄ‚îÄ data/                      ‚Üê Runtime data (credentials, logs)
‚îÇ   ‚îî‚îÄ‚îÄ provider-credentials.json   (external credentials override, gitignored)
‚îî‚îÄ‚îÄ tester/                    ‚Üê Test utilities
```

---

## 4. –†–∞–∑–±–∏–≤–∫–∞ –º–æ–¥—É–ª –ø–æ –º–æ–¥—É–ª

### 4.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`open-sse/config/`)

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–∏—è—Ç –∏–∑—Ç–æ—á–Ω–∏–∫ –Ω–∞ –∏—Å—Ç–∏–Ω–∞** –∑–∞ –≤—Å–∏—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞.

| –§–∞–π–ª                          | –¶–µ–ª                                                                                                                                                                                                                                                            |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constants.ts`                | `PROVIDERS` –æ–±–µ–∫—Ç —Å –æ—Å–Ω–æ–≤–Ω–∏ URL –∞–¥—Ä–µ—Å–∏, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ OAuth (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ), –∑–∞–≥–ª–∞–≤–∫–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–∏ –ø–æ–¥–∫–∞–Ω–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –∑–∞ –≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫. –°—ä—â–æ —Ç–∞–∫–∞ –¥–µ—Ñ–∏–Ω–∏—Ä–∞ `HTTP_STATUS`, `ERROR_TYPES`, `COOLDOWN_MS`, `BACKOFF_CONFIG` –∏ `SKIP_PATTERNS`. |
| `credentialLoader.ts`         | –ó–∞—Ä–µ–∂–¥–∞ –≤—ä–Ω—à–Ω–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç `data/provider-credentials.json` –∏ –≥–∏ –æ–±–µ–¥–∏–Ω—è–≤–∞ –≤—ä—Ä—Ö—É —Ç–≤—ä—Ä–¥–æ –∫–æ–¥–∏—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –≤ `PROVIDERS`. –ü–∞–∑–∏ —Ç–∞–π–Ω–∏—Ç–µ –∏–∑–≤—ä–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏–∫–∞, –∫–∞—Ç–æ —Å—ä—â–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–¥–¥—ä—Ä–∂–∞ –æ–±—Ä–∞—Ç–Ω–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç.           |
| `providerModels.ts`           | –¶–µ–Ω—Ç—Ä–∞–ª–µ–Ω —Ä–µ–≥–∏—Å—Ç—ä—Ä –Ω–∞ –º–æ–¥–µ–ª–∏—Ç–µ: –ø—Å–µ–≤–¥–æ–Ω–∏–º–∏ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏ ‚Üí ID –Ω–∞ –º–æ–¥–µ–ª–∞. –§—É–Ω–∫—Ü–∏–∏ –∫–∞—Ç–æ `getModels()`, `getProviderByAlias()`.                                                                                                                          |
| `codexInstructions.ts`        | –°–∏—Å—Ç–µ–º–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∏–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–∏ –≤ –∑–∞—è–≤–∫–∏—Ç–µ –Ω–∞ Codex (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ, –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –ø—è—Å—ä—á–Ω–∏–∫–∞, –ø—Ä–∞–≤–∏–ª–∞ –∑–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ).                                                                                                                                 |
| `defaultThinkingSignature.ts` | ‚Äû–ú–∏—Å–ª–µ—â–∏‚Äú –ø–æ–¥–ø–∏—Å–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –∑–∞ –º–æ–¥–µ–ª–∏ Claude –∏ Gemini.                                                                                                                                                                                                   |
| `ollamaModels.ts`             | –î–µ—Ñ–∏–Ω–∏—Ü–∏—è –Ω–∞ —Å—Ö–µ–º–∞ –∑–∞ –ª–æ–∫–∞–ª–Ω–∏ –º–æ–¥–µ–ª–∏ Ollama (–∏–º–µ, —Ä–∞–∑–º–µ—Ä, —Å–µ–º–µ–π—Å—Ç–≤–æ, –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–µ).                                                                                                                                                                              |

#### –ü–æ—Ç–æ–∫ –Ω–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –¥–∞–Ω–Ω–∏

```mermaid
flowchart TD
    A["App starts"] --> B["constants.ts defines PROVIDERS\nwith hardcoded defaults"]
    B --> C{"data/provider-credentials.json\nexists?"}
    C -->|Yes| D["credentialLoader reads JSON"]
    C -->|No| E["Use hardcoded defaults"]
    D --> F{"For each provider in JSON"}
    F --> G{"Provider exists\nin PROVIDERS?"}
    G -->|No| H["Log warning, skip"]
    G -->|Yes| I{"Value is object?"}
    I -->|No| J["Log warning, skip"]
    I -->|Yes| K["Merge clientId, clientSecret,\ntokenUrl, authUrl, refreshUrl"]
    K --> F
    H --> F
    J --> F
    F -->|Done| L["PROVIDERS ready with\nmerged credentials"]
    E --> L
```

---

### 4.2 –ò–∑–ø—ä–ª–Ω–∏—Ç–µ–ª–∏ (`open-sse/executors/`)

–ò–∑–ø—ä–ª–Ω–∏—Ç–µ–ª–∏—Ç–µ –∫–∞–ø—Å—É–ª–∏—Ä–∞—Ç **—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ –ª–æ–≥–∏–∫–∞**, –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ **—Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏ –º–æ–¥–µ–ª**. –í—Å–µ–∫–∏ –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª –∑–∞–º–µ—Å—Ç–≤–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ç–µ –º–µ—Ç–æ–¥–∏, –∞–∫–æ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

```mermaid
classDiagram
    class BaseExecutor {
        +buildUrl(model, stream, options)
        +buildHeaders(credentials, stream, body)
        +transformRequest(body, model, stream, credentials)
        +execute(url, options)
        +shouldRetry(status, error)
        +refreshCredentials(credentials, log)
    }

    class DefaultExecutor {
        +refreshCredentials()
    }

    class AntigravityExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +shouldRetry()
        +refreshCredentials()
    }

    class CursorExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseResponse()
        +generateChecksum()
    }

    class KiroExecutor {
        +buildUrl()
        +buildHeaders()
        +transformRequest()
        +parseEventStream()
        +refreshCredentials()
    }

    BaseExecutor <|-- DefaultExecutor
    BaseExecutor <|-- AntigravityExecutor
    BaseExecutor <|-- CursorExecutor
    BaseExecutor <|-- KiroExecutor
    BaseExecutor <|-- CodexExecutor
    BaseExecutor <|-- GeminiCLIExecutor
    BaseExecutor <|-- GithubExecutor
```

| –ò–∑–ø—ä–ª–Ω–∏—Ç–µ–ª       | –î–æ—Å—Ç–∞–≤—á–∏–∫                                  | –ö–ª—é—á–æ–≤–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏                                                                                                                                                                 |
| ---------------- | ------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `base.ts`        | ‚Äî                                          | –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞ –±–∞–∑–∞: –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ URL, –∑–∞–≥–ª–∞–≤–∫–∏, –ª–æ–≥–∏–∫–∞ –∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω –æ–ø–∏—Ç, –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –¥–∞–Ω–Ω–∏                                                                          |
| `default.ts`     | Claude, Gemini, OpenAI, GLM, Kimi, MiniMax | –ì–µ–Ω–µ—Ä–∏—á–Ω–æ –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ OAuth —Ç–æ–∫–µ–Ω –∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏                                                                                                                         |
| `antigravity.ts` | Google Cloud Code                          | –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –ø—Ä–æ–µ–∫—Ç/—Å–µ—Å–∏—è, —Ä–µ–∑–µ—Ä–≤–µ–Ω URL –∞–¥—Ä–µ—Å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ URL –∞–¥—Ä–µ—Å–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω –æ–ø–∏—Ç –æ—Ç —Å—ä–æ–±—â–µ–Ω–∏—è –∑–∞ –≥—Ä–µ—à–∫–∞ (‚Äû–Ω—É–ª–∏—Ä–∞–Ω–µ —Å–ª–µ–¥ 2h7m23s‚Äú) |
| `cursor.ts`      | –ö—É—Ä—Å–æ—Ä IDE                                 | **–ù–∞–π-—Å–ª–æ–∂–Ω–∏**: SHA-256 –∫–æ–Ω—Ç—Ä–æ–ª–Ω–∞ —Å—É–º–∞ auth, Protobuf –∫–æ–¥–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∞, –¥–≤–æ–∏—á–µ–Ω EventStream ‚Üí SSE –æ—Ç–≥–æ–≤–æ—Ä –∞–Ω–∞–ª–∏–∑                                                                    |
| `codex.ts`       | OpenAI Codex                               | –í–∫–∞—Ä–≤–∞ —Å–∏—Å—Ç–µ–º–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —É–ø—Ä–∞–≤–ª—è–≤–∞ –Ω–∏–≤–∞—Ç–∞ –Ω–∞ –º–∏—Å–ª–µ–Ω–µ, –ø—Ä–µ–º–∞—Ö–≤–∞ –Ω–µ–ø–æ–¥–¥—ä—Ä–∂–∞–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏                                                                                            |
| `gemini-cli.ts`  | Google Gemini CLI                          | –ò–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω URL (`streamGenerateContent`), –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ Google OAuth —Ç–æ–∫–µ–Ω                                                                                         |
| `github.ts`      | –ö–æ–ø–∏–ª–æ—Ç –Ω–∞ GitHub                          | –°–∏—Å—Ç–µ–º–∞ —Å –¥–≤–æ–µ–Ω —Ç–æ–∫–µ–Ω (GitHub OAuth + Copilot token), –∏–º–∏—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–≥–ª–∞–≤–∫–∞—Ç–∞ –Ω–∞ VSCode                                                                                               |
| `kiro.ts`        | AWS CodeWhisperer                          | –î–≤–æ–∏—á–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ AWS EventStream, —Ä–∞–º–∫–∏ –∑–∞ —Å—ä–±–∏—Ç–∏—è AMZN, –æ—Ü–µ–Ω–∫–∞ –Ω–∞ —Ç–æ–∫–µ–Ω–∞                                                                                                            |
| `index.ts`       | ‚Äî                                          | –§–∞–±—Ä–∏–∫–∞: –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–∞ –∏–º–µ—Ç–æ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ ‚Üí –∫–ª–∞—Å –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª, —Å —Ä–µ–∑–µ—Ä–≤–µ–Ω –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ                                                                                       |

---

### 4.3 –ú–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä–∏ (`open-sse/handlers/`)

**–°–ª–æ—è—Ç –∑–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–∞ –ø—Ä–µ–≤–æ–¥–∞, –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ, –ø–æ—Ç–æ—á–Ω–æ—Ç–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞—Ç–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏.

| –§–∞–π–ª                  | –¶–µ–ª                                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chatCore.ts`         | **–¶–µ–Ω—Ç—Ä–∞–ª–µ–Ω –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** (~600 —Ä–µ–¥–∞). –û–±—Ä–∞–±–æ—Ç–≤–∞ –ø—ä–ª–Ω–∏—è –∂–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞: –æ—Ç–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç ‚Üí –ø—Ä–µ–≤–æ–¥ ‚Üí –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª ‚Üí —Å—Ç—Ä–∏–π–º–∏–Ω–≥/–Ω–µ-—Å—Ç—Ä–∏–π–º–∏–Ω–≥ –æ—Ç–≥–æ–≤–æ—Ä ‚Üí –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏ ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ. |
| `responsesHandler.ts` | –ê–¥–∞–ø—Ç–µ—Ä –∑–∞ API –∑–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ OpenAI: –ø—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ ‚Üí –ó–∞–≤—ä—Ä—à–≤–∞–Ω–∏—è –Ω–∞ —á–∞—Ç ‚Üí –∏–∑–ø—Ä–∞—â–∞ –¥–æ `chatCore` ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞ SSE –æ–±—Ä–∞—Ç–Ω–æ –≤—ä–≤ —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ.                                                                                 |
| `embeddings.ts`       | –ú–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≤–≥—Ä–∞–∂–¥–∞–Ω–µ: —Ä–∞–∑—Ä–µ—à–∞–≤–∞ –º–æ–¥–µ–ª –Ω–∞ –≤–≥—Ä–∞–∂–¥–∞–Ω–µ ‚Üí –¥–æ—Å—Ç–∞–≤—á–∏–∫, –∏–∑–ø—Ä–∞—â–∞ –¥–æ API –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞, –≤—Ä—ä—â–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º —Å OpenAI –æ—Ç–≥–æ–≤–æ—Ä –∑–∞ –≤–≥—Ä–∞–∂–¥–∞–Ω–µ. –ü–æ–¥–¥—ä—Ä–∂–∞ 6+ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏.                                                                  |
| `imageGeneration.ts`  | –ú–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: —Ä–∞–∑—Ä–µ—à–∞–≤–∞ –º–æ–¥–µ–ª –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –¥–æ—Å—Ç–∞–≤—á–∏–∫, –ø–æ–¥–¥—ä—Ä–∂–∞ —Ä–µ–∂–∏–º–∏, —Å—ä–≤–º–µ—Å—Ç–∏–º–∏ —Å OpenAI, Gemini-image (–ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è) –∏ —Ä–µ–∑–µ—Ä–≤–Ω–∏ (Nebius). –í—Ä—ä—â–∞ base64 –∏–ª–∏ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.                                        |

#### –ñ–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –Ω–∞ –∑–∞—è–≤–∫–∞ (chatCore.ts)

```mermaid
sequenceDiagram
    participant Client
    participant chatCore
    participant Translator
    participant Executor
    participant Provider

    Client->>chatCore: Request (any format)
    chatCore->>chatCore: Detect source format
    chatCore->>chatCore: Check bypass patterns
    chatCore->>chatCore: Resolve model & provider
    chatCore->>Translator: Translate request (source ‚Üí OpenAI ‚Üí target)
    chatCore->>Executor: Get executor for provider
    Executor->>Executor: Build URL, headers, transform request
    Executor->>Executor: Refresh credentials if needed
    Executor->>Provider: HTTP fetch (streaming or non-streaming)

    alt Streaming
        Provider-->>chatCore: SSE stream
        chatCore->>chatCore: Pipe through SSE transform stream
        Note over chatCore: Transform stream translates<br/>each chunk: target ‚Üí OpenAI ‚Üí source
        chatCore-->>Client: Translated SSE stream
    else Non-streaming
        Provider-->>chatCore: JSON response
        chatCore->>Translator: Translate response
        chatCore-->>Client: Translated JSON
    end

    alt Error (401, 429, 500...)
        chatCore->>Executor: Retry with credential refresh
        chatCore->>chatCore: Account fallback logic
    end
```

---

### 4.4 –£—Å–ª—É–≥–∏ (`open-sse/services/`)

–ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞, –∫–æ—è—Ç–æ –ø–æ–¥–¥—ä—Ä–∂–∞ –º–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä–∏—Ç–µ –∏ –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª–∏—Ç–µ.

| –§–∞–π–ª                 | –¶–µ–ª                                                                                                                                                                                                                                                                                                                                                                                                 |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `provider.ts`        | **–û—Ç–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç** (`detectFormat`): –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ —Ç—è–ª–æ—Ç–æ –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞, –∑–∞ –¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ç–µ Claude/OpenAI/Gemini/Antigravity/Responses (–≤–∫–ª—é—á–≤–∞ `max_tokens` –µ–≤—Ä–∏—Å—Ç–∏–∫–∞ –∑–∞ Claude). –°—ä—â–æ —Ç–∞–∫–∞: –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ URL –∞–¥—Ä–µ—Å–∏, –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ –∑–∞–≥–ª–∞–≤–∫–∏, –Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –Ω–∞ –º–∏—Å–ª–µ–Ω–µ. –ü–æ–¥–¥—ä—Ä–∂–∞ `openai-compatible-*` –∏ `anthropic-compatible-*` –¥–∏–Ω–∞–º–∏—á–Ω–∏ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏. |
| `model.ts`           | –†–∞–∑–±–æ—Ä –Ω–∞ –Ω–∏–∑ –Ω–∞ –º–æ–¥–µ–ª (`claude/model-name` ‚Üí `{provider: "claude", model: "model-name"}`), —Ä–∞–∑—Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∏ —Å –æ—Ç–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Å–±–ª—ä—Å—ä–∫, –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–∞ (–æ—Ç—Ö–≤—ä—Ä–ª—è –ø—Ä–µ–º–∏–Ω–∞–≤–∞–Ω–µ –Ω–∞ –ø—ä—Ç—è/–∫–æ–Ω—Ç—Ä–æ–ª–Ω–∏ –∑–Ω–∞—Ü–∏) –∏ —Ä–∞–∑—Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –º–æ–¥–µ–ª–∞ —Å –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∏.                                                                                         |
| `accountFallback.ts` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—Ç–∞: –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–æ –∑–∞–±–∞–≤—è–Ω–µ (1s ‚Üí 2s ‚Üí 4s ‚Üí –º–∞–∫—Å. 2min), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ –Ω–∞ –∞–∫–∞—É–Ω—Ç–∞, –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –≥—Ä–µ—à–∫–∏—Ç–µ (–∫–æ–∏ –≥—Ä–µ—à–∫–∏ –∑–∞–¥–µ–π—Å—Ç–≤–∞—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ –∏–ª–∏ –Ω–µ).                                                                                                                                                                                                   |
| `tokenRefresh.ts`    | –û–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ OAuth —Ç–æ–∫–µ–Ω–∞ –∑–∞ **–≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫**: Google (Gemini, Antigravity), Claude, Codex, Qwen, iFlow, GitHub (OAuth + Copilot dual-token), Kiro (AWS SSO OIDC + Social Auth). –í–∫–ª—é—á–≤–∞ –∫–µ—à –∑–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –æ–±–µ—â–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –ø–æ–ª–µ—Ç –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω –æ–ø–∏—Ç —Å –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–æ –∑–∞–±–∞–≤—è–Ω–µ.                                                                                                          |
| `combo.ts`           | **–ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏ –º–æ–¥–µ–ª–∏**: –≤–µ—Ä–∏–≥–∏ –æ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–∏ –º–æ–¥–µ–ª–∏. –ê–∫–æ –º–æ–¥–µ–ª A —Å–µ –ø—Ä–æ–≤–∞–ª–∏ —Å –¥–æ–ø—É—Å—Ç–∏–º–∞ –≥—Ä–µ—à–∫–∞ –∑–∞ —Ä–µ–∑–µ—Ä–≤–µ–Ω –≤–∞—Ä–∏–∞–Ω—Ç, –æ–ø–∏—Ç–∞–π—Ç–µ –º–æ–¥–µ–ª B, —Å–ª–µ–¥ —Ç–æ–≤–∞ C –∏ —Ç.–Ω. –í—Ä—ä—â–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–Ω–∏—Ç–µ –∫–æ–¥–æ–≤–µ –∑–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≥–æ—Ä–µ –ø–æ –≤–µ—Ä–∏–≥–∞—Ç–∞.                                                                                                                                                                                 |
| `usage.ts`           | –ò–∑–≤–ª–∏—á–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∫–≤–æ—Ç–∏/–∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –æ—Ç API –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ (–∫–≤–æ—Ç–∏ –Ω–∞ GitHub Copilot, –∫–≤–æ—Ç–∏ –Ω–∞ –º–æ–¥–µ–ª–∞ –Ω–∞ Antigravity, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—Ç–∞ –Ω–∞ Codex, —Ä–∞–∑–±–∏–≤–∫–∏ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ Kiro, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ Claude).                                                                                                                                                                                         |
| `accountSelector.ts` | –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–µ–Ω –∏–∑–±–æ—Ä –Ω–∞ –∞–∫–∞—É–Ω—Ç —Å –∞–ª–≥–æ—Ä–∏—Ç—ä–º –∑–∞ —Ç–æ—á–∫—É–≤–∞–Ω–µ: –≤–∑–µ–º–∞ –ø—Ä–µ–¥–≤–∏–¥ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ, –∫—Ä—ä–≥–æ–≤–∞ –ø–æ–∑–∏—Ü–∏—è –∏ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ, –∑–∞ –¥–∞ –∏–∑–±–µ—Ä–µ –æ–ø—Ç–∏–º–∞–ª–Ω–∏—è –∞–∫–∞—É–Ω—Ç –∑–∞ –≤—Å—è–∫–∞ –∑–∞—è–≤–∫–∞.                                                                                                                                                                                                   |
| `contextManager.ts`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞: —Å—ä–∑–¥–∞–≤–∞ –∏ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∏ –æ–±–µ–∫—Ç–∏ –Ω–∞ –∑–∞—è–≤–∫–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω–∏ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –∑–∞—è–≤–∫–∞, –≤—Ä–µ–º–µ–≤–∏ –∫–ª–µ–π–º–∞, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞) –∑–∞ –æ—Ç—Å—Ç—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ.                                                                                                                                                                   |
| `ipFilter.ts`        | IP-–±–∞–∑–∏—Ä–∞–Ω –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –¥–æ—Å—Ç—ä–ø–∞: –ø–æ–¥–¥—ä—Ä–∂–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏ –∏ –±–ª–æ–∫–∏—Ä–∞–Ω–∏ —Ä–µ–∂–∏–º–∏. –í–∞–ª–∏–¥–∏—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—è IP –∞–¥—Ä–µ—Å —Å–ø—Ä—è–º–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞, –ø—Ä–µ–¥–∏ –¥–∞ –æ–±—Ä–∞–±–æ—Ç–∏ API –∑–∞—è–≤–∫–∏.                                                                                                                                                                                                                                      |
| `sessionManager.ts`  | –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏–∏ —Å –ø—Ä—ä—Å—Ç–æ–≤ –æ—Ç–ø–µ—á–∞—Ç—ä–∫ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞: –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞ –∞–∫—Ç–∏–≤–Ω–∏ —Å–µ—Å–∏–∏ —Å –ø–æ–º–æ—â—Ç–∞ –Ω–∞ —Ö–µ—à–∏—Ä–∞–Ω–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏, —Å–ª–µ–¥–∏ –±—Ä–æ—è –Ω–∞ –∑–∞—è–≤–∫–∏—Ç–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–∞ —Å–µ—Å–∏–∏—Ç–µ.                                                                                                                                                                                                           |
| `signatureCache.ts`  | –ö–µ—à –∑–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ –∑–∞—è–≤–∫–∏: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –¥—É–±–ª–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏ —á—Ä–µ–∑ –∫–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–∫–æ—Ä–æ—à–Ω–∏ –∑–∞—è–≤–∫–∏ –∏ –≤—Ä—ä—â–∞–Ω–µ –Ω–∞ –∫–µ—à–∏—Ä–∞–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –∑–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∏ –∑–∞—è–≤–∫–∏ –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –≤—Ä–µ–º–µ–≤–∏ –ø—Ä–æ–∑–æ—Ä–µ—Ü.                                                                                                                                                                                  |
| `systemPrompt.ts`    | –ò–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –≥–ª–æ–±–∞–ª–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–¥–∫–∞–Ω–∞: –¥–æ–±–∞–≤—è –ø—Ä–µ–¥ –∏–ª–∏ –¥–æ–±–∞–≤—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–¥–∫–∞–Ω–∞ –∫—ä–º –≤—Å–∏—á–∫–∏ –∑–∞—è–≤–∫–∏, —Å –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—Ç–∞ –∑–∞ –≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫.                                                                                                                                                                                                                               |
| `thinkingBudget.ts`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –±—é–¥–∂–µ—Ç–∞ –Ω–∞ —Ç–æ–∫–µ–Ω–∏—Ç–µ –∑–∞ —Ä–∞–∑—Å—ä–∂–¥–µ–Ω–∏–µ: –ø–æ–¥–¥—ä—Ä–∂–∞ —Ä–µ–∂–∏–º–∏ –∑–∞ –ø—Ä–µ–º–∏–Ω–∞–≤–∞–Ω–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ª–µ–Ω—Ç–æ–≤–æ –º–∏—Å–ª–µ–Ω–µ), –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω (—Ñ–∏–∫—Å–∏—Ä–∞–Ω –±—é–¥–∂–µ—Ç) –∏ –∞–¥–∞–ø—Ç–∏–≤–µ–Ω (–º–∞—â–∞–±–∏—Ä–∞–Ω —Å–ø–æ—Ä–µ–¥ —Å–ª–æ–∂–Ω–æ—Å—Ç—Ç–∞) —Ä–µ–∂–∏–º–∏ –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∏ –∑–∞ –º–∏—Å–ª–µ–Ω–µ/—Ä–∞–∑—Å—ä–∂–¥–µ–Ω–∏–µ.                                                                                                                                |
| `wildcardRouter.ts`  | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª–∞ —Å—ä—Å –∑–∞–º–µ—Å—Ç–≤–∞—â–∏ –∑–Ω–∞—Ü–∏: —Ä–∞–∑—Ä–µ—à–∞–≤–∞ —à–∞–±–ª–æ–Ω–∏ —Å—ä—Å –∑–∞–º–µ—Å—Ç–≤–∞—â–∏ –∑–Ω–∞—Ü–∏ (–Ω–∞–ø—Ä. `*/claude-*`) –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –¥–≤–æ–π–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫/–º–æ–¥–µ–ª –≤—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.                                                                                                                                                                                                                 |

#### –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∏

```mermaid
sequenceDiagram
    participant R1 as Request 1
    participant R2 as Request 2
    participant Cache as refreshPromiseCache
    participant OAuth as OAuth Provider

    R1->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: No in-flight promise
    Cache->>OAuth: Start refresh
    R2->>Cache: getAccessToken("gemini", token)
    Cache->>Cache: Found in-flight promise
    Cache-->>R2: Return existing promise
    OAuth-->>Cache: New access token
    Cache-->>R1: New access token
    Cache-->>R2: Same access token (shared)
    Cache->>Cache: Delete cache entry
```

#### –†–µ–∑–µ—Ä–≤–Ω–∞ –¥—ä—Ä–∂–∞–≤–Ω–∞ –º–∞—à–∏–Ω–∞ –Ω–∞ –∞–∫–∞—É–Ω—Ç–∞

```mermaid
stateDiagram-v2
    [*] --> Active
    Active --> Error: Request fails (401/429/500)
    Error --> Cooldown: Apply backoff
    Cooldown --> Active: Cooldown expires
    Active --> Active: Request succeeds (reset backoff)

    state Error {
        [*] --> ClassifyError
        ClassifyError --> ShouldFallback: Rate limit / Auth / Transient
        ClassifyError --> NoFallback: 400 Bad Request
    }

    state Cooldown {
        [*] --> ExponentialBackoff
        ExponentialBackoff: Level 0 = 1s
        ExponentialBackoff: Level 1 = 2s
        ExponentialBackoff: Level 2 = 4s
        ExponentialBackoff: Max = 2min
    }
```

#### –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω –º–æ–¥–µ–ª –≤–µ—Ä–∏–≥–∞

```mermaid
flowchart LR
    A["Request with\ncombo model"] --> B["Model A"]
    B -->|"2xx Success"| C["Return response"]
    B -->|"429/401/500"| D{"Fallback\neligible?"}
    D -->|Yes| E["Model B"]
    D -->|No| F["Return error"]
    E -->|"2xx Success"| C
    E -->|"429/401/500"| G{"Fallback\neligible?"}
    G -->|Yes| H["Model C"]
    G -->|No| F
    H -->|"2xx Success"| C
    H -->|"Fail"| I["All failed ‚Üí\nReturn last status"]
```

---

### 4.5 –ü—Ä–µ–≤–æ–¥–∞—á (`open-sse/translator/`)

**–ú–∞—à–∏–Ω–∞—Ç–∞ –∑–∞ –ø—Ä–µ–≤–æ–¥ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏**, –∏–∑–ø–æ–ª–∑–≤–∞—â–∞ —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—â–∞ —Å–µ –ø–ª—ä–≥–∏–Ω —Å–∏—Å—Ç–µ–º–∞.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    subgraph "Request Translation"
        A["Claude ‚Üí OpenAI"]
        B["Gemini ‚Üí OpenAI"]
        C["Antigravity ‚Üí OpenAI"]
        D["OpenAI Responses ‚Üí OpenAI"]
        E["OpenAI ‚Üí Claude"]
        F["OpenAI ‚Üí Gemini"]
        G["OpenAI ‚Üí Kiro"]
        H["OpenAI ‚Üí Cursor"]
    end

    subgraph "Response Translation"
        I["Claude ‚Üí OpenAI"]
        J["Gemini ‚Üí OpenAI"]
        K["Kiro ‚Üí OpenAI"]
        L["Cursor ‚Üí OpenAI"]
        M["OpenAI ‚Üí Claude"]
        N["OpenAI ‚Üí Antigravity"]
        O["OpenAI ‚Üí Responses"]
    end
```

| –£–∫–∞–∑–∞—Ç–µ–ª     | –§–∞–π–ª–æ–≤–µ     | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                                                                                                                                                                                 |
| ------------ | ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `request/`   | 8 –ø—Ä–µ–≤–æ–¥–∞—á–∏ | –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–π—Ç–µ —Ç–µ–ª–∞ –Ω–∞ –∑–∞—è–≤–∫–∏ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∏. –í—Å–µ–∫–∏ —Ñ–∞–π–ª —Å–µ —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ —á—Ä–µ–∑ `register(from, to, fn)` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ.                                                                                                                                                                                 |
| `response/`  | 7 –ø—Ä–µ–≤–æ–¥–∞—á–∏ | –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–π—Ç–µ –ø–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∏. –û–±—Ä–∞–±–æ—Ç–≤–∞ SSE —Ç–∏–ø–æ–≤–µ —Å—ä–±–∏—Ç–∏—è, –º–∏—Å–ª–æ–≤–Ω–∏ –±–ª–æ–∫–æ–≤–µ, –∏–∑–≤–∏–∫–≤–∞–Ω–∏—è –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏.                                                                                                                                                                      |
| `helpers/`   | 6 –ø–æ–º–æ—â–Ω–∏–∫–∞ | –°–ø–æ–¥–µ–ª–µ–Ω–∏ –ø–æ–º–æ—â–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–∏: `claudeHelper` (–∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∏ –ø–æ–¥–∫–∞–Ω–∏, –º–∏—Å–ª–µ—â–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è), `geminiHelper` (—Å—ä–ø–æ—Å—Ç–∞–≤—è–Ω–µ –Ω–∞ —á–∞—Å—Ç–∏/—Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ), `openaiHelper` (—Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç), `toolCallHelper` (–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ ID, –∏–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ª–∏–ø—Å–≤–∞—â –æ—Ç–≥–æ–≤–æ—Ä), `maxTokensHelper`, `responsesApiHelper`. |
| `index.ts`   | ‚Äî           | –ú–µ—Ö–∞–Ω–∏–∑—ä–º –∑–∞ –ø—Ä–µ–≤–æ–¥: `translateRequest()`, `translateResponse()`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ, —Ä–µ–≥–∏—Å—Ç—ä—Ä.                                                                                                                                                                                                   |
| `formats.ts` | ‚Äî           | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∞: `OPENAI`, `CLAUDE`, `GEMINI`, `ANTIGRAVITY`, `KIRO`, `CURSOR`, `OPENAI_RESPONSES`.                                                                                                                                                                                                 |

#### –ö–ª—é—á–æ–≤ –¥–∏–∑–∞–π–Ω: –°–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—â–∏ —Å–µ –¥–æ–±–∞–≤–∫–∏

```javascript
// Each translator file calls register() on import:
import { register } from "../index.js";
register("claude", "openai", translateClaudeToOpenAI);

// The index.js imports all translator files, triggering registration:
import "./request/claude-to-openai.js"; // ‚Üê self-registers
```

---

### 4.6 –ü–æ–º–æ—â–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ (`open-sse/utils/`)

| –§–∞–π–ª               | –¶–µ–ª                                                                                                                                                                                                                                                                                                                                                    |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `error.ts`         | –ò–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ –≥—Ä–µ—à–∫–∞ (—Å—ä–≤–º–µ—Å—Ç–∏–º —Å OpenAI —Ñ–æ—Ä–º–∞—Ç), –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∞ –Ω–∞–≥–æ—Ä–µ –ø–æ –≤–µ—Ä–∏–≥–∞—Ç–∞, –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –≤—Ä–µ–º–µ—Ç–æ –∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω –æ–ø–∏—Ç –Ω–∞ Antigravity –æ—Ç —Å—ä–æ–±—â–µ–Ω–∏—è –∑–∞ –≥—Ä–µ—à–∫–∞, –ø–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∞ –Ω–∞ SSE.                                                                                                                               |
| `stream.ts`        | **SSE Transform Stream** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏—è—Ç —Ç—Ä—ä–±–æ–ø—Ä–æ–≤–æ–¥ –∑–∞ —Å—Ç—Ä–∏–π–º–∏–Ω–≥. –î–≤–∞ —Ä–µ–∂–∏–º–∞: `TRANSLATE` (–ø—Ä–µ–≤–æ–¥ –≤ –ø—ä–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç) –∏ `PASSTHROUGH` (–Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä–∞–Ω–µ + –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ). –£–ø—Ä–∞–≤–ª—è–≤–∞ –±—É—Ñ–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞—Ä—á–µ—Ç–∞, –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ, –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –¥—ä–ª–∂–∏–Ω–∞—Ç–∞ –Ω–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ. –ï–∫–∑–µ–º–ø–ª—è—Ä–∏—Ç–µ –Ω–∞ –µ–Ω–∫–æ–¥–µ—Ä/–¥–µ–∫–æ–¥–µ—Ä –Ω–∞ –ø–æ—Ç–æ–∫ –∏–∑–±—è–≥–≤–∞—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ. |
| `streamHelpers.ts` | –ü–æ–º–æ—â–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑–∞ SSE –Ω–∞ –Ω–∏—Å–∫–æ –Ω–∏–≤–æ: `parseSSELine` (—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–∏ –∫—ä–º –±–µ–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏), `hasValuableContent` (—Ñ–∏–ª—Ç—Ä–∏—Ä–∞ –ø—Ä–∞–∑–Ω–∏ –ø–∞—Ä—á–µ—Ç–∞ –∑–∞ OpenAI/Claude/Gemini), `fixInvalidId`, `formatSSE` (—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ SSE, —Å—ä–æ–±—Ä–∞–∑–µ–Ω–∞ —Å —Ñ–æ—Ä–º–∞—Ç–∞ —Å `perf_metrics` –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ).                                                                                    |
| `usageTracking.ts` | –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∏ –æ—Ç –≤—Å–µ–∫–∏ —Ñ–æ—Ä–º–∞—Ç (Claude/OpenAI/Gemini/Responses), –æ—Ü–µ–Ω–∫–∞ —Å –æ—Ç–¥–µ–ª–Ω–∏ —Å—ä–æ—Ç–Ω–æ—à–µ–Ω–∏—è –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Å—ä–æ–±—â–µ–Ω–∏–µ char-per-token, –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –±—É—Ñ–µ—Ä (–º–∞—Ä–∂ –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç –æ—Ç 2000 —Ç–æ–∫–µ–Ω–∞), —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç –ø–æ–ª–µ, –∫–æ–Ω–∑–æ–ª–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ —Å ANSI —Ü–≤–µ—Ç–æ–≤–µ.                                                        |
| `requestLogger.ts` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∏—Å–∫–∞–Ω–∏—è –Ω–∞ –±–∞–∑–∞—Ç–∞ –Ω–∞ —Ñ–∞–π–ª (–≤–∫–ª—é—á–≤–∞–Ω–µ —á—Ä–µ–∑ `ENABLE_REQUEST_LOGS=true`). –°—ä–∑–¥–∞–≤–∞ —Å–µ—Å–∏–π–Ω–∏ –ø–∞–ø–∫–∏ —Å –Ω–æ–º–µ—Ä–∏—Ä–∞–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ: `1_req_client.json` ‚Üí `7_res_client.txt`. –í—Å–∏—á–∫–∏ I/O —Å–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏ (–∑–∞–¥–µ–π—Å—Ç–≤–∞–π –∏ –∑–∞–±—Ä–∞–≤–∏). –ú–∞—Å–∫–∏—Ä–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–Ω–∏—Ç–µ –∑–∞–≥–ª–∞–≤–∫–∏.                                                                                         |
| `bypassHandler.ts` | –ü—Ä–∏—Ö–≤–∞—â–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –º–æ–¥–µ–ª–∏ –æ—Ç Claude CLI (–∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –∑–∞–≥–ª–∞–≤–∏–µ, –∑–∞–≥—Ä—è–≤–∞–Ω–µ, –±—Ä–æ–µ–Ω–µ) –∏ –≤—Ä—ä—â–∞ —Ñ–∞–ª—à–∏–≤–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏, –±–µ–∑ –¥–∞ —Å–µ –æ–±–∞–∂–¥–∞ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫. –ü–æ–¥–¥—ä—Ä–∂–∞ –∫–∞–∫—Ç–æ —Å—Ç—Ä–∏–π–º–∏–Ω–≥, —Ç–∞–∫–∞ –∏ –Ω–µ —Å—Ç—Ä–∏–π–º–∏–Ω–≥. –£–º–∏—à–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ Claude CLI –æ–±—Ö–≤–∞—Ç.                                                                                                                   |
| `networkProxy.ts`  | –†–∞–∑—Ä–µ—à–∞–≤–∞ URL –∞–¥—Ä–µ—Å –Ω–∞ –∏–∑—Ö–æ–¥—è—â –ø—Ä–æ–∫—Å–∏ –∑–∞ –¥–∞–¥–µ–Ω –¥–æ—Å—Ç–∞–≤—á–∏–∫ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –≥–ª–æ–±–∞–ª–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –Ω–∞ —Å—Ä–µ–¥–∞—Ç–∞ (`HTTPS_PROXY`/`HTTP_PROXY`/`ALL_PROXY`). –ü–æ–¥–¥—ä—Ä–∂–∞ `NO_PROXY` –∏–∑–∫–ª—é—á–µ–Ω–∏—è. –ö–µ—à–∏—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –∑–∞ 30s.                                                                                    |

#### SSE Streaming Pipeline

```mermaid
flowchart TD
    A["Provider SSE stream"] --> B["TextDecoder\n(per-stream instance)"]
    B --> C["Buffer lines\n(split on newline)"]
    C --> D["parseSSELine()\n(trim whitespace, parse JSON)"]
    D --> E{"Mode?"}
    E -->|TRANSLATE| F["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E -->|PASSTHROUGH| G["fixInvalidId()\nnormalize chunk"]
    F --> H["hasValuableContent()\nfilter empty chunks"]
    G --> H
    H -->|"Has content"| I["extractUsage()\ntrack token counts"]
    H -->|"Empty"| J["Skip chunk"]
    I --> K["formatSSE()\nserialize + clean perf_metrics"]
    K --> L["TextEncoder\n(per-stream instance)"]
    L --> M["Enqueue to\nclient stream"]

    style A fill:#f9f,stroke:#333
    style M fill:#9f9,stroke:#333
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –∑–∞—è–≤–∫–∞

```
logs/
‚îî‚îÄ‚îÄ claude_gemini_claude-sonnet_20260208_143045/
    ‚îú‚îÄ‚îÄ 1_req_client.json      ‚Üê Raw client request
    ‚îú‚îÄ‚îÄ 2_req_source.json      ‚Üê After initial conversion
    ‚îú‚îÄ‚îÄ 3_req_openai.json      ‚Üê OpenAI intermediate format
    ‚îú‚îÄ‚îÄ 4_req_target.json      ‚Üê Final target format
    ‚îú‚îÄ‚îÄ 5_res_provider.txt     ‚Üê Provider SSE chunks (streaming)
    ‚îú‚îÄ‚îÄ 5_res_provider.json    ‚Üê Provider response (non-streaming)
    ‚îú‚îÄ‚îÄ 6_res_openai.txt       ‚Üê OpenAI intermediate chunks
    ‚îú‚îÄ‚îÄ 7_res_client.txt       ‚Üê Client-facing SSE chunks
    ‚îî‚îÄ‚îÄ 6_error.json           ‚Üê Error details (if any)
```

---

### 4.7 –ü—Ä–∏–ª–æ–∂–µ–Ω —Å–ª–æ–π (`src/`)

| –£–∫–∞–∑–∞—Ç–µ–ª      | –¶–µ–ª                                                                                                          |
| ------------- | ------------------------------------------------------------------------------------------------------------ |
| `src/app/`    | –£–µ–± –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, API –º–∞—Ä—à—Ä—É—Ç–∏, Express –º–µ–∂–¥–∏–Ω–µ–Ω —Å–æ—Ñ—Ç—É–µ—Ä, –º–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä–∏ –∑–∞ –æ–±—Ä–∞—Ç–Ω–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ OAuth |
| `src/lib/`    | –î–æ—Å—Ç—ä–ø –¥–æ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ (`localDb.ts`, `usageDb.ts`), —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ, —Å–ø–æ–¥–µ–ª–µ–Ω–æ                                 |
| `src/mitm/`   | –ü—Ä–æ–∫—Å–∏ –ø–æ–º–æ—â–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–∏ Man-in-the-middle –∑–∞ –ø—Ä–∏—Ö–≤–∞—â–∞–Ω–µ –Ω–∞ —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫                               |
| `src/models/` | –î–µ—Ñ–∏–Ω–∏—Ü–∏–∏ –Ω–∞ –º–æ–¥–µ–ª –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏                                                                             |
| `src/shared/` | –û–±–≤–∏–≤–∫–∏ –æ–∫–æ–ª–æ open-sse —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–æ—Å—Ç–∞–≤—á–∏–∫, –ø–æ—Ç–æ–∫, –≥—Ä–µ—à–∫–∞ –∏ –¥—Ä.)                                              |
| `src/sse/`    | SSE –º–∞–Ω–∏–ø—É–ª–∞—Ç–æ—Ä–∏ –Ω–∞ –∫—Ä–∞–π–Ω–∏ —Ç–æ—á–∫–∏, –∫–æ–∏—Ç–æ —Å–≤—ä—Ä–∑–≤–∞—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ç–∞ open-sse –∫—ä–º –µ–∫—Å–ø—Ä–µ—Å–Ω–∏ –º–∞—Ä—à—Ä—É—Ç–∏                |
| `src/store/`  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ                                                                    |

#### –ò–∑–≤–µ—Å—Ç–Ω–∏ API –º–∞—Ä—à—Ä—É—Ç–∏

| –ú–∞—Ä—à—Ä—É—Ç                                       | –ú–µ—Ç–æ–¥–∏                           | –¶–µ–ª                                                                                                     |
| --------------------------------------------- | -------------------------------- | ------------------------------------------------------------------------------------------------------- |
| `/api/provider-models`                        | –ü–û–õ–£–ß–ê–í–ê–ù–ï/–ü–£–ë–õ–ò–ö–£–í–ê–ù–ï/–ò–ó–¢–†–ò–í–ê–ù–ï | CRUD –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –¥–æ—Å—Ç–∞–≤—á–∏–∫                                                               |
| `/api/models/catalog`                         | –í–ó–ï–ú–ï–¢–ï                          | –û–±–æ–±—â–µ–Ω –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ –≤—Å–∏—á–∫–∏ –º–æ–¥–µ–ª–∏ (—á–∞—Ç, –≤–≥—Ä–∞–∂–¥–∞–Ω–µ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏), –≥—Ä—É–ø–∏—Ä–∞–Ω–∏ –ø–æ –¥–æ—Å—Ç–∞–≤—á–∏–∫ |
| `/api/settings/proxy`                         | –ü–û–õ–£–ß–ê–í–ê–ù–ï/–ü–û–°–¢–ê–í–Ø–ù–ï/–ò–ó–¢–†–ò–í–ê–ù–ï   | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –π–µ—Ä–∞—Ä—Ö–∏—á–µ–Ω –∏–∑—Ö–æ–¥—è—â –ø—Ä–æ–∫—Å–∏ (`global/providers/combos/keys`)                              |
| `/api/settings/proxy/test`                    | –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø                       | –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø—Ä–æ–∫—Å–∏ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç—Ç–∞ –∏ –≤—Ä—ä—â–∞ –ø—É–±–ª–∏—á–µ–Ω IP/–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç                                          |
| `/v1/providers/[provider]/chat/completions`   | –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø                       | –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–∏—è –Ω–∞ —á–∞—Ç –∑–∞ –≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫ —Å –≤–∞–ª–∏–¥–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª                              |
| `/v1/providers/[provider]/embeddings`         | –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø                       | –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –≤–≥—Ä–∞–∂–¥–∞–Ω–∏—è –∑–∞ –≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫ —Å –≤–∞–ª–∏–¥–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª                                      |
| `/v1/providers/[provider]/images/generations` | –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø                       | –°–ø–µ—Ü–∏–∞–ª–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞ –≤—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫ —Å –≤–∞–ª–∏–¥–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª                            |
| `/api/settings/ip-filter`                     | –í–ó–ï–ú–ò/–ü–û–°–¢–ê–í–ò                    | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–ø–∏—Å—ä–∫ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏/–±–ª–æ–∫–∏—Ä–∞–Ω–∏ IP                                                           |
| `/api/settings/thinking-budget`               | –í–ó–ï–ú–ò/–ü–û–°–¢–ê–í–ò                    | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –±—é–¥–∂–µ—Ç–∞ –Ω–∞ —Ç–æ–∫–µ–Ω–∞ –∑–∞ —Ä–∞–∑—Å—ä–∂–¥–µ–Ω–∏–µ (–ø—Ä–æ–ø—É—Å–∫–∞–Ω–µ/–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ/–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–æ/–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)     |
| `/api/settings/system-prompt`                 | –í–ó–ï–ú–ò/–ü–û–°–¢–ê–í–ò                    | –ë—ä—Ä–∑–æ –∏–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –≥–ª–æ–±–∞–ª–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –≤—Å–∏—á–∫–∏ –∑–∞—è–≤–∫–∏                                                  |
| `/api/sessions`                               | –í–ó–ï–ú–ï–¢–ï                          | –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ —Å–µ—Å–∏—è –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏                                                              |
| `/api/rate-limits`                            | –í–ó–ï–ú–ï–¢–ï                          | –°—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ª–∏–º–∏—Ç–∞ –ø–æ —Å–º–µ—Ç–∫–∞                                                            |

---

## 5. –ö–ª—é—á–æ–≤–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –¥–∏–∑–∞–π–Ω

### 5.1 Hub-and-Spoke –ø—Ä–µ–≤–æ–¥

–í—Å–∏—á–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏ —Å–µ –ø—Ä–µ–≤–µ–∂–¥–∞—Ç –ø—Ä–µ–∑ **OpenAI —Ñ–æ—Ä–º–∞—Ç –∫–∞—Ç–æ —Ü–µ–Ω—Ç—ä—Ä**. –î–æ–±–∞–≤—è–Ω–µ—Ç–æ –Ω–∞ –Ω–æ–≤ –¥–æ—Å—Ç–∞–≤—á–∏–∫ –∏–∑–∏—Å–∫–≤–∞ —Å–∞–º–æ –ø–∏—Å–∞–Ω–µ –Ω–∞ **–µ–¥–Ω–∞ –¥–≤–æ–π–∫–∞** –ø—Ä–µ–≤–æ–¥–∞—á–∏ (–∫—ä–º/–æ—Ç OpenAI), –∞ –Ω–µ –Ω–∞ N –¥–≤–æ–π–∫–∏.

### 5.2 –ú–æ–¥–µ–ª –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª

–í—Å–µ–∫–∏ –¥–æ—Å—Ç–∞–≤—á–∏–∫ –∏–º–∞ —Å–ø–µ—Ü–∏–∞–ª–µ–Ω –∫–ª–∞—Å –∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª, –Ω–∞—Å–ª–µ–¥–µ–Ω –æ—Ç `BaseExecutor`. –§–∞–±—Ä–∏–∫–∞—Ç–∞ –≤ `executors/index.ts` –∏–∑–±–∏—Ä–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ.

### 5.3 –°–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—â–∞ —Å–µ –ø–ª—ä–≥–∏–Ω —Å–∏—Å—Ç–µ–º–∞

–ú–æ–¥—É–ª–∏—Ç–µ –∑–∞ –ø—Ä–µ–≤–æ–¥–∞—á —Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—Ç –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ —á—Ä–µ–∑ `register()`. –î–æ–±–∞–≤—è–Ω–µ—Ç–æ –Ω–∞ –Ω–æ–≤ –ø—Ä–µ–≤–æ–¥–∞—á –µ –ø—Ä–æ—Å—Ç–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ—Ç–æ –º—É.

### 5.4 –†–µ–∑–µ—Ä–≤–µ–Ω –∞–∫–∞—É–Ω—Ç —Å –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–æ –æ—Ç—Å—Ç—ä–ø–ª–µ–Ω–∏–µ

–ö–æ–≥–∞—Ç–æ –¥–æ—Å—Ç–∞–≤—á–∏–∫—ä—Ç –≤—ä—Ä–Ω–µ 429/401/500, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –º–æ–∂–µ –¥–∞ –ø—Ä–µ–≤–∫–ª—é—á–∏ –∫—ä–º —Å–ª–µ–¥–≤–∞—â–∏—è –∞–∫–∞—É–Ω—Ç, –ø—Ä–∏–ª–∞–≥–∞–π–∫–∏ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–æ –æ—Ö–ª–∞–∂–¥–∞–Ω–µ (1s ‚Üí 2s ‚Üí 4s ‚Üí max 2min).

### –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏ –≤–µ—Ä–∏–≥–∏ –∑–∞ –º–æ–¥–µ–ª–∏ 5.5

‚Äû–ö–æ–º–±–æ‚Äú –≥—Ä—É–ø–∏—Ä–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –Ω–∏–∑–æ–≤–µ `provider/model`. –ê–∫–æ –ø—ä—Ä–≤–∏—è—Ç –Ω–µ —É—Å–ø–µ–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –≤—ä—Ä–Ω–µ—Ç–µ –∫—ä–º —Å–ª–µ–¥–≤–∞—â–∏—è.

### 5.6 –ü–æ—Ç–æ—á–µ–Ω –ø—Ä–µ–≤–æ–¥ —Å –ø—ä–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ

–ü—Ä–µ–≤–æ–¥—ä—Ç –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä –ø–æ–¥–¥—ä—Ä–∂–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –≤ SSE –±–ª–æ–∫–æ–≤–µ (–ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –º–∏—Å–ª–µ—â –±–ª–æ–∫, –Ω–∞—Ç—Ä—É–ø–≤–∞–Ω–µ –Ω–∞ –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∏–Ω–¥–µ–∫—Å–∏—Ä–∞–Ω–µ –Ω–∞ –±–ª–æ–∫ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ) —á—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º–∞ `initState()`.

### 5.7 –ë—É—Ñ–µ—Ä –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç –ø—Ä–∏ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

–î–æ–±–∞–≤—è —Å–µ –±—É—Ñ–µ—Ä –æ—Ç 2000 —Ç–æ–∫–µ–Ω–∞ –∫—ä–º –æ—Ç—á–µ—Ç–µ–Ω–æ—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ, –∑–∞ –¥–∞ —Å–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏ –¥–æ—Å—Ç–∏–≥–∞–Ω–µ—Ç–æ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ç–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∏—Ç–µ –ø—Ä–æ–∑–æ—Ä—Ü–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ –ø–æ—Ä–∞–¥–∏ –Ω–∞—Ç–æ–≤–∞—Ä–≤–∞–Ω–µ –æ—Ç —Å–∏—Å—Ç–µ–º–Ω–∏ –ø–æ–¥–∫–∞–Ω–∏ –∏ –ø—Ä–µ–≤–æ–¥ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏.

---

## 6. –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∏

| –§–æ—Ä–º–∞—Ç                    | –ü–æ—Å–æ–∫–∞         | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä      |
| ------------------------- | -------------- | ------------------ |
| –ó–∞–≤—ä—Ä—à–≤–∞–Ω–∏—è –Ω–∞ OpenAI —á–∞—Ç | –∏–∑—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª | `openai`           |
| OpenAI Responses API      | –∏–∑—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª | `openai-responses` |
| –ê–Ω—Ç—Ä–æ–ø–∏—á–µ–Ω –ö–ª–æ–¥           | –∏–∑—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª | `claude`           |
| Google Gemini             | –∏–∑—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª | `gemini`           |
| Google Gemini CLI         | —Å–∞–º–æ —Ü–µ–ª       | `gemini-cli`       |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è            | –∏–∑—Ç–æ—á–Ω–∏–∫ + —Ü–µ–ª | `antigravity`      |
| AWS –ö–∏—Ä–æ                  | —Å–∞–º–æ —Ü–µ–ª       | `kiro`             |
| –ö—É—Ä—Å–æ—Ä                    | —Å–∞–º–æ —Ü–µ–ª       | `cursor`           |

---

## 7. –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏

| –î–æ—Å—Ç–∞–≤—á–∏–∫                | –ú–µ—Ç–æ–¥ –∑–∞ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ          | –ò–∑–ø—ä–ª–Ω–∏—Ç–µ–ª      | –û—Å–Ω–æ–≤–Ω–∏ –±–µ–ª–µ–∂–∫–∏                                    |
| ------------------------ | -------------------------------- | --------------- | -------------------------------------------------- |
| –ê–Ω—Ç—Ä–æ–ø–∏—á–µ–Ω –ö–ª–æ–¥          | API –∫–ª—é—á –∏–ª–∏ OAuth               | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –ò–∑–ø–æ–ª–∑–≤–∞ `x-api-key` –∑–∞–≥–ª–∞–≤–∫–∞                      |
| Google Gemini            | API –∫–ª—é—á –∏–ª–∏ OAuth               | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –ò–∑–ø–æ–ª–∑–≤–∞ `x-goog-api-key` –∑–∞–≥–ª–∞–≤–∫–∞                 |
| Google Gemini CLI        | OAuth                            | GeminiCLI       | –ò–∑–ø–æ–ª–∑–≤–∞ `streamGenerateContent` –∫—Ä–∞–π–Ω–∞ —Ç–æ—á–∫–∞      |
| –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è           | OAuth                            | –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è  | Multi-URL —Ä–µ–∑–µ—Ä–≤–µ–Ω, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø–æ–≤—Ç–æ—Ä–µ–Ω –∞–Ω–∞–ª–∏–∑ |
| OpenAI                   | API –∫–ª—é—á                         | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –Ω–æ—Å–∏—Ç–µ–ª               |
| –ö–æ–¥–µ–∫—Å                   | OAuth                            | –ö–æ–¥–µ–∫—Å          | –ò–Ω–∂–µ–∫—Ç–∏—Ä–∞ —Å–∏—Å—Ç–µ–º–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —É–ø—Ä–∞–≤–ª—è–≤–∞ –º–∏—Å–ª–µ–Ω–µ—Ç–æ |
| –ö–æ–ø–∏–ª–æ—Ç –Ω–∞ GitHub        | OAuth + Copilot token            | Github          | –î–≤–æ–µ–Ω —Ç–æ–∫–µ–Ω, –∏–º–∏—Ç–∏—Ä–∞—â–∞ –∑–∞–≥–ª–∞–≤–∫–∞ –Ω–∞ VSCode          |
| –ö–∏—Ä–æ (AWS)               | AWS SSO OIDC –∏–ª–∏ —Å–æ—Ü–∏–∞–ª–Ω–∏        | –ö–∏—Ä–æ            | –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞ –¥–≤–æ–∏—á–µ–Ω EventStream                     |
| –ö—É—Ä—Å–æ—Ä IDE               | –ö–æ–Ω—Ç—Ä–æ–ª–Ω–∞ —Å—É–º–∞ –∑–∞ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ | –ö—É—Ä—Å–æ—Ä          | Protobuf –∫–æ–¥–∏—Ä–∞–Ω–µ, SHA-256 –∫–æ–Ω—Ç—Ä–æ–ª–Ω–∏ —Å—É–º–∏          |
| –ö—É–µ–Ω                     | OAuth                            | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ                          |
| iFlow                    | OAuth (–æ—Å–Ω–æ–≤–µ–Ω + –Ω–æ—Å–∏—Ç–µ–ª)        | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –ó–∞–≥–ª–∞–≤–∫–∞ –∑–∞ –¥–≤–æ–π–Ω–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ                  |
| OpenRouter               | API –∫–ª—é—á                         | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –Ω–æ—Å–∏—Ç–µ–ª               |
| GLM, Kimi, MiniMax       | API –∫–ª—é—á                         | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –°—ä–≤–º–µ—Å—Ç–∏–º —Å Claude, –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ `x-api-key`        |
| `openai-compatible-*`    | API –∫–ª—é—á                         | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –î–∏–Ω–∞–º–∏—á–Ω–æ: –≤—Å—è–∫–∞ –∫—Ä–∞–π–Ω–∞ —Ç–æ—á–∫–∞, —Å—ä–≤–º–µ—Å—Ç–∏–º–∞ —Å OpenAI |
| `anthropic-compatible-*` | API –∫–ª—é—á                         | –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ | –î–∏–Ω–∞–º–∏—á–Ω–æ: –≤—Å—è–∫–∞ –∫—Ä–∞–π–Ω–∞ —Ç–æ—á–∫–∞, —Å—ä–≤–º–µ—Å—Ç–∏–º–∞ —Å Claude |

---

## 8. –†–µ–∑—é–º–µ –Ω–∞ –ø–æ—Ç–æ–∫–∞ –æ—Ç –¥–∞–Ω–Ω–∏

### –ó–∞—è–≤–∫–∞ –∑–∞ –ø–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor\nbuildUrl + buildHeaders"]
    D --> E["fetch(providerURL)"]
    E --> F["createSSEStream()\nTRANSLATE mode"]
    F --> G["parseSSELine()"]
    G --> H["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    H --> I["extractUsage()\n+ addBuffer"]
    I --> J["formatSSE()"]
    J --> K["Client receives\ntranslated SSE"]
    K --> L["logUsage()\nsaveRequestUsage()"]
```

### –ó–∞—è–≤–∫–∞ –±–µ–∑ –ø–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ

```mermaid
flowchart LR
    A["Client"] --> B["detectFormat()"]
    B --> C["translateRequest()\nsource ‚Üí OpenAI ‚Üí target"]
    C --> D["Executor.execute()"]
    D --> E["translateResponse()\ntarget ‚Üí OpenAI ‚Üí source"]
    E --> F["Return JSON\nresponse"]
```

### –ë–∞–π–ø–∞—Å–µ–Ω –ø–æ—Ç–æ–∫ (Claude CLI)

```mermaid
flowchart LR
    A["Claude CLI request"] --> B{"Match bypass\npattern?"}
    B -->|"Title/Warmup/Count"| C["Generate fake\nOpenAI response"]
    B -->|"No match"| D["Normal flow"]
    C --> E["Translate to\nsource format"]
    E --> F["Return without\ncalling provider"]
```
